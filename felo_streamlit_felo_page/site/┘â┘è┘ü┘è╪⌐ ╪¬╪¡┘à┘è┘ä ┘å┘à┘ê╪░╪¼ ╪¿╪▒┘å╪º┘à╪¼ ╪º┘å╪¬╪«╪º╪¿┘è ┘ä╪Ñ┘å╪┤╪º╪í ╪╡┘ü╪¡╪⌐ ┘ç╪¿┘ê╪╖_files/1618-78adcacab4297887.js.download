"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1618],{51618:function(e,t,l){l.d(t,{Z:function(){return lT}});var s=l(52676),a=l(22955),i=l(26745),n=l(86968),r=l(60904),o=l(73423),d=l(17224),c=l.n(d),u=l(75271),m=l(46571),p=l(37639),h=l(25010),x=l(96164),v=l(46988),g=l(31022),f=l(76011),_=l(7717),b=l(27976),j=l(97571),y=l(29871),w=l(90488),N=l(80626),k=l(53232),E=l(8096),S=l(29764),Z=l(4814),C=l(57546),F=l(34276);let T=e=>(/^https?:\/\//i.test(e)||(e="https://"+e),e);var D=u.memo(e=>{let{data:t,selected:l,goToTraditionalSearch:a}=e,i=(0,d.useRouter)(),n=(0,_.useTranslations)(),r=(0,g.Z)(e=>e.setLoading),[o,c]=(0,u.useState)(!1),m=async()=>{var e;if((null==t?void 0:t.type)==="site"||!await (0,F.f)({query:null===(e=t.title)||void 0===e?void 0:e.trim(),setLoading:r}))return;g.Z.getState().startSearch("guess");let{isOpenThreadModal:l,closeThreadModal:s}=C.Z.getState();l&&s(),i.push((0,p.MD)({query:t.title}))};if((null==t?void 0:t.type)==="site"){let{domain:e,title:a}=t,i=T(e);return(0,s.jsxs)("section",{className:(0,Z.Z)("scroll-m-32","transition-[background] flex group rounded-lg items-center gap-2 p-2 text-sm rounded cursor-pointer",(l||o)&&"bg-[#F6F7F9] dark:bg-[#454E5D]"),onMouseOver:()=>c(!0),onMouseLeave:()=>c(!1),onClick:()=>{window.open(i,"_blank")},children:[(0,s.jsx)("div",{children:(0,s.jsx)(w.Z,{classNames:{wrapper:"flex-shrink-0"},src:"https://www.google.com/s2/favicons?domain=".concat(i,"&sz=",16)})}),(0,s.jsx)("span",{className:"truncate mr-2 flex-shrink-0",children:a}),(0,s.jsxs)("span",{className:"flex items-center min-w-0",children:[(0,s.jsx)(N.Z,{className:"flex-shrink-0 w-3 h-3 mr-1 text-gray-400 dark:text-gray-500"}),(0,s.jsx)("span",{className:"text-xs text-gray-400 dark:text-gray-500 truncate",children:i})]}),(0,s.jsx)(k.Z,{className:"opacity-0 group-hover:opacity-100 transition-opacity ml-auto flex-shrink-0",size:18})]})}return(null==t?void 0:t.type)==="websearch"?(0,s.jsxs)("div",{className:(0,Z.Z)("scroll-m-32","transition-[background] rounded-lg flex group items-center gap-2 p-2 text-sm rounded cursor-pointer",(l||o)&&"bg-[#F6F7F9] dark:bg-[#454E5D]"),onMouseOver:()=>c(!0),onMouseLeave:()=>c(!1),onClick:a,children:[(0,s.jsx)(E.Z,{className:"w-4 h-4"}),(0,s.jsx)("div",{className:"text-sm",children:n("traditional_search")}),(0,s.jsx)("div",{className:"text-xs text-gray-500 ml-1 italic",children:n("traditional_search_tip")}),(0,s.jsx)("div",{className:"ml-auto border border-[#9B9FFF] text-[#9B9FFF] rounded-xl px-1",children:"Beta"})]}):(0,s.jsxs)("div",{className:(0,Z.Z)("scroll-m-32","transition-[background] flex group rounded-lg items-center gap-2 p-2 text-sm rounded cursor-pointer",(l||o)&&"bg-[#F6F7F9] dark:bg-[#454E5D]"),onMouseOver:()=>c(!0),onMouseLeave:()=>c(!1),onClick:m,children:[(0,s.jsx)(S.Z,{className:"w-4 h-4"}),t.title]})}),A=l(26595),z=l(57207),I=l(28946),R=l(94247),P=l(15729),L=l(80145),M=l(9369),B=l(36551),U=l(46344),O=l(31442),H=l(67241),W=l(4590),V=l(97247),q=l(17112),Y=l(43378),G=l(22675),J=l(9164),X=l(44644),K=l(54313),$=l(416),Q=l(84375),ee=l(95808),et=l(18718),el=l(88637),es=l(59167),ea=l(87106),ei=l(81555),en=l(9455),er=l(65550),eo=l(38188),ed=l(65819),ec=l(38793),eu=l(48958),em=l(91165),ep=l(65213),eh=l(29197),ex=l(77249),ev=l(84593),eg=l(70017),ef=l(1167),e_=l(25994),eb=l(31063),ej=l(60161),ey=l(49759),ew=l(56975),eN=l(47014),ek=l(74538),eE=l(19073),eS=l(14386),eZ=l(21133),eC=e=>{let{selectItem:t,selectClick:l}=e,a=(0,_.useTranslations)(),i=(0,ed.gQ)(),n=(0,u.useMemo)(()=>i?[{icon:(0,s.jsx)(eS.aL,{className:"w-5 h-5"}),name:a("shareThread.secret"),value:"PRIVATE"},{icon:(0,s.jsx)(eE.Z,{className:"w-5 h-5"}),name:a("shareThread.enterprise_title"),value:"PARTIAL_PUBLIC"},{icon:(0,s.jsx)(eZ.FO,{className:"w-5 h-5"}),name:a("shareThread.shareable"),value:"PUBLIC"}]:[{icon:(0,s.jsx)(eS.aL,{className:"w-5 h-5"}),name:a("shareThread.secret"),value:"PRIVATE"},{icon:(0,s.jsx)(eZ.FO,{className:"w-5 h-5"}),name:a("shareThread.shareable"),value:"PUBLIC"}],[i]),r=(0,u.useMemo)(()=>{let e=n.find(e=>e.value===t.permission.read_permission);return(null==e?void 0:e.name)||""},[t]),o=(0,u.useMemo)(()=>{let e=n.find(e=>e.value===t.permission.read_permission);return(null==e?void 0:e.icon)||""},[t]);return(0,s.jsxs)(ey.F,{children:[(0,s.jsx)(ew.S,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full px-2 py-1  bg-white border border-gray-300 rounded-md shadow-sm cursor-pointer  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2  focus:ring-indigo-500 dark:bg-[#202531] dark:border-[#454E5D]  dark:hover:bg-[#202531]",children:[o,(0,s.jsx)("span",{className:"ml-2 mr-4 whitespace-nowrap",children:r}),(0,s.jsx)(M.Z,{size:20})]})}),(0,s.jsx)(eN.a,{"aria-label":"topic Changed",className:"p-2 overflow-auto",style:{position:"relative",pointerEvents:"auto"},children:n.map((e,a)=>(0,s.jsx)(ek.W,{className:"text-[#1D3C6D] cursor-pointer hover:!bg-blue-100 hover:!text-[#1D3C6D] dark:text-[#EDF3FC] hover:dark:!bg-[#2E3643] hover:dark:!text-[#EDF3FC]",onClick:()=>{l(t,e.value)},children:e.name},a))})]})},eF=l(26449),eT=l(89335),eD=l(77844),eA=l(95191),ez=l(59892),eI=e=>{let{defaultItem:t,isUsing:l,isEditing:a,callbacks:i,setIsEditing:n,onSubmit:r,tooltipOpen:o}=e,d=(0,_.useTranslations)(),c=(0,_.useLocale)(),m=(0,g.Z)(e=>e.proSelected),p=(0,ed.ZP)(e=>e.isLogin),[x,v]=(0,u.useState)({name:t.title,description:t.description,placeholder:t.placeholder,steps:t.sub_topics}),[f,b]=(0,u.useState)(""),[j,y]=(0,u.useState)(!1),[w,N]=(0,u.useState)(""),[k,E]=(0,u.useState)(!1),[S,Z]=(0,u.useState)([]),[C,F]=(0,u.useState)([]),[T,D]=(0,u.useState)(!1),{copy:A,copied:z}=(0,eg.V)(),[I,R]=(0,u.useState)(!1),P=eD.Z.getState().current,L=t.system,M=L||!t.created_at,[U,O]=(0,u.useState)("");(0,u.useEffect)(()=>{(async()=>{let e=await (0,eA.Y)(t.title),l=(0,ez.b)(e);O("".concat(location.origin,"/agents/").concat(l,"-").concat(t.short_id).concat(P?"?invite="+P:""))})()},[t.title,t.short_id,P]),(0,u.useEffect)(()=>{try{var e;D(!!(t.params&&(null===(e=t.params[0])||void 0===e?void 0:e.type)==="file"))}catch(e){console.log(e),D(!1)}},[t]);let H=(e,t)=>{t.length>100||v(l=>({...l,steps:l.steps.map((l,s)=>s===e?{...l,title:t}:l)}))},W=(e,t)=>{v(l=>({...l,steps:l.steps.map((l,s)=>s===e?{...l,source_type:t.source_type,source_id:t.source_id,source_info:t.source_info,tools:t.tools}:l)}))},V=e=>{if(x.steps.length<=1){q.Z.warning(d("agent.min_one_step_required"));return}v(t=>({...t,steps:t.steps.filter((t,l)=>l!==e)}))},G=e=>{if(x.steps.length>=e_.o2){q.Z.warning(d("agent.max_steps_reached",{count:e_.o2}));return}v(t=>({...t,steps:[...t.steps.slice(0,e+1),{title:"",source_type:B.gl},...t.steps.slice(e+1)]}))},J=async()=>{try{var e,l;if(!x.name.trim()){N(d("agent.please_input_agent_name"));return}if(x.steps.some(e=>!e.title.trim())){N(d("agent.please_input_steps"));return}if(!p)return;y(!0),N("");let s=null;if(M){let l={introduction:x.description||"",title:x.name,placeholder:x.placeholder,sub_topics:x.steps,params:null==t?void 0:t.params,template_type:ei.W.DEFAULT,lang:c};(s=await (0,ea.YX)(l)).data&&(null===(e=i.onCreate)||void 0===e||e.call(i,s.data))}else if(t){let e={short_id:t.short_id,introduction:x.description||"",title:x.name,placeholder:x.placeholder,sub_topics:x.steps,params:null==t?void 0:t.params,template_type:ei.W.DEFAULT};(s=await (0,ea._Z)(e)).data&&(null===(l=i.onUpdate)||void 0===l||l.call(i,s.data))}if(!s||!s.success){q.Z.error((null==s?void 0:s.error)||d("save_failed")),y(!1);return}q.Z.success(d("save_success")),n(!1),(0,eb.fk)(L?ej.U.AGENT_SAVE:ej.U.AGENT_CREATE_SAVE,{name:x.name},!0)}catch(e){N(e instanceof Error?e.message:d("save_failed"))}finally{y(!1)}},X=async e=>{if(e.preventDefault(),!j){if(!t){N(d("please_select_report_type"));return}if(!f){N(d("please_input_industry_name"));return}try{y(!0),N("");let e=g.Z.getState().proSelected?B.NY:B.R_,l=localStorage.getItem(eo.J.GTAG_EVENT_ACTIVATION)||ed.ZP.getState().anonymousToken,s=await (0,ea.GK)(t.short_id,{query:f,mode:e,device_id:l});if(!s.data||!s.success){q.Z.error((null==s?void 0:s.error)||d("submit_failed")),y(!1);return}let a=s.data.sub_queries;await r(a)}catch(e){N(e instanceof Error?e.message:d("submit_failed"))}finally{y(!1)}}},K=async()=>{var e,l;if(!t)return;if(!p){q.Z.success(d("delete_success")),null===(l=i.onDelete)||void 0===l||l.call(i,t.id);return}let s=await (0,ea.hX)([t.short_id]);if(!s.success){q.Z.error((null==s?void 0:s.error)||d("delete_failed"));return}q.Z.success(d("delete_success")),null===(e=i.onDelete)||void 0===e||e.call(i,t.id)},$=async()=>{E(!0);try{let e=await (0,ea.hi)(t.short_id);e.data&&(Z(e.data.filter(e=>!0===e.permission.is_self)||[]),F(e.data.filter(e=>!1===e.permission.is_self)||[]))}catch(e){console.log(e),Z([]),F([])}},Q=async(e,t)=>{200===(await (0,eT.n2)({topic_id:e.short_id,read_permission:t})).status&&Z(l=>l.map(l=>l.short_id===e.short_id?{...l,permission:{read_permission:t,is_self:l.permission.is_self,can_read:l.permission.can_read}}:l))};(0,u.useEffect)(()=>{if(S.length<=0){R(!0);return}let e=S.every(e=>"PUBLIC"===e.permission.read_permission),t=S.some(e=>"PRIVATE"===e.permission.read_permission);e?R(!0):t?R(!1):R(!0)},[S]);let ee=(0,s.jsx)(Y.Vq,{open:k,onOpenChange:E,children:(0,s.jsxs)(Y.cZ,{className:"max-w-2xl w-full max-h-full",children:[(0,s.jsx)(Y.fK,{children:(0,s.jsx)(Y.$N,{children:d("share_research_plan")})}),(0,s.jsxs)("section",{className:"px-6 pb-8 pt-4 w-full overflow-hidden",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:d("agent.copy_link_label")}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("p",{className:"flex-1 p-2 text-sm bg-muted rounded-md rounded-r-none truncate",children:I&&0===C.length?U:"".concat(U.slice(0,40),"...")}),(0,s.jsx)(h.z,{size:"sm",disabled:!I,className:"px-3 shrink-0 rounded-l-none transition-colors duration-300 ".concat(z?"bg-green-500 hover:bg-green-600":""),onClick:()=>{if(C.length>0&&o&&!C.every(e=>"PUBLIC"===e.permission.read_permission)){o();return}A(U),(0,eb.fk)(ej.U.AGENT_SHARE,{value:1},!0)},children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[z?(0,s.jsx)(em.Z,{className:"h-4 w-4"}):(0,s.jsx)(ep.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:d("copy")})]})})]}),S.length>0&&(0,s.jsxs)("div",{className:"border border-theme-border-100 rounded-md mt-6",children:[(0,s.jsxs)("div",{className:"flex gap-2 bg-[#FFF0DE] text-[#f59a23] px-2 py-1 rounded-t-md",children:[(0,s.jsx)(eh.Z,{size:20,className:"mt-[2px]"}),(0,s.jsx)("span",{children:d("agent.share_tip_desc")})]}),(0,s.jsx)("div",{className:"flex flex-col gap-4 p-3 mt-2",children:S.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"max-w-[200px] whitespace-nowrap overflow-hidden text-ellipsis text-base font-bold",children:e.name}),(0,s.jsxs)("div",{className:"text-sm text-gray-400",children:["(",d("agent.share_tip_desc_file"),")"]}),(0,s.jsx)("div",{className:"ml-auto",children:(0,s.jsx)(eC,{selectItem:e,selectClick:Q})})]},e.short_id))})]}),(0,s.jsx)("div",{className:"mt-6 space-y-4",children:(0,s.jsx)("div",{className:"flex flex-col gap-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:d("agent.share_description_title")}),(0,s.jsxs)("ul",{className:"list-inside space-y-1 text-sm text-muted-foreground",children:[(0,s.jsx)("li",{children:d("agent.share_description_1")}),(0,s.jsx)("li",{children:d("agent.share_description_2")}),(0,s.jsx)("li",{children:d("agent.share_description_3")})]})]})})})]})]})});if(a){var et;return(0,s.jsxs)("div",{className:"flex flex-col h-full relative",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col h-full p-6 overflow-y-auto scrollbar",children:[(0,s.jsx)("h3",{className:"flex-none font-medium mb-4",children:d("agent.edit_template")}),(0,s.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium mb-2",children:[d("agent.agent_name"),(0,s.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[x.name.length,"/70"]})]}),(0,s.jsx)(eu.Y,{value:x.name,onChange:e=>v(t=>({...t,name:e.target.value})),placeholder:d("agent.input_agent_name"),maxLength:70})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:d("agent.agent_description")}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[(null===(et=x.description)||void 0===et?void 0:et.length)||0,"/200"]})]}),(0,s.jsx)(ec.Y,{value:x.description,onChange:e=>v(t=>({...t,description:e.target.value})),placeholder:d("agent.input_agent_description"),maxLength:200,minRows:3,maxRows:5})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:d("agent.template_placeholder")}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[x.placeholder.length,"/100"]})]}),(0,s.jsx)(ec.Y,{value:x.placeholder,onChange:e=>v(t=>({...t,placeholder:e.target.value})),placeholder:d("agent.input_template_placeholder"),maxLength:100,minRows:2,maxRows:3})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium",children:[d("agent.agent_steps"),(0,s.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,s.jsxs)(h.z,{size:"sm",variant:"ghost",onClick:()=>{if(x.steps.length>=e_.o2){q.Z.warning(d("agent.max_steps_reached",{count:e_.o2}));return}v(e=>({...e,steps:[...e.steps,{title:"",source_type:B.gl}]}))},children:["+ ",d("agent.add_step")]})]}),(0,s.jsx)("div",{className:"space-y-2",children:x.steps.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"flex-none w-6 text-sm text-gray-500",children:t+1}),(0,s.jsx)(eu.Y,{value:e.title,onChange:e=>H(t,e.target.value),placeholder:d("agent.input_step_content"),maxLength:100}),(0,s.jsxs)("div",{className:"flex gap-1",children:[!T&&(0,s.jsx)(eF.Z,{item:e,onChange:W,index:t}),(0,s.jsx)(h.z,{size:"sm",variant:"ghost",onClick:()=>G(t),className:"text-gray-500 hover:text-blue-500",children:(0,s.jsx)("span",{children:"+"})}),(0,s.jsx)(h.z,{size:"sm",variant:"ghost",onClick:()=>V(t),className:"text-gray-500 hover:text-red-500",children:(0,s.jsx)("span",{children:"-"})})]})]},t))})]})]}),w&&(0,s.jsx)("div",{className:"mt-4 text-sm text-red-500",children:w})]}),(0,s.jsxs)("div",{className:"flex-none flex items-center justify-between gap-2 px-6 py-4 border-t",children:[!L&&(0,s.jsx)("div",{children:(0,s.jsx)(h.z,{variant:"destructive",size:"sm",onClick:K,children:d("delete")})}),(0,s.jsxs)("div",{className:"flex-1 flex justify-end space-x-2",children:[(0,s.jsx)(h.z,{variant:"outline",size:"sm",onClick:()=>{var e;n(!1),N(""),v({name:t.title,description:t.description,placeholder:t.placeholder,steps:t.sub_topics}),null===(e=i.onBack)||void 0===e||e.call(i)},children:d("cancel")}),(0,s.jsx)(h.z,{size:"sm",onClick:J,disabled:j||!x.name,children:L?d("save_to_my_templates"):d("confirm")})]})]})]})}return l?(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)(h.z,{variant:"ghost",size:"sm",onClick:i.onBack,className:"hover:bg-gray-100 dark:hover:bg-gray-600 mb-4",disabled:j,children:[(0,s.jsx)(ex.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:d("back")})]}),(0,s.jsxs)("form",{onSubmit:X,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-2",children:[(0,s.jsxs)("label",{htmlFor:"brandName",className:"block text-sm font-medium",children:[d("research_target"),(0,s.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[f.length,"/70"]})]}),(0,s.jsx)(eu.Y,{id:"brandName",name:"brandName",placeholder:d("research_target_placeholder",{count:70}),value:f,onChange:e=>{b(e.target.value),N("")},maxLength:70,autoFocus:!0,isDisabled:j,isInvalid:!!w,errorMessage:w,isRequired:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"})]}),(0,s.jsx)("div",{className:"absolute bottom-6 right-6",children:(0,s.jsx)(h.z,{type:"submit",size:"sm",disabled:j,children:j?d("generating"):d("confirm")})})]})]}):!a&&x.name?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("section",{className:"h-full flex flex-col gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("span",{className:"font-bold",children:d("introduction")}),m&&(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)(ef.pn,{delayDuration:100,children:(0,s.jsxs)(ef.u,{children:[(0,s.jsx)(ef.aJ,{children:(0,s.jsx)(ev.Z,{className:"h-4 w-4"})}),(0,s.jsx)(ef._v,{children:d("agent.pro_search_cost_tip")})]})}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:d("agent.pro_search_cost",{count:x.steps.length})})]})]}),(0,s.jsx)("p",{className:"text-sm mt-6",children:x.description}),(0,s.jsx)("ul",{className:"mt-6 list-disc list-inside space-y-1",children:x.steps.map(e=>(0,s.jsx)("li",{children:e.title},e.title))})]}),(0,s.jsx)("section",{className:"flex-none pl-4 pr-2 pb-4",children:(0,s.jsxs)("section",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("section",{children:p&&(0,s.jsx)(h.z,{variant:"outline",onClick:$,className:"flex items-center gap-2",children:(0,s.jsx)("span",{children:d("share_research_plan")})})}),(0,s.jsxs)("section",{className:"space-x-2",children:[p&&(0,s.jsx)(h.z,{variant:"outline",onClick:()=>{n(!0),(0,eb.fk)(ej.U.AGENT_EDIT,{name:x.name},!0)},children:d("edit")}),(0,s.jsx)(h.z,{onClick:()=>{var e;null===(e=i.onConfirm)||void 0===e||e.call(i,t)},children:d("apply")})]})]})})]}),ee]}):null},eR=l(30674),eP=l(37481);let eL=[{key:"processing",label:"agent.create_agent_step_1"},{key:"createing",label:"agent.create_agent_step_2"},{key:"collecting",label:"agent.create_agent_step_3"},{key:"optimizing",label:"agent.create_agent_step_4"}];var eM=e=>{let{onCreate:t,onCancel:l}=e,a=(0,_.useTranslations)(),[i,n]=(0,u.useState)(!1),[r,o]=(0,u.useState)(!1),[d,c]=(0,u.useState)(""),[m,p]=(0,u.useState)(0),[x,f]=(0,u.useState)();(0,u.useEffect)(()=>{if(i)return(async()=>{for(let e of eL.map((e,t)=>t))await new Promise(e=>setTimeout(e,1e3)),p(e)})(),()=>{p(0)}},[i]);let b=async()=>{n(!0);let{proSelected:e}=g.Z.getState(),t=e?B.NY:B.R_,l=localStorage.getItem(eo.J.GTAG_EVENT_ACTIVATION)||ed.ZP.getState().anonymousToken,s=await (0,ea.RV)({query:d,mode:t,device_id:l});if(!s||!s.success||!s.data){n(!1),q.Z.error((null==s?void 0:s.error)||a("error.failed_to_generate_template"));return}f(s.data),n(!1),o(!0);let{title:i}=s.data;(0,eb.fk)(ej.U.AGENT_CREATE_SUBMIT,{name:i},!0)},j=()=>{c(""),l(),o(!1),f(void 0)};return r&&x?(0,s.jsx)("div",{className:"flex-1 h-full",children:(0,s.jsx)(eI,{defaultItem:x,isUsing:!1,isEditing:!0,setIsEditing:()=>{},onSubmit:()=>{},callbacks:{onBack:j,onCreate:e=>{t(e)},onDelete:()=>{},onUpdate:()=>{},onConfirm:()=>{}}},"create-template")}):(0,s.jsxs)("div",{className:"flex flex-col h-full p-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-md font-medium",children:a("create_ai_search_agent_button")}),!i&&(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[d.length," / ",100]})]}),i?(0,s.jsx)("div",{className:"flex-1 flex flex-col",children:(0,s.jsx)("div",{className:"space-y-4 w-full max-w-md",children:eL.map((e,t)=>(0,s.jsxs)("div",{className:(0,eP.cn)("flex items-center space-x-4",m>=t?"text-primary":"text-gray-400"),children:[(0,s.jsx)("span",{children:a(e.label)}),(0,s.jsx)(eR.c,{size:"sm",className:(0,eP.cn)("opacity-0",m===t&&"opacity-100")})]},e.key))})}):(0,s.jsxs)("div",{className:"flex-1 mb-6",children:[(0,s.jsx)(v.Z,{className:(0,eP.cn)("p-4 rounded-xl shadow-sm","border-1 border-[#dbe2e9] dark:border-[#343b4d] dark:bg-[#353B46]","w-full bg-inherit outline-none resize-none transition-height"),value:d,onChange:e=>c(e.target.value),onKeyDown:e=>{13==e.keyCode&&!1==e.shiftKey&&!i&&d.trim()&&(e.preventDefault(),b())},placeholder:a("create_ai_search_agent_placeholder"),maxLength:100,minRows:2,autoFocus:!0}),(0,s.jsxs)("div",{className:"mt-4 text-sm",children:[(0,s.jsx)("p",{className:"text-gray-500 mb-2",children:a("agent.example")}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 text-gray-500",children:[(0,s.jsx)("p",{children:a("agent.example_1")}),(0,s.jsx)("p",{children:a("agent.example_2")}),(0,s.jsx)("p",{children:a("agent.example_3")})]})]})]}),(0,s.jsx)("div",{className:"flex justify-end items-center",children:!i&&(0,s.jsxs)("div",{className:"space-x-2",children:[(0,s.jsx)(h.z,{variant:"outline",onClick:j,children:a("cancel")}),(0,s.jsx)(h.z,{onClick:b,disabled:!d.trim(),children:a("submit_task")})]})})]})},eB=l(5588),eU=l(72696),eO=l(35525),eH=l(32733),eW=e=>{let{defaultValue:t,onChange:l,disabled:a,allowedModels:i}=e,n=(0,_.useTranslations)(),{setIsOpen:r,getDataRetentionEnabled:o,setCallback:d}=(0,eO.Z)(),{allModelList:c}=(0,g.Z)(),u=e=>{if(("deepseek-reasoner"===e||"deepseek-chat"===e)&&!o()){r(!0),d(()=>{l(e)});return}l(e)},p=i&&i.length>0?c.filter(e=>i.includes(e.value)):c;return(0,s.jsxs)(eU.h_,{children:[(0,s.jsx)(eU.$F,{asChild:!0,disabled:a,children:(0,s.jsx)("button",{className:"relative inline-block w-full",children:(0,s.jsxs)("div",{className:(0,m.cn)("flex items-center justify-between w-full px-4 py-2 bg-white border border-[#EBEEF3] rounded-md shadow-sm cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 border dark:border-[#545D6F] dark:bg-[#202531] dark:hover:bg-gray-700",a&&"opacity-50 cursor-not-allowed"),children:[(0,s.jsxs)("span",{className:"flex items-center whitespace-nowrap",children:[(()=>{var e;let l=null===(e=c.find(e=>e.value===t))||void 0===e?void 0:e.provider;return l?eH.e5[l]:null})(),(0,s.jsx)("span",{className:"ml-2 mr-4",children:(()=>{let e=c.find(e=>e.value===t);return e?e.label:""})()})]}),(0,s.jsx)(M.Z,{size:20})]})})}),(0,s.jsxs)(eU.AW,{className:"w-fit p-3 dark:bg-[#454E5D] dark:border-[#2E3643]",children:[(0,s.jsx)("div",{className:"mb-2 text-base",children:n("set_advanced_model")}),(0,s.jsx)("div",{className:"max-h-[40vh] overflow-y-auto custom-scrollbar",children:p.map(e=>(0,s.jsxs)(eU.Xi,{className:(0,m.cn)("flex items-center cursor-pointer","text-[#1D3C6D] hover:!bg-blue-100 hover:!text-[#1D3C6D] dark:text-[#EDF3FC] hover:dark:!bg-[#2E3643] hover:dark:!text-[#EDF3FC]",!b.r8&&e.is_dev&&"hidden"),onClick:()=>u(e.value),children:[(0,s.jsxs)("span",{className:"flex items-center",children:[eH.e5[e.provider],(0,s.jsx)("span",{className:"ml-2",children:e.label})]}),(0,s.jsxs)("span",{className:"flex gap-2",children:[e.is_beta&&(0,s.jsx)("span",{className:"rounded-xl text-[#0080FF] bg-[#D6F3FF] dark:bg-[#191E26] dark:text-[#EDF3FC] px-2 py-0.5 text-xs",children:"Beta"}),e.is_pro&&(0,s.jsx)("span",{className:"rounded-xl text-[#0080FF] bg-[#D6F3FF] dark:bg-[#191E26] dark:text-[#EDF3FC] px-2 py-0.5 text-xs",children:"Pro"})]})]},e.value))})]})]})},eV=l(93734),eq=e=>{let{dafaultTemplate:t,onCreate:l,onDelete:a,onUpdate:i,onConfirm:n,onCancel:r}=e,o=(0,_.useTranslations)(),d=(0,_.useLocale)(),{agentModelList:c}=(0,g.Z)(),[p,x]=(0,u.useState)(!1),[v,f]=(0,u.useState)({title:"",description:"",instructions:"",model:"",sourceType:B.gl,topicInfo:{title:"",id:""}}),[b,j]=(0,u.useState)(!1),[y,w]=(0,u.useState)("");(0,u.useEffect)(()=>{if(!t||!t.sub_topics[0])return;let{source_id:e,source_type:l,llm_model:s,instructions:a}=t.sub_topics[0];f({title:t.title||"",description:t.placeholder||"",instructions:a||"",model:s||"",sourceType:l||B.gl,topicInfo:{title:t.title||"",id:e||""}})},[t]);let N=()=>{r()},k=()=>({introduction:v.description,title:v.title,placeholder:"",sub_topics:[{title:v.title,source_type:v.sourceType,source_id:v.topicInfo.id,llm_model:v.model,instructions:v.instructions}],template_type:ei.W.CUSTOM,lang:d}),E=async()=>{j(!0);let e=k(),t=await (0,ea.YX)(e);t.data&&l(t.data),j(!1)},S=async()=>{j(!0);let e={...k(),short_id:(null==t?void 0:t.short_id)||""},l=await (0,ea._Z)(e);l.data&&(null==i||i(l.data),x(!1)),j(!1)},Z=async()=>{if(!t)return;let e=await (0,ea.hX)([t.short_id]);if(!e.success){q.Z.error((null==e?void 0:e.error)||o("delete_failed"));return}q.Z.success(o("delete_success")),null==a||a(t.id)};return(0,s.jsx)("div",{className:"flex-1 h-full",children:(0,s.jsxs)("div",{className:"flex flex-col h-full relative",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col h-full p-6 overflow-y-auto scrollbar",children:[(0,s.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium mb-2",children:[o("agent.agent_name"),(0,s.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[v.title.length,"/70"]})]}),(0,s.jsx)(eB.I,{value:v.title,onChange:e=>f(t=>({...t,title:e.target.value})),placeholder:o("agent.input_agent_name"),maxLength:70,disabled:!p&&!!t})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:o("agent.agent_description")}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[v.description.length,"/200"]})]}),(0,s.jsx)(ec.Y,{value:v.description,onChange:e=>f(t=>({...t,description:e.target.value})),placeholder:o("agent.input_agent_description"),maxLength:200,minRows:2,maxRows:5,isDisabled:!p&&!!t})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium",children:[o("agent.instructions"),(0,s.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[v.instructions.length,"/2000"]})]}),(0,s.jsx)(ec.Y,{value:v.instructions,onChange:e=>f(t=>({...t,instructions:e.target.value})),placeholder:o("agent.input_agent_prompt"),maxLength:2e3,minRows:3,maxRows:20,isDisabled:!p&&!!t})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mb-2",children:(0,s.jsx)("label",{className:"block text-sm font-medium",children:o("agent.model")})}),(0,s.jsx)(eW,{defaultValue:v.model,onChange:e=>{f(t=>({...t,model:e}))},disabled:!p&&!!t})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)("label",{className:"block text-sm font-medium",children:o("agent.sources")})}),(0,s.jsx)(eF.Z,{item:{title:v.topicInfo.title,source_type:v.sourceType,source_id:v.topicInfo.id},onChange:(e,t)=>{f(e=>({...e,sourceType:t.source_type})),t.source_type===B.RQ&&f(e=>({...e,topicInfo:{title:t.title,id:t.source_id}}))},index:1,children:(0,s.jsx)(h.z,{variant:"outline",size:"lg",className:"w-full",disabled:!p&&!!t,children:v.sourceType?o((0,eV.Y)(v.sourceType)):o("agent.manage_sources")})})]})]}),y&&(0,s.jsx)("div",{className:"mt-4 text-sm text-red-500",children:y})]}),(0,s.jsx)("div",{className:"flex-none flex items-center justify-between gap-2 px-6 py-4 border-t",children:t?(0,s.jsxs)("div",{className:(0,m.cn)("flex-1 flex space-x-2",p?"justify-between":"justify-end"),children:[p&&(0,s.jsx)(h.z,{variant:"destructive",size:"sm",onClick:Z,children:o("delete")}),p?(0,s.jsxs)("div",{className:"space-x-2",children:[(0,s.jsx)(h.z,{variant:"outline",onClick:()=>{x(!1)},children:o("cancel")}),(0,s.jsx)(h.z,{onClick:S,disabled:b,children:o("confirm")})]}):(0,s.jsx)("div",{className:"space-x-2",children:(0,s.jsx)(h.z,{onClick:()=>{null==n||n(t)},children:o("apply")})})]}):(0,s.jsxs)("div",{className:"flex-1 flex justify-end space-x-2",children:[(0,s.jsx)(h.z,{variant:"outline",size:"sm",onClick:()=>{N()},children:o("cancel")}),(0,s.jsx)(h.z,{size:"sm",onClick:E,disabled:b||!v.title||!v.instructions,children:o("confirm")})]})})]})})},eY=e=>{let{loading:t,isCreating:l,setIsCreating:a,onCreate:i}=e,n=(0,_.useTranslations)(),[r,o]=(0,u.useState)("search"),d=()=>{if(!ed.ZP.getState().isLogin){C.Z.getState().setLoginModalVisible(!0);return}a(!0)},c=e=>{i(e),a(!1)},m=()=>{a(!1)};return l?"search"===r?(0,s.jsx)(eM,{onCreate:c,onCancel:m}):(0,s.jsx)(eq,{onCreate:c,onCancel:m}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8 px-16 text-center ",children:[(0,s.jsx)("h3",{className:"text-xl font-medium mb-4",children:n("create_ai_search_agent")}),(0,s.jsx)("p",{className:"text-gray-500 mb-6",children:n("customize_your_ai_search_assistant")}),(0,s.jsx)("div",{className:"flex flex-col gap-4",children:(0,s.jsxs)(h.z,{size:"lg",className:"w-full h-12 text-base font-medium",disabled:t,onClick:()=>{d(),o("search"),(0,eb.fk)(ej.U.SEARCH_AGENT_CREATE,{name:"create_ai_search_agent"},!0)},children:[(0,s.jsx)(S.Z,{className:"w-5 h-5 mr-2"}),(0,s.jsx)("span",{children:n("create_ai_search_agent_button")})]})})]})},eG=l(57591),eJ=l(74926),eX=e=>{let{isOpen:t,onClose:l,handleEdit:a,onDelete:i,defaultItem:n}=e,r=(0,_.useTranslations)(),o=(0,ed.ZP)(e=>e.isLogin),d=async()=>{if(n){if(o){let e=await (0,ea.hX)([n.short_id]);if(!e.success){q.Z.error((null==e?void 0:e.error)||r("delete_failed"));return}}q.Z.success(r("delete_success")),i(n.id),l()}};return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(Y.Vq,{open:t,onOpenChange:l,children:(0,s.jsxs)(Y.cZ,{className:"max-w-xl w-full max-h-full",children:[(0,s.jsx)(Y.fK,{children:(0,s.jsx)(Y.$N,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2 mr-3",children:[(0,s.jsx)(eh.Z,{size:20}),(0,s.jsx)("span",{children:r("agent.agent_unavailable")})]})})}),(0,s.jsx)(Y.a7,{className:"pt-0",children:(0,s.jsx)("div",{className:"flex flex-col gap-2",children:o?r("agent.agent_unavailable_desc"):r("agent.agent_unavailable_desc_tip")})}),(0,s.jsxs)(Y.cN,{children:[o&&(0,s.jsx)(h.z,{onClick:a,variant:"outline",children:r("edit")}),(0,s.jsx)(h.z,{onClick:d,color:"primary",children:r("delete")})]})]})})})},eK=()=>{let{id:e}=(0,d.useRouter)().query;return e};let e$=[(0,s.jsx)(G.Z,{className:"h-4 w-4"},"barchart"),(0,s.jsx)(J.Z,{className:"h-4 w-4"},"linechart"),(0,s.jsx)(X.Z,{className:"h-4 w-4"},"wallet"),(0,s.jsx)(K.Z,{className:"h-4 w-4"},"settings"),(0,s.jsx)($.Z,{className:"h-4 w-4"},"share2"),(0,s.jsx)(P.Z,{className:"h-4 w-4"},"filetext"),(0,s.jsx)(S.Z,{className:"h-4 w-4"},"search"),(0,s.jsx)(Q.Z,{className:"h-4 w-4"},"bookopen"),(0,s.jsx)(R.Z,{className:"h-4 w-4"},"messagesquare"),(0,s.jsx)(ee.Z,{className:"h-4 w-4"},"target")],eQ="my-templates";var e0=e=>{var t;let{template:l,onOpenChange:a,onConfirm:i}=e,n=(0,_.useTranslations)(),r=(0,_.useLocale)(),o=(0,ed.ZP)(e=>e.isLogin),d=eK(),{tempTemplates:x}=(0,eJ.Z)(),[v,f,b]=(0,eG.Z)([]),[j,y]=(0,u.useState)(!1),[w,N]=(0,u.useState)(""),[k,E]=(0,u.useState)(eQ),[S,Z]=(0,u.useState)(null),[C,F]=(0,u.useState)(!0),[T,D]=(0,u.useState)(!1),[A,z]=(0,u.useState)(!1),[I,R]=(0,u.useState)(),P=(null===(t=v.find(e=>e.id===eQ))||void 0===t?void 0:t.children)||[],L=v.find(e=>e.id===k),{isOpen:M,onOpen:U,onClose:O}=(0,en.q)();null==L||L.children.find(e=>e.id===S);let H=null==L?void 0:L.children.find(e=>e.id===w),W=(0,u.useMemo)(()=>k===eQ&&0===P.length,[k,P.length]);(0,u.useEffect)(()=>{void 0!==o&&V()},[o]);let V=async()=>{F(!0);try{let e=[(0,ea.P)({language:r,system:!0})];o&&e.unshift((0,ea.P)({language:r,system:!1}));let t=await Promise.all(e),l=o?t[1]:t[0],a=o?t[0]:{success:!0,data:[]};(null==a?void 0:a.success)||q.Z.error((null==a?void 0:a.error)||n("error.get_user_templates_failed")),(null==l?void 0:l.success)||q.Z.error((null==l?void 0:l.error)||n("error.get_system_templates_failed"));let i=[...(null==a?void 0:a.data)||[],...((null==l?void 0:l.data)||[]).filter(e=>e.category)],d=G(i),c={id:"all",icon:(0,s.jsx)(et.Z,{className:"h-4 w-4"}),title:n("agent.all"),children:l.data||[]};f([c,...d]),Y()}catch(e){q.Z.error(n("error.get_templates_failed"))}finally{F(!1)}},Y=async()=>{if(!l||!b.current)return;E(eQ);let e=null;if(b.current.map(t=>{t.children.map(t=>{t.id===l.id&&(e=t)})}),e)J(e);else{let e={introduction:l.introduction,title:l.title,sub_topics:l.sub_topics,placeholder:l.placeholder,params:l.params,template_type:ei.W.CUSTOM,lang:r},t=await (0,ea.YX)(e);if(t.data){q.Z.success(n("agent.add_share_template_success")),Q(t.data);let e=window.location.pathname;history.replaceState({},"",e)}}},G=(0,u.useCallback)(e=>{let t=e.filter(e=>!e.system),l=e.filter(e=>e.system),a={id:eQ,icon:(0,s.jsx)(el.Z,{className:"h-4 w-4"}),title:n("my_templates"),children:t};return!o&&x.length&&a.children.unshift(...x),[a,...Object.entries(l.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{})).map((e,t)=>{let[l,s]=e;return{id:l.toLowerCase().replace(/\s+/g,"-"),icon:e$[t],title:l,children:s}})]},[n]),J=e=>{Z(e.id),R(e)},X=()=>{D(!1),N("")},K=()=>{R(void 0)},$=async e=>{let t=e.sub_topics.filter(e=>{var t;return e.source_type===B.RQ&&(null===(t=e.source_info)||void 0===t?void 0:t.is_self)===!1});if(t&&t.length>0){let l=await (0,ea.hi)(e.short_id);if(l.data&&l.data.length>0&&!t.every(e=>{var t;return null===(t=l.data)||void 0===t?void 0:t.some(t=>t.short_id===e.source_id&&"PUBLIC"===t.permission.read_permission)})){U();return}}null==i||i(e),(0,eb.fk)(e.system?ej.U.AGENT_SEARCH_USE:ej.U.AGENT_CREATE_USE,{value:1},!0)},Q=e=>{if(!b.current)return;let t=[...b.current];t.map(t=>{t.id===eQ&&t.children.unshift(e)}),f(t),E(eQ),z(!1),X(),J(e)},ee=e=>{var t;let l=[...v];l.map(t=>{t.id===eQ&&t.children.map(t=>{t.id===e.id&&(t.title=e.title,t.description=e.introduction,t.placeholder=e.placeholder,t.sub_topics=e.sub_topics,t.params=e.params,t.template_type=e.template_type)})}),f(l);let s=null===(t=l.find(e=>e.id===eQ))||void 0===t?void 0:t.children.find(t=>t.id===e.id);s&&J(s),X()},eo=e=>{let t=[...v];t.map(t=>{t.id===eQ&&(t.children=t.children.filter(t=>t.id!==e))}),f(t),Z(null),X(),K(),d===e&&c().push("/")},ec=async e=>{null==a||a(!1),c().push((0,p.MD)({query:"",multiQuery:e.map(e=>({query:e,category:g.Z.getState().extensionSelected}))}))};return(0,s.jsxs)("div",{className:"flex px-2 border-t min-h-[500px] max-h-[80vh] min-w-[900px] h-[550px] overflow-hidden",children:[(0,s.jsxs)("div",{className:(0,m.cn)("flex-none border-r p-4 min-w-[200px] flex flex-col overflow-y-auto scrollbar",(T||j)&&"opacity-50 pointer-events-none"),children:[(0,s.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("agent.recommend_templates")}),C?(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsx)(er.X,{className:"rounded-lg w-full h-8"}),(0,s.jsx)(er.X,{className:"rounded-lg w-full h-8"}),(0,s.jsx)(er.X,{className:"rounded-lg w-full h-8"})]}):v.map(e=>e.id===eQ?null:(0,s.jsxs)("div",{className:"flex items-center gap-2 rounded px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 ".concat(k===e.id?"bg-gray-100 dark:bg-gray-600":""),onMouseEnter:()=>{z(!1),E(e.id),k!==e.id&&(Z(null),X(),K())},children:[e.icon,(0,s.jsx)("span",{children:e.title})]},e.id))]}),(0,s.jsx)("div",{className:"flex-none",children:(0,s.jsxs)(h.z,{variant:"outline",className:(0,m.cn)("w-full flex items-center gap-2",k===eQ&&"bg-gray-100 dark:bg-gray-600"),onMouseEnter:()=>{z(!1),E(eQ),k!==eQ&&(Z(null),X(),K())},children:[(0,s.jsx)(el.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:n("my_templates")})]})})]}),(0,s.jsxs)("div",{className:(0,m.cn)("flex-none p-4 space-y-2 border-r max-w-[30%] overflow-y-auto scrollbar",!(null==L?void 0:L.children.length)&&"hidden",(T||j)&&"opacity-50 pointer-events-none"),children:[k===eQ&&o&&(0,s.jsxs)(h.z,{variant:"outline",className:(0,m.cn)("w-full flex items-center gap-2",A&&"bg-gray-100 dark:bg-gray-600"),onMouseEnter:()=>{z(!0)},children:[(0,s.jsx)(es.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:n("agent.add_template")})]}),null==L?void 0:L.children.map(e=>(0,s.jsx)("div",{className:"rounded px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 ".concat(S!==e.id||A?"":"bg-gray-100 dark:bg-gray-600"),onClick:()=>{$(e)},onMouseEnter:()=>{z(!1),J(e)},children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"truncate",children:e.title}),!o&&!e.system&&(0,s.jsx)("span",{className:"px-1.5 py-0.5 text-xs rounded bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 whitespace-nowrap",children:n("temp")})]})},e.id))]}),(0,s.jsx)("div",{className:"flex-1 relative flex flex-col overflow-y-auto scrollbar",children:W||A||!I?(0,s.jsx)(eY,{loading:C,isCreating:j,setIsCreating:y,onCreate:Q}):(0,s.jsx)("section",{className:"flex-1 h-full",children:[ei.W.CUSTOM,ei.W.DIRECT_DUTY].includes(I.template_type)?(0,s.jsx)(eq,{dafaultTemplate:I,onCreate:Q,onDelete:eo,onUpdate:ee,onConfirm:$,onCancel:()=>{}}):(0,s.jsx)(eI,{defaultItem:I,isUsing:!!(null==H?void 0:H.id),isEditing:T,setIsEditing:D,onSubmit:ec,tooltipOpen:U,callbacks:{onBack:X,onConfirm:$,onCreate:Q,onDelete:eo,onUpdate:ee}},S)})}),I&&(0,s.jsx)(eX,{isOpen:M,handleEdit:()=>{D(!0),O()},onClose:O,onDelete:eo,defaultItem:I})]})};l(79395);var e1=l(55994),e2=l(44509),e5=l(17436),e4=l(54047),e3=e=>{let{open:t,onOpenChange:l,onConfirm:a}=e,i=(0,_.useTranslations)(),{query:n,isReady:r}=(0,d.useRouter)();(0,ed.ZP)(e=>e.isLogin);let{tempTemplates:o,addTempTemplate:c}=(0,eJ.Z)(),{getList:m,inited:p}=(0,e5.Z)(),[h,x]=(0,u.useState)(void 0),v=(0,u.useRef)(null),{setShowAgentLimitModal:g,setShowLimitModalData:f}=(0,e4.Z)();return(0,u.useEffect)(()=>{!p&&t&&m()},[p,t]),(0,u.useEffect)(()=>{h&&sessionStorage.setItem(e1.o.AGENT_SHARE_TEMPLATE_ID,h.short_id)},[h]),(0,u.useEffect)(()=>{!t&&h&&x(void 0)},[t]),(0,s.jsx)(Y.Vq,{open:t,onOpenChange:l,children:(0,s.jsxs)(Y.cZ,{className:"max-w-5xl w-full max-h-full",ref:v,"aria-describedby":void 0,children:[(0,s.jsx)(Y.fK,{children:(0,s.jsx)(Y.$N,{children:i("extension.search_agent")})}),(0,s.jsx)(e0,{template:h,onOpenChange:l,onConfirm:e=>{if(!v.current)return;let t=C.Z.getState().isOpenThreadModal?"modal_search_form":"default_search_form";(0,e2.T)(v.current,t,()=>{null==a||a(e)})}})]})})},e6=l(37766),e8=l(75963);let e9=[B.zA,B.xn,B.X7];var e7=e=>{var t;let{isDisalbedExtension:l}=e,a=(0,_.useTranslations)(),i=(0,e8.useRouter)(),n=(0,e8.usePathname)(),r=(0,u.useRef)(!0),[o,d]=(0,u.useState)(!1),[c,p]=(0,u.useState)(!1),{isMobile:h,isReady:v}=(0,y.Z)(),f=(0,g.Z)(e=>e.extensionEnable),b=(0,g.Z)(e=>e.extensionSelected),j=(0,eJ.Z)(e=>e.template),w=(0,eJ.Z)(e=>e.setTemplate);(0,g.Z)(e=>e.extensionSelectedLoading),(0,g.Z)(e=>e.extensionSelectedErrorMsg);let N=(0,g.Z)(e=>e.setExtensionEnable),k=(0,g.Z)(e=>e.setExtensionSelectedLoading),E=()=>g.Z.getState().setExtensionError(void 0,""),{homeImages:Z,homeFiles:F,setPreviousSearchCategory:T}=(0,e6.Z)(),[D,Y]=(0,u.useState)(!1),G=[{value:B.gl,title:a("extension.all"),desc:a("extension.all_desc"),icon:(0,s.jsx)(S.Z,{size:20}),visible:!0,disable:!1},{value:B.aI,title:a("extension.chat"),desc:a("extension.chat_desc"),icon:(0,s.jsx)(I.Z,{size:20}),visible:!0,disable:!1},{value:B.pN,title:a("extension.social"),desc:a("extension.social_desc"),icon:(0,s.jsx)(R.Z,{size:20}),visible:!0,disable:!1},{value:B.Kp,title:a("extension.academic"),desc:a("extension.academic_desc"),icon:(0,s.jsx)(H.Od,{className:"w-5 h-5"}),visible:!0,disable:!1},{value:B.hs,title:a("extension.document"),desc:a("extension.document_desc"),icon:(0,s.jsx)(P.Z,{size:20}),visible:!0,disable:!1},{value:B.J5,title:a("extension.chat"),desc:a("extension.chat_desc"),icon:(0,s.jsx)(I.Z,{size:20}),visible:!1,disable:!1},{value:B.Ys,title:a("extension.chat"),desc:a("extension.chat_desc"),icon:(0,s.jsx)(I.Z,{size:20}),visible:!1,disable:!1}],J=(0,V.zd)()?[]:[{value:B.X7,title:a("extension.twitter"),desc:l?a("extension.disable_to_topic"):a("extension.twitter_desc"),icon:(0,s.jsx)(H.iB,{className:"w-5 h-5"}),visible:!0,disable:!!l}];(0,V.Eg)()&&(G=G.filter(e=>e.value!==B.hs));let X=[...G,...J],K=e=>{let{setExtensionSelected:t,setExtensionError:l}=g.Z.getState();(0,U.ev)().then(s=>{(0,W.n4)(s,B.dP)>=0?e():(N(!1),t("google"),l(void 0,O.e.AdvancedAssistantDisable))}).catch(e=>{N(!1),t("google"),l(void 0,O.e.AdvancedAssistantDisable)})},$=async e=>{let{setExtensionError:t,setExtensionSelected:l}=g.Z.getState(),{searchErrorModalVisible:s,setSearchErrorModalVisible:a}=C.Z.getState();if(!e9.includes(e)){d(!1),s||t(void 0,"");return}if(!f){d(!1),l("google"),t(void 0,O.e.AdvancedAssistantDisable),a(!0);return}k(!0);let i=!1;switch(e){case B.zA:await (0,U.i9)().then(l=>{l?(i=!0,E()):K(()=>{let{extensionEnable:l}=g.Z.getState();l&&(i=!0,t(e,O.e.LoginExpired))})});break;case B.xn:await new Promise(e=>{K(()=>{let{extensionEnable:t}=g.Z.getState();t&&(i=!0,E()),e(!0)})});break;case B.X7:await (0,U.lk)().then(l=>{let{extensionEnable:s}=g.Z.getState();l?(i=!0,E()):K(()=>{t(e,O.e.LoginExpired),s&&(i=!0)})})}k(!1),a(!i),d(!1),r.current=!1},Q=async e=>{if(T(e),v&&h&&(e===B.zA||e===B.X7||e===B.xn)){q.Z.info(a("useInBrowser"));return}let{setExtensionSelected:t}=g.Z.getState();t(e),e!==B.Wh&&(null==n?void 0:n.includes("/agents"))&&i.push("/search")},ee=async e=>{p(!1);let t=await (0,eA.Y)(e.title),l=(0,ez.b)(t);i.push("/agents/".concat(l,"-").concat(e.short_id))};return(0,u.useEffect)(()=>{if(l){o&&d(!1);return}void 0!==f&&$(b)},[f,b]),(0,u.useEffect)(()=>{!j&&(null!=n&&n.includes("/agents")||Q(G[0].value))},[]),(0,u.useEffect)(()=>{(null==F?void 0:F.length)||(null==Z?void 0:Z.length)?Y(!0):Y(!1)},[F,Z]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(z.J2,{open:o,onOpenChange:d,children:[(0,s.jsx)(x.e,{delay:0,closeDelay:0,content:D?a("searchAddition.switch_search_mode_tip"):a("extension.search_range_desc"),classNames:{content:["text-white bg-gray-600 dark:bg-[#353535]"]},isDisabled:D,children:(0,s.jsx)("div",{className:"max-w-fit",children:(0,s.jsx)(z.xo,{asChild:!0,children:(0,s.jsxs)(A.A,{variant:"light",size:"sm",className:"text-[#30394A] dark:text-[#FFFFFF] border-1 border-[#E6E9EF] dark:border-[#545D6F] px-2 py-2 gap-1 text-sm rounded-lg",disabled:D,color:"default",isDisabled:D,children:[(0,s.jsx)("span",{className:"max-w-[150px] truncate",children:j?j.title:null===(t=X.find(e=>e.value===b))||void 0===t?void 0:t.title}),o?(0,s.jsx)(L.Z,{className:"w-4 h-4"}):(0,s.jsx)(M.Z,{className:"w-4 h-4"})]})})})}),(0,s.jsx)(z.yk,{className:"w-auto p-0 rounded-xl shadow-lg",align:"start",children:(0,s.jsxs)("section",{className:"w-[40em] max-w-[90vw]",children:[(0,s.jsx)("h2",{className:"px-6 pt-4 text-xs font-semibold opacity-60",children:a("extension.search_range")}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-1 p-2 text-sm",children:X.slice(0,(0,V.vU)()?G.length:X.length).map((e,t)=>{if(!e.visible)return;let l=e.disable;return(0,s.jsxs)("button",{className:(0,m.cn)("rounded-lg p-4 text-left",l?"text-gray-400":"hover:bg-[#E6E9EF] dark:hover:bg-[#454E5D] cursor-pointer",!l&&b===e.value&&"text-blue-500"),autoFocus:!l&&b===e.value,onClick:e.onClick?e.onClick:()=>{l||(j&&w(void 0),Q(e.value))},children:[(0,s.jsxs)("span",{className:"flex items-center font-medium mb-1",children:[e.icon,(0,s.jsx)("span",{className:"ml-2",children:e.title}),e.isBeta&&(0,s.jsx)("span",{className:"ml-2 rounded text-gray-500 bg-gray-200 dark:bg-theme-bg-dark-300 px-2 py-0.5 text-xs",children:"Beta"})]}),(0,s.jsx)("span",{className:"opacity-50",children:e.desc})]},t)})})]})})]}),(0,s.jsx)(e3,{open:c,onOpenChange:p,onConfirm:ee})]})},te=e=>{let{isDisalbedExtension:t}=e,l=(0,_.useTranslations)(),a=(0,g.Z)(e=>e.extensionSelected),i=[{value:B.gl,title:l("extension.all"),isDisabled:!1},{value:B.pN,title:l("extension.social"),isDisabled:!1},{value:B.X7,title:l("extension.twitter"),isDisabled:t},{value:B.Kp,title:l("extension.academic"),isDisabled:!1},{value:B.aI,title:l("extension.chat"),isDisabled:!1},{value:B.hs,title:l("extension.document"),isDisabled:!1}],n=(e,t)=>{e.preventDefault();let{setExtensionSelected:l}=g.Z.getState();l(t)};return(0,s.jsxs)("div",{className:"px-4 py-3 text-sm border-t border-[#dbe2e9] dark:border-zinc-700",children:[(0,s.jsxs)("span",{className:"mr-4",children:[l("extension.search_range"),":"]}),i.map(e=>(0,s.jsx)("a",{href:"",className:(0,Z.Z)("mr-2",a===e.value?"text-blue-500":"text-zinc-400",e.isDisabled&&"cursor-not-allowed opacity-50"),onClick:t=>{if(e.isDisabled){t.preventDefault();return}n(t,e.value)},children:e.title},e.value))]})},tt=l(13263),tl=l(27585);let ts=(e,t)=>{let l=(0,tl.lx)(e);return Object.keys(t).forEach(e=>l.searchParams.append(e,t[e])),l.toString()};var ta=l(52166);let ti=e=>{let{query:t}=e,l=(0,ta.a1)();return fetch(ts("".concat(b.XJ,"/official-website"),{query:t}),{method:"GET",headers:{Authorization:"".concat(l)}}).then(async e=>200!==e.status?Promise.reject([]):await e.json()).catch(e=>[])};var tn=l(2240),tr=function(e){let{enable:t,value:l,debouncedValue:s,inputRef:a}=e;(0,_.useTranslations)();let[i,n]=(0,u.useState)([]),r=(0,tn.Z)(),[o,d]=(0,u.useState)([]),[c,m]=(0,u.useState)(-1),p=o.length>0||i.length>0&&i[0],h=e=>{a.current&&(-1===e?a.current.value=l:a.current.value=x[e].title)};(0,u.useEffect)(()=>{var e,i;if(!l||!t||g.Z.getState().extensionSelected===B.aI||g.Z.getState().extensionSelected===B.J5||g.Z.getState().extensionSelected===B.Ys||(null===(e=e6.Z.getState().homeImages)||void 0===e?void 0:e.length)||(null===(i=e6.Z.getState().files)||void 0===i?void 0:i.length)){n([]);return}s&&ti({query:l}).then(e=>{var t;(null===(t=a.current)||void 0===t?void 0:t.value)===l&&n(e)})},[s]),(0,u.useEffect)(()=>{var e,s;if(!l||!t||g.Z.getState().extensionSelected===B.aI||g.Z.getState().extensionSelected===B.J5||(null===(e=e6.Z.getState().files)||void 0===e?void 0:e.length)||g.Z.getState().extensionSelected===B.Ys||(null===(s=e6.Z.getState().homeImages)||void 0===s?void 0:s.length)){d([]);return}(0,tt.a5)({keywords:l}).then(e=>{var t;(null===(t=a.current)||void 0===t?void 0:t.value)===l&&d(e)}).catch(e=>{console.warn("getQuestion Error:",e)})},[s]),(0,u.useEffect)(()=>{m(-1)},[l]);let x=(0,u.useMemo)(()=>[{title:"traditionalSearch",type:"websearch"},...i.map(e=>({...e,type:"site"})),...o.map(e=>({title:e,type:"question"}))].splice(0,8),[o,i]);return{results:x,dropDownSelected:c,setDropDownSelected:m,showQueryDropdownMenu:p,reduceSearchResult:()=>{if(!r.current)return;let e=0;if(-1===c&&(e=x.length-1),c>-1&&(e=c-1),0===e){m(e);return}m(e),h(e)},addSearchResult:()=>{if(!r.current)return;let e=0;if(c===x.length-1&&(e=-1),c<x.length-1&&(e=c+1),0===e){m(e);return}m(e),h(e)}}},to=l(41847),td=l(52597),tc=l(65105),tu=l(96156),tm=l(84706),tp=l(50464),th=l(70113),tx=l(51054),tv=l(72070),tg=l.n(tv),tf=e=>{let{file:t}=e,{removeHomeImageSById:l}=(0,e6.Z)();return(0,s.jsxs)("div",{className:(0,Z.Z)("relative group","items-center justify-between gap-1 text-xs  text-gray-500 rounded","p-0","border border-gray-100","hover:bg-[#EDFAFF] dark:hover:bg-[#3E536E]"),children:[(0,s.jsx)("div",{className:"flex items-center gap-1",children:(0,s.jsxs)("div",{className:"w-16 h-16 flex items-center justify-center relative",children:[(0,s.jsx)(tg(),{className:(0,Z.Z)("object-cover","rounded","!w-full !h-full"),src:t.url,alt:t.title,width:72,height:72}),(0,s.jsx)("div",{className:(0,Z.Z)("absolute top-0 right-0","flex flex-col","w-full h-full","justify-center items-center","rounded","bg-gray-800/60","text-white text-xs",(null==t?void 0:t.status)!=="completed"?"flex":"hidden"),children:(null==t?void 0:t.status)=="error"?(0,s.jsx)(eh.Z,{className:"text-red-400"}):(null==t?void 0:t.progress)<=0?(0,s.jsx)(tx.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading..."}):(0,s.jsx)(tx.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading...",value:(null==t?void 0:t.progress)||0,showValueLabel:!0})})]})}),(null==t?void 0:t.status)==="completed"&&(0,s.jsx)("div",{className:(0,Z.Z)("absolute -top-2 -right-2","group-hover:block"),children:(0,s.jsx)(A.A,{size:"sm",radius:"full",className:(0,Z.Z)("p-0 m-0 h-4 w-4 min-w-0 min-h-0","border-0","bg-[#3D4C67] text-white/80","hover:bg-[#3D4C67] hover:opacity-100"),startContent:(0,s.jsx)(r.Z,{size:12,className:"rounded-full"}),onPress:()=>{l([null==t?void 0:t.id])}})})]})},t_=l(70262),tb=l(48518),tj=l(78236),ty=()=>{let e=(0,d.useRouter)(),t=(0,eJ.Z)(e=>e.template),l=(0,g.Z)(e=>e.isResearch),s=(0,g.Z)(e=>e.extensionSelected),a=(0,g.Z)(e=>e.proSelected),i=(0,eJ.Z)(e=>e.category),{homeFiles:n}=(0,tj.Z)(),r=(0,u.useMemo)(()=>B.iu.find(e=>e===s)&&a,[s,a]),o=(0,u.useMemo)(()=>{var e;return null==n?void 0:null===(e=n.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===e?void 0:e.length},[n]);return{goToSearchDetailPage:s=>{var a,n,d;let{query:c,category:u,action:m}=s;if(!c&&!t)return;let h={query:c};if(r&&l||t){if((null==t?void 0:t.template_type)===ei.W.CUSTOM){tb.Z.getState().setTemplateData({templateQuery:c,template:t});let e=t.sub_topics[0].source_type;h.category=e,h.model=t.sub_topics[0].llm_model,e===B.RQ&&(h.topicId=t.sub_topics[0].source_id)}else{eJ.Z.getState().openAgentPlanModal(c);return}}if(!c)return;let x=(null===(a=e6.Z.getState().homeFiles)||void 0===a?void 0:a.filter(e=>!(null==e?void 0:e.threadId)))||[],v=null==x?void 0:x.filter(e=>(null==e?void 0:e.status)==="completed"),g=e6.Z.getState().homeImages||[],f=null==g?void 0:g.filter(e=>(null==e?void 0:e.status)==="completed");u===B.J5?(h.category=B.J5,h.documents=null==v?void 0:null===(n=v.map(e=>null==e?void 0:e.id))||void 0===n?void 0:n.join(",")):(h.category=B.Ys,h.documents=null==f?void 0:null===(d=f.map(e=>null==e?void 0:e.id))||void 0===d?void 0:d.join(",")),m&&(h.documentAction=m),t&&(h.templateId=t.id,h.category="long_text"===i&&o?B.J5:i);let _=(0,p.MD)(h);e.push(_,void 0,{scroll:!0})}}},tw=()=>{var e;let t=(0,_.useTranslations)(),{homeImages:l,homeImageSQustions:a,setIsGoToSearch:i,isGoToSearch:n}=(0,e6.Z)(),{goToSearchDetailPage:r}=ty(),{isOpenThreadModal:o,closeThreadModal:d}=(0,C.Z)(),{extensionSelected:c}=(0,g.Z)(),m=(0,g.Z)(e=>e.isResearch),p=e=>{let{query:t,action:l}=e;i(!0),!0===o&&d(),r({query:t,action:l})};return((0,u.useCallback)(()=>{i(!1)},[]),0===l.length)?null:(0,s.jsxs)("div",{className:(0,Z.Z)("px-0 pb-4 mx-3","flex flex-wrap gap-2 items-end","border-b border-[#dbe2e9]/60 dark:border-[#545D6F]"," bg-white dark:bg-transparent"),children:[l.map(e=>(0,s.jsx)(tf,{file:e},e.id)),c===B.Ys&&!m&&(null===(e=l.filter(e=>"completed"===e.status))||void 0===e?void 0:e.length)?(0,s.jsxs)("div",{className:"flex items-center gap-2 ml-2",children:[(0,s.jsx)(A.A,{color:"secondary",size:"sm",className:(0,Z.Z)("px-1 py-1.5 min-h-0 h-auto text-[#596B87]","bg-[#EDFAFF] dark:bg-[#25364DCC] dark:text-white/90"),onPress:()=>p({query:t(t_.Tp.answer),action:"explain"}),isDisabled:n,children:t(t_.Tp.answer)},"answer"),a.map(e=>(0,s.jsx)(A.A,{color:"secondary",size:"sm",className:(0,Z.Z)("px-1 py-1.5 min-h-0 h-auto text-[#596B87]","bg-[#EDFAFF] dark:bg-[#25364DCC]  dark:text-white/90"),onPress:()=>p({query:t(t_.Tp[e.type]),action:e.type}),isDisabled:n,children:t(t_.Tp[e.type])},e.type))]}):null]})},tN=l(64412),tk=l(79736),tE=l(52502);let tS=e=>{let{icon:t}=e,l=(0,_.useTranslations)(),a={initial:{scale:0,opacity:0},animate:e=>({scale:[0,1,0],opacity:[0,1,0],x:[0,12*e,20*e],y:[0,-10,-20],transition:{duration:2,repeat:1/0,delay:.2*e,ease:"easeOut"}})},i={initial:{opacity:0},animate:e=>({opacity:[0,1,0],transition:{duration:1.5,repeat:1/0,delay:.2*e,ease:"easeInOut"}})};return(0,s.jsx)(tk.M,{children:(0,s.jsxs)(tE.E.div,{className:"relative flex items-center justify-center gap-2 h-full",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,s.jsxs)("div",{className:"relative w-10 h-10",children:[(0,s.jsx)(tE.E.div,{className:"absolute inset-0 rounded-full bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400",variants:{initial:{scale:.8,opacity:0},animate:{scale:[.8,1.2,.8],opacity:[.3,.6,.3],transition:{duration:2,repeat:1/0,ease:"easeInOut"}}},initial:"initial",animate:"animate",style:{filter:"blur(8px)"}}),(0,s.jsx)(tE.E.div,{className:"absolute inset-0 rounded-full border border-white/20",initial:{scale:.9,opacity:0},animate:{scale:[.9,1.2,.9],opacity:[.2,.4,.2]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut",delay:.3}}),(0,s.jsx)(tE.E.div,{className:"absolute inset-0 flex items-center justify-center",variants:{initial:{scale:0,rotateY:-180},animate:{scale:1,rotateY:0,transition:{type:"spring",damping:15,stiffness:100}}},initial:"initial",animate:"animate",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"w-5 h-5 text-white z-10 relative flex items-center justify-center",children:t||(0,s.jsx)(P.Z,{className:"w-5 h-5"})}),(0,s.jsx)(tE.E.div,{className:"absolute z-10 inset-x-0 h-0.5 bg-gradient-to-r from-transparent via-cyan-400 to-transparent",variants:{initial:{y:-40,opacity:0},animate:{y:15,opacity:[0,1,1,0],transition:{y:{repeat:1/0,duration:2,ease:"linear"},opacity:{repeat:1/0,duration:2,ease:"easeInOut"}}}},initial:"initial",animate:"animate",style:{boxShadow:"0 0 10px 2px rgba(34, 211, 238, 0.6)",width:"120%",left:"-10%"}})]})}),[1,-1,.5,-.5].map((e,t)=>(0,s.jsx)(tE.E.div,{className:"absolute top-1/2 left-1/2",custom:e,variants:a,initial:"initial",animate:"animate",children:(0,s.jsx)("div",{className:"w-1 h-1 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full"})},t)),(0,s.jsxs)(tE.E.svg,{className:"absolute inset-0 w-full h-full",animate:{rotate:360},transition:{duration:8,repeat:1/0,ease:"linear"},children:[(0,s.jsx)("circle",{cx:"20",cy:"20",r:"18",fill:"none",stroke:"url(#gradient)",strokeWidth:"1",strokeDasharray:"4 6",opacity:"0.3"}),(0,s.jsx)("defs",{children:(0,s.jsxs)("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,s.jsx)("stop",{offset:"0%",stopColor:"#60A5FA"}),(0,s.jsx)("stop",{offset:"50%",stopColor:"#A78BFA"}),(0,s.jsx)("stop",{offset:"100%",stopColor:"#F472B6"})]})})]})]}),(0,s.jsxs)(tE.E.div,{className:"flex items-center gap-0.5 ml-1",variants:{initial:{opacity:0,y:10},animate:{opacity:1,y:0,transition:{duration:.5,ease:"easeOut"}}},initial:"initial",animate:"animate",children:[(0,s.jsx)("span",{className:"text-white text-[10px] font-medium",children:l("fileAnalyzing")}),(0,s.jsx)("div",{className:"flex gap-px",children:[0,1,2].map(e=>(0,s.jsx)(tE.E.span,{className:"w-0.5 h-0.5 bg-white rounded-full",custom:e,variants:i,initial:"initial",animate:"animate"},e))})]})]})})};var tZ=e=>{var t;let{file:l}=e,a=(0,_.useTranslations)(),{removeHomeFilesById:i}=(0,e6.Z)();return(0,s.jsxs)("div",{className:(0,Z.Z)("relative group","items-center justify-between gap-1 text-xs  text-gray-500 rounded","p-0","bg-gray-50 dark:bg-gray-700"),children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("div",{className:"max-w-52 flex items-center justify-start relative p-2 ",children:[(0,s.jsx)("div",{className:"w-5",children:(0,s.jsx)(tN.Z,{fileName:l.title,w:5,h:5})}),(0,s.jsxs)("div",{className:"ml-2",children:[(0,s.jsx)("div",{className:"text-sm truncate w-36 dark:text-white/90",children:l.title}),(0,s.jsxs)("div",{className:"text-[12px] text-gray-400 ",children:[(null==l?void 0:l.type)?"".concat(null===t_.Sj||void 0===t_.Sj?void 0:null===(t=t_.Sj[l.type])||void 0===t?void 0:t.toLocaleUpperCase()," / "):"",(0,t_.cn)(l.size)," ",(null==l?void 0:l.pages)?"/ ".concat(a("searchAddition.file_pages",{pages:l.pages})):""]})]}),(0,s.jsx)("div",{className:(0,Z.Z)("absolute top-0 right-0","flex flex-col","w-full h-full","justify-center items-center","rounded","bg-gray-800/60","text-white text-xs",(null==l?void 0:l.status)!=="completed"?"flex":"hidden"),children:(null==l?void 0:l.status)=="error"?(0,s.jsx)(eh.Z,{className:"text-red-400"}):(null==l?void 0:l.status)==="analyzing"?(0,s.jsx)(tS,{icon:(0,s.jsx)(tN.Q,{fileName:l.title,w:5,h:5})}):(null==l?void 0:l.progress)<=0?(0,s.jsx)(tx.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading..."}):(0,s.jsx)(tx.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading...",value:(null==l?void 0:l.progress)||0,showValueLabel:!0})})]})}),(null==l?void 0:l.status)==="completed"&&(0,s.jsx)("div",{className:(0,Z.Z)("absolute -top-2 -right-2","group-hover:block"),children:(0,s.jsx)(A.A,{size:"sm",radius:"full",className:(0,Z.Z)("p-0 m-0 h-4 w-4 min-w-0 min-h-0","border-0","bg-[#3D4C67] text-white/80","hover:bg-[#3D4C67] hover:opacity-100"),startContent:(0,s.jsx)(r.Z,{size:12,className:"rounded-full"}),onPress:()=>{i([null==l?void 0:l.id])}})})]})},tC=l(78017),tF=()=>{var e;let t=(0,_.useTranslations)(),{homeFiles:l,setIsGoToSearch:a,isGoToSearch:i,isUploading:n}=(0,e6.Z)(),{goToSearchDetailPage:r}=ty(),{isOpenThreadModal:o,closeThreadModal:d}=(0,C.Z)(),{extensionSelected:c}=(0,g.Z)(),m=(0,g.Z)(e=>e.isResearch),p=(0,eJ.Z)(e=>e.template),h=(0,u.useMemo)(()=>!!p&&!!p.code&&[tC.m5,tC.PZ].includes(p.code),[p]),x=e=>{let{query:t}=e;a(!0),!0===o&&d(),r({query:t,category:B.J5,action:"summary"})};return((0,u.useEffect)(()=>{a(!1)},[]),0===l.length)?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:(0,Z.Z)("px-0 pt-2 pb-4","flex flex-nowrap gap-3 items-end w-[calc(100%-30px)] overflow-x-auto"," bg-white dark:bg-transparent","scrollbar"),children:[l.map(e=>(0,s.jsx)(tZ,{file:e},e.id)),!h&&c===B.J5&&(null==p?void 0:p.template_type)!==ei.W.DIRECT_DUTY&&!m&&(null===(e=l.filter(e=>"completed"===e.status))||void 0===e?void 0:e.length)>0&&(0,s.jsx)("div",{className:"flex items-center gap-2 ml-2",children:(0,s.jsx)(A.A,{color:"secondary",size:"sm",className:(0,Z.Z)("px-1 py-1.5 min-h-0 h-auto text-[#596B87] bg-[#EDFAFF]","dark:bg-[#25364DCC] dark:text-white/90"),onPress:()=>x({query:t("searchAddition.summary_file")}),isDisabled:i||n,children:t("searchAddition.summary_file")},"answer")})]}),(0,s.jsx)("hr",{className:(0,Z.Z)("mt-0 mb-4 border-0","h-[1px] overflow-hidden","bg-[#dbe2e9]/60 dark:bg-[#545D6F]")})]})},tT=l(56885),tD=l(26894),tA=l(88708),tz=l(39109),tI=l(31510),tR=l(13366),tP=l(26949),tL=e=>{let{value:t,label:l,icon:a}=e;return(0,s.jsxs)(tP.SP,{value:t,className:(0,Z.Z)("gap-1 px-2","rounded-full text-[#8896AA] text-xs h-8 font-normal rounded-md","data-[state=active]:bg-[#FFFFFF] data-[state=active]:shadow-none data-[state=active]:text-primary","dark:data-[state=active]:bg-[#353B46]"),children:[a,l]})},tM=l(37067),tB=l(6967),tU=l(25568),tO=l(31162),tH=e=>{var t;let{file:l}=e,a=(0,_.useTranslations)(),{removeHomeFilesById:i}=(0,tj.Z)();return(0,s.jsxs)("div",{className:(0,Z.Z)("relative group","items-center justify-between gap-1 text-xs  text-gray-500 rounded","p-0","bg-[#F7F7F9] dark:bg-[#374251]"),children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("div",{className:"max-w-52 flex items-center justify-start relative p-2 h-14",children:[(0,s.jsx)("div",{className:"w-5",children:(0,s.jsx)(tN.Z,{fileName:l.title,w:5,h:5})}),(0,s.jsxs)("div",{className:"ml-2",children:[(0,s.jsx)("div",{className:(0,Z.Z)("text-sm truncate dark:text-white/90","sm:w-36 w-20"),children:l.title}),(0,s.jsxs)("div",{className:"text-[12px] text-gray-400 ",children:[(null==l?void 0:l.type)?"".concat(null===t_.Sj||void 0===t_.Sj?void 0:null===(t=t_.Sj[l.type])||void 0===t?void 0:t.toLocaleUpperCase()," / "):"",(0,t_.cn)(l.size)," ",(null==l?void 0:l.pages)?"/ ".concat(a("searchAddition.file_pages",{pages:l.pages})):""]})]}),(0,s.jsx)("div",{className:(0,Z.Z)("absolute top-0 right-0","flex flex-col","w-full h-full","justify-center items-center","rounded","bg-gray-800/60","text-white text-xs",(null==l?void 0:l.status)!=="completed"?"flex":"hidden"),children:(null==l?void 0:l.status)=="error"?(0,s.jsx)(eh.Z,{className:"text-red-400"}):(null==l?void 0:l.status)==="analyzing"?(0,s.jsx)(tS,{icon:(0,s.jsx)(tN.Q,{fileName:l.title,w:5,h:5})}):(null==l?void 0:l.progress)<=0?(0,s.jsx)(tx.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading..."}):(0,s.jsx)(tx.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading...",value:(null==l?void 0:l.progress)||0,showValueLabel:!0})})]})}),(null==l?void 0:l.status)==="completed"&&(0,s.jsx)("div",{className:(0,Z.Z)("absolute -top-2 -right-2","group-hover:block"),children:(0,s.jsx)(A.A,{size:"sm",radius:"full",className:(0,Z.Z)("p-0 m-0 h-4 w-4 min-w-0 min-h-0","border-0","bg-[#3D4C67] text-white/80","hover:bg-[#3D4C67] hover:opacity-100"),startContent:(0,s.jsx)(r.Z,{size:12,className:"rounded-full"}),onPress:()=>{i([null==l?void 0:l.id])}})})]})},tW=()=>{let e=(0,tj.Z)(e=>e.homeFiles);return 0===e.length?null:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:(0,Z.Z)("p-0 m-0 pt-2"," relative z-10","flex flex-nowrap gap-3 items-end w-[calc(100%-30px)] overflow-x-auto","bg-white dark:bg-transparent","scrollbar"),children:e.map(e=>(0,s.jsx)(tH,{file:e},e.id))})})},tV=l(41223),tq=l(38058),tY=l(21230);let tG=e=>{let{type:t="home",threadId:l}=e,s=(0,_.useTranslations)(),a=(0,tz.Z)(),i=(0,tc.WI)(),n=(0,tc.P2)(),r=(0,tc.Oi)("chatDocumentsUsage"),{homeFiles:o,files:d,threadFiles:c,setHomeFiles:m,setFiles:p,setIsUploading:h,setCurrentFileProgress:x,setNThUpload:v}=(0,tj.Z)(),g=()=>"home"===t?tj.Z.getState().homeFiles:tj.Z.getState().files,f=(0,u.useMemo)(()=>r?t_.Mr:t_.CD,[r]),b=(0,u.useMemo)(()=>{if(!r){var e,t;return(null!==(t=null==n?void 0:null===(e=n.chatDocumentsUsage)||void 0===e?void 0:e.balance)&&void 0!==t?t:0)<=0}return!1},[null==n?void 0:n.chatDocumentsUsage,r]),j=()=>{var e,l;return"home"===t?(null===(e=tj.Z.getState().homeFiles)||void 0===e?void 0:e.length)||0:(null===(l=tj.Z.getState().files)||void 0===l?void 0:l.length)||0},y=e=>{let{type:t}=e,s="home"===t?tj.Z.getState().homeFiles:tj.Z.getState().files,a=tj.Z.getState().threadFiles;return Array.from(new Set([...(l?(null==s?void 0:s.filter(e=>(null==e?void 0:e.threadId)===l))||[]:(null==s?void 0:s.filter(e=>!(null==e?void 0:e.threadId)))||[]).map(e=>null==e?void 0:e.id),...(l&&(null==a?void 0:a.filter(e=>(null==e?void 0:e.threadId)===l))||[]).map(e=>null==e?void 0:e.id)]))},w=(0,u.useMemo)(()=>{var e;return(null===(e=y({type:t}))||void 0===e?void 0:e.length)>f},[f]),N=(0,u.useMemo)(()=>i?t_.fc:t_.r0,[i]),k=(0,u.useMemo)(()=>{let e="home"===t?o||[]:d||[],s=l&&(null==c?void 0:c.filter(e=>(null==e?void 0:e.threadId)===l))||[];return Array.from(new Set([...e,...s].map(e=>e.id))).map(t=>[...e,...s].find(e=>e.id===t)).reduce((e,t)=>{var l;return e+(null!==(l=null==t?void 0:t.words)&&void 0!==l?l:0)},0)>N},[t,o,d,l,c,N]),E=(0,u.useMemo)(()=>i?s("searchAddition.max_words"):s("searchAddition.max_words_free"),[i]),S=e=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain","text/csv","application/csv"].includes(e.type)?e.size>26214400?(a.default(s("searchAddition.size_limit_exceeded_tip",{size:25,pages:500})),!1):k?(a.default(s("searchAddition.thread_words_limit_exceeded_tip",{words:E})),!1):!w||(i||tm.$.publish("showSubscriptionPlan",void 0),a.default(s("searchAddition.thread_upload_limit_exceeded_tip",{count:f})),!1):(a.default(s("topic.error_file_type_not_supported")),!1),Z=e=>{var l;let s=null!==(l=tj.Z.getState().currentFileProgress)&&void 0!==l?l:0,a=setInterval(()=>{var l,i;let n=g();s=(null!==(i=null===(l=n.find(t=>t.id===e))||void 0===l?void 0:l.progress)&&void 0!==i?i:s)+(1.9*Math.random()+.1),"home"===t?m(n.map(t=>t.id===e?{...t,progress:Math.min(s,95),status:"analyzing"}:t)):p(n.map(t=>t.id===e?{...t,progress:Math.min(s,95),status:"analyzing"}:t)),s>=95&&clearInterval(a)},800);return a};return{handleFiles:async e=>{var n,r,o,d,c;if(tj.Z.getState().isUploading)return;if(b){tm.$.publish("showSubscriptionPlan",void 0);return}if(w)return;let u=null===(n=y({type:t}))||void 0===n?void 0:n.length;if((null!==(r=null==e?void 0:e.length)&&void 0!==r?r:0)+u>f){if(!i){tm.$.publish("showSubscriptionPlan",void 0);return}a.default(s("searchAddition.thread_upload_limit_exceeded_tip",{count:f}));return}v((null!==(o=tj.Z.getState().nThUpload)&&void 0!==o?o:0)+1);let _=Array.from(e);for(let[e,s]of(h(!0),Array.from(_).entries())){let a=g(),i=null!==(d=tj.Z.getState().nThUpload)&&void 0!==d?d:0,n="".concat(i,"_").concat(e),r=[{id:n,title:s.name,size:(0,t_.sS)(s.size),token:0,pages:0,progress:0,status:"uploading",type:s.type,created_at:new Date().toISOString(),modified_at:new Date().toISOString(),length:0,words:0,threadId:l||"",tempId:n}];"home"===t&&m([...r,...a])}let C=new Map;for(let[e,n]of Array.from(_).entries()){let r=null!==(c=tj.Z.getState().nThUpload)&&void 0!==c?c:0,o="".concat(r,"_").concat(e);h(!0),x(0);try{if(await (0,tq.Wl)()){if(i?a.default(s("searchAddition.upload_limit_exceeded_tip")):tm.$.publish("showSubscriptionPlan",void 0),h(!1),x(0),"home"===t){let e=g();m((0,t_._n)({files:e,tempId:o}))}continue}}catch(e){if(a.default(s("server.INTERNAL_SERVER_ERROR")),h(!1),x(0),"home"===t){let e=g();m((0,t_._n)({files:e,tempId:o}))}continue}let d="";if(!S(n)){if("home"===t){let e=g();m((0,t_._n)({files:e,tempId:o}))}h(!1),x(0);continue}(0,eb.fk)(ej.U.SEAECH_FILE,{fileName:n.name},!0),h(!0);let u=(0,t_.ct)(0,e=>{if(x(null!=e?e:0),"home"===t){let t=g();m((0,t_._n)({files:t,tempId:o})),m(t.map(t=>t.tempId===o?{...t,progress:e}:t))}});"1"!==(0,t_.y6)()&&(0,t_.ny)();try{C.set(n.name,!0),await (0,eT.Vj)({file:n,threadId:l||"",queryParams:(0,tY.x)(n.type)?{from:"agent"}:void 0,onProgress:s=>{if(d||(d=s.file_id),!C.has(d)){var a,i;let r=null!==(a=tj.Z.getState().nThUpload)&&void 0!==a?a:0,o=g(),c="home"===t?o.map(t=>t.tempId==="".concat(r,"_").concat(e)?{...t,id:d}:t):[{id:d,title:n.name,size:(0,t_.sS)(n.size),token:0,pages:0,progress:null!==(i=tj.Z.getState().currentFileProgress)&&void 0!==i?i:0,status:"uploading",type:n.type,created_at:new Date().toISOString(),modified_at:new Date().toISOString(),length:(null==s?void 0:s.length)||0,words:(null==s?void 0:s.words)||0,threadId:l||""}];"home"===t?m([...c]):p([...c,...o]);let u=Z(d);C.set(d,u),C.delete(n.name)}},onDone:e=>{if(u(),C.has(d)&&(clearInterval(C.get(d)),C.delete(d)),(null==e?void 0:e.status)==="SUCCESS"){var l;let i=g(),n=i.reduce((e,t)=>{var l;return e+(null!==(l=null==t?void 0:t.words)&&void 0!==l?l:0)},0);if(k||n+(null!==(l=null==e?void 0:e.words)&&void 0!==l?l:0)>N){if(a.default(s("searchAddition.thread_words_limit_exceeded_tip",{words:E})),"home"===t){let e=g();m((0,t_.mF)({files:e,id:d}))}else p([...(0,t_.mF)({files:i,id:d})]);h(!1);return}"home"===t?m(i.map(t=>t.id===d?{...t,progress:100,words:(null==e?void 0:e.words)||0,pages:(null==e?void 0:e.page_count)||0,status:"completed"}:t)):p(i.map(t=>t.id===d?{...t,progress:100,words:(null==e?void 0:e.words)||0,pages:(null==e?void 0:e.page_count)||0,status:"completed"}:t)),h(!1);return}(null==e?void 0:e.status)==="PAGE_OVER_SIZE"?a.default(s("searchAddition.page_limit_exceeded_tip",{pages:"500"})):a.default(s("server.INTERNAL_SERVER_ERROR"));let i=g();"home"===t?m((0,t_.mF)({files:i,id:d})):p([...(0,t_.mF)({files:i,id:d})]),h(!1),x(0)},onError:()=>{a.default(s("server.INTERNAL_SERVER_ERROR")),u(),C.delete(n.name),0===C.size&&h(!1);let e=g();"home"===t?m((0,t_.mF)({files:e,id:d})):p([...(0,t_.mF)({files:e,id:d})]),x(0)}})}catch(l){u(),a.default(s("server.INTERNAL_SERVER_ERROR")),h(!1),x(0);let e=g();"home"===t?m((0,t_.mF)({files:e,id:d})):p([...(0,t_.mF)({files:e,id:d})])}}j()||x(0)},validateFile:S,currentFilesList:g,isInsufficientBalance:b,isDraggingDisabled:w,MAX_FILE_COUNT:f,isLimitExceeded:k}},tJ=(0,u.forwardRef)((e,t)=>{let{value:l,threadId:a,type:i="home",hiddenButton:n}=e,r=(0,_.useTranslations)(),o=(0,tc.WI)(),d=(0,tz.Z)(),{homeFiles:c}=(0,tj.Z)(),m=(0,ed.ZP)(e=>e.isLogin),[p,x]=(0,u.useState)(!1),[v,g]=(0,u.useState)(!1),f=(0,u.useRef)(null),{handleFiles:b,isInsufficientBalance:j,isDraggingDisabled:y,MAX_FILE_COUNT:w}=tG({type:i,threadId:a});return(0,u.useImperativeHandle)(t,()=>({handleFiles:b})),(0,s.jsx)(tP.nU,{className:"p-0 m-0",value:l,children:(0,s.jsxs)("div",{className:"ml-3 flex gap-3",children:[!n&&(0,s.jsxs)("div",{className:"max-w-fit relative pt-2",children:[(0,s.jsx)("input",{type:"file",ref:f,className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,.txt,.xls,.xlsx,.csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:e=>{let{files:t}=e.target;t&&b(t),e.target.value=""}}),(0,s.jsxs)(h.z,{variant:"secondary",size:"lg",className:(0,Z.Z)("sm:px-6 px-3",(null==c?void 0:c.length)?"h-14":"h-10","bg-[#F7F7F9] dark:bg-[#374251]"),onClick:e=>{var t;if(e.preventDefault(),(0,tV.s2)()){g(!0);return}if(!m){C.Z.getState().setLoginModalVisible(!0);return}if(j){tm.$.publish("showSubscriptionPlan",void 0);return}if(y){o||tm.$.publish("showSubscriptionPlan",void 0),d.default(r("searchAddition.thread_upload_limit_exceeded_tip",{count:w}));return}null===(t=f.current)||void 0===t||t.click()},children:[(0,s.jsx)(tO.Z,{}),r("agentConfig.add_file")]})]}),(0,s.jsx)(tW,{})]})})});var tX=e=>{var t,l;let{topTabType:a,setTopTabType:i}=e,n=(0,_.useTranslations)(),r=(0,eJ.Z)(e=>e.template),o=(0,eJ.Z)(e=>e.setCategory),d=(0,u.useRef)(null),c=(0,u.useMemo)(()=>{var e,t;return(null==r?void 0:null===(t=r.tool_config)||void 0===t?void 0:null===(e=t.top_bar)||void 0===e?void 0:e.top_bar_list)||[]},[null==r?void 0:null===(l=r.tool_config)||void 0===l?void 0:null===(t=l.top_bar)||void 0===t?void 0:t.top_bar_list]),m=(0,u.useCallback)(e=>c.find(t=>t.type===e),[c]);return(0,u.useEffect)(()=>{o(a)},[a]),(0,s.jsxs)(tP.mQ,{value:a,onValueChange:e=>{console.log("onValueChange",e),i(e),o(e)},children:[(0,s.jsx)("div",{className:"group -mt-[6px] flex justify-between items-center rounded-t-xl pb-0 border-[#EBEEF3] dark:border-[#545D6F]",children:(0,s.jsx)("div",{className:(0,Z.Z)("w-full flex items-center text-sm text-gray-400 overflow-hidden gap-2","overflow-x-auto scrollbar"),children:(0,s.jsxs)(tP.dr,{className:"bg-[#F6F7F9] dark:bg-[#454E5D] p-1 rounded-lg relative z-0",children:[m(B.gl)?(0,s.jsx)("div",{onClick:()=>i(B.gl),children:(0,s.jsx)(tL,{value:B.gl,label:n("agentConfig.ask_anything"),icon:(0,s.jsx)(tM.Z,{className:"w-4"})})}):null,m(B.J5)?(0,s.jsx)("div",{onClick:()=>i(B.J5),children:(0,s.jsx)(tL,{value:B.J5,label:n("agent.document"),icon:(0,s.jsx)(tU.nr,{className:(0,Z.Z)("w-4")})})}):null,m("long_text")?(0,s.jsx)("div",{onClick:()=>i("long_text"),children:(0,s.jsx)(tL,{value:"long_text",label:n("agentConfig.long_text"),icon:(0,s.jsx)(P.Z,{className:"w-4"})})}):null,m(B.V9)?(0,s.jsx)("div",{onClick:()=>i(B.V9),children:(0,s.jsx)(tL,{value:B.V9,label:n("agentConfig.webpage"),icon:(0,s.jsx)(E.Z,{className:"w-4"})})}):null,m(B.rN)?(0,s.jsxs)("div",{onClick:()=>i(B.rN),children:[(0,s.jsx)(tL,{value:B.rN,label:n("agentConfig.youtube"),icon:(0,s.jsx)(tB.Z,{className:"w-5"})})," "]}):null]})})}),(0,s.jsx)(tJ,{value:B.J5}),(0,s.jsx)(tJ,{value:B.SH,hiddenButton:!0,ref:d})]})},tK=l(32700),t$=l(25773),tQ=l(28818),t0=l(40203),t1=l(15893),t2=l(62796),t5=l(80542);let t4=e=>e.map(e=>{var t,l;return"mcp_services"===e.name&&(null===(t=e.config)||void 0===t?void 0:t.list)?{...e,config:{...e.config,list:e.config.list.map(e=>{if("user"===e.attribution){let{select_status:t,...l}=e;return l}return e})}}:"external_tool_services"===e.name&&(null===(l=e.config)||void 0===l?void 0:l.list)?{...e,config:{...e.config,list:e.config.list.map(e=>{if("user"===e.attribution){let{select_status:t,...l}=e;return l}return e})}}:e});var t3=e=>{let{visible:t,onClose:l,template:a,mcpServices:i,onMcpServicesUpdate:n,selectedTools:r,onAuthStatusUpdate:o,localAuthStatus:d,isCreator:c=!1}=e,m=(0,_.useTranslations)(),p=(0,tz.Z)(),h=(0,t1.n)(m),[x,v]=(0,u.useState)(!1),[g,f]=(0,u.useState)(""),[b,j]=(0,u.useState)(""),[y,w]=(0,u.useState)(""),[N,k]=(0,u.useState)(null),[E,S]=(0,u.useState)(!1),[Z,C]=(0,u.useState)(),[F,T]=(0,u.useState)(!1),[D,A]=(0,u.useState)(null),[z,I]=(0,u.useState)(null),[R,P]=(0,u.useState)(null),L=(0,u.useRef)(!1),M=(0,u.useMemo)(()=>h.map(e=>{var t,l,s,a;let i=r.find(t=>t.external_tool_id===e.id),n=null!==(l=null!==(t=d[e.id])&&void 0!==t?t:null==i?void 0:i.auth_status)&&void 0!==l&&l;return{...e,auth_status:n,scope_auth:null!==(s=null==i?void 0:i.scope_auth)&&void 0!==s?s:e.scope_auth,attribution:null!==(a=null==i?void 0:i.attribution)&&void 0!==a?a:e.attribution}}),[h,r,d]),B=async()=>{S(!0);try{k(!0)}catch(e){k(!1)}finally{S(!1)}},U=async()=>{if(!g.trim()||!b.trim())return;if(!(null==a?void 0:a.short_id)){q.Z.error(m("agent.mcp_missing_template_id"));return}let e={};if(y.trim())try{let t=JSON.parse(y.trim());if("object"!=typeof t||null===t||Array.isArray(t)){q.Z.error(m("agent.mcp_headers_error_json_object"));return}if(Object.entries(t).every(e=>{let[t,l]=e;return"string"==typeof t&&"string"==typeof l}))e=t;else{q.Z.error(m("agent.mcp_headers_error_string_values"));return}}catch(t){if(y.trim().includes(":")){q.Z.error(m("agent.mcp_headers_error_format"));return}e={Authorization:y.trim()}}let t={title:g.trim(),url:b.trim(),header:e,select_status:!0,attribution:"user",scope_auth:"personal"};try{var l,s,r;let e=[...(null===(s=a.sub_topics)||void 0===s?void 0:null===(l=s[0])||void 0===l?void 0:l.tools)||[]],o=[...i,t],d=e.findIndex(e=>"mcp_services"===e.name),c={name:"mcp_services",config:{list:o}};d>=0?e[d]=c:e.push(c);let u=t4(e.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name));if((await (0,ea.WN)(a.short_id,u)).success){n(o);let t={...a,sub_topics:(null===(r=a.sub_topics)||void 0===r?void 0:r.map((t,l)=>0===l?{...t,tools:e}:t))||[]};eJ.Z.getState().setTemplate(t),q.Z.success(m("agent.mcp_service_add_success")),f(""),j(""),w(""),k(null),v(!1)}else q.Z.error(m("agent.mcp_service_add_local"))}catch(e){q.Z.error(m("agent.mcp_service_add_local"))}},O=async e=>{if(L.current=!1,"isa"!==e.attribution||!e.auth_status||c){if(e.auth_status){await W(e.id,e.name);return}try{A(e.id);let{isAuthorized:n,data:r}=await (0,t2.q)(e.id);if(n){if(!(null==a?void 0:a.short_id)){o(e.id,!0),p.success(m("agent.mcp_auth_success",{name:e.name}));return}try{var t,l,s,i;let n=[...(null===(l=a.sub_topics)||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.tools)||[]],r=n.findIndex(e=>"external_tool_services"===e.name),d=r>=0?n[r]:{name:"external_tool_services",config:{list:[]}};(null===(s=d.config)||void 0===s?void 0:s.list)||(d.config={list:[]});let c=d.config.list.findIndex(t=>t.external_tool_id===e.id),u={external_tool_id:e.id,scope_auth:e.scope_auth||"personal",attribution:e.attribution,auth_status:!0,select_status:!0};c>=0?d.config.list[c]=u:d.config.list.push(u),r>=0?n[r]=d:n.push(d);let h=t4(n.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name));if((await (0,ea.WN)(a.short_id,h)).success){o(e.id,!0);let t={...a,sub_topics:(null===(i=a.sub_topics)||void 0===i?void 0:i.map((e,t)=>0===t?{...e,tools:n}:e))||[]};eJ.Z.getState().setTemplate(t),p.success(m("agent.mcp_auth_success",{name:e.name}))}else p.error(m("agent.mcp_install_save_failed"))}catch(e){}}else r?(C({id:r.external_tool_id,name:r.other_info.name,url:r.redirect_uri}),T(!0)):p.error(m("agent.mcp_auth_check_failed"))}catch(e){p.error(m("agent.mcp_auth_check_failed"))}finally{A(null)}}},H=async()=>{if(!Z||!(null==a?void 0:a.short_id))return;let e=L.current;if(P(null),e){L.current=!1,p.success(m("agent.mcp_auth_success",{name:Z.name}));return}try{var t,l,s,i,n;let e=[...(null===(l=a.sub_topics)||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.tools)||[]],r=e.findIndex(e=>"external_tool_services"===e.name),d=r>=0?e[r]:{name:"external_tool_services",config:{list:[]}};(null===(s=d.config)||void 0===s?void 0:s.list)||(d.config={list:[]});let c=d.config.list.findIndex(e=>e.external_tool_id===Z.id),u={external_tool_id:Z.id,scope_auth:"personal",attribution:null===(i=M.find(e=>e.id===Z.id))||void 0===i?void 0:i.attribution,auth_status:!0,select_status:!0};c>=0?d.config.list[c]=u:d.config.list.push(u),r>=0?e[r]=d:e.push(d);let h=t4(e.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name));if((await (0,ea.WN)(a.short_id,h)).success){o(Z.id,!0);let t={...a,sub_topics:(null===(n=a.sub_topics)||void 0===n?void 0:n.map((t,l)=>0===l?{...t,tools:e}:t))||[]};eJ.Z.getState().setTemplate(t),p.success(m("agent.mcp_auth_success",{name:Z.name}))}else p.error(m("agent.mcp_auth_save_failed"))}catch(e){p.error(m("agent.mcp_auth_save_failed"))}},W=async function(e,t){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(null==a?void 0:a.short_id)){q.Z.error(m("agent.mcp_missing_template_id"));return}try{let d={success:!0};if(l||(I(e),d=await (0,t2.c)(e)),d.success)try{var s,i,n,r;let l=[...(null===(i=a.sub_topics)||void 0===i?void 0:null===(s=i[0])||void 0===s?void 0:s.tools)||[]],d=l.findIndex(e=>"external_tool_services"===e.name);if(d>=0){let s=l[d];if(null===(n=s.config)||void 0===n?void 0:n.list){let i=s.config.list.findIndex(t=>t.external_tool_id===e);if(i>=0){let e=s.config.list[i];"user"===e.attribution?s.config.list.splice(i,1):s.config.list[i]={...e,auth_status:!1}}l[d]=s;let n=t4(l.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name));if((await (0,ea.WN)(a.short_id,n)).success){o(e,!1);let s={...a,sub_topics:(null===(r=a.sub_topics)||void 0===r?void 0:r.map((e,t)=>0===t?{...e,tools:l}:e))||[]};eJ.Z.getState().setTemplate(s),L.current?(p.error(m("mcp.auth_failed",{name:t})),L.current=!1):p.success(m("agent.mcp_auth_revoked",{name:t}))}else L.current||p.success(m("agent.mcp_revoke_save_failed"))}}else o(e,!1),L.current||p.success(m("agent.mcp_auth_revoked",{name:t}))}catch(e){L.current||p.error(m("agent.mcp_revoke_save_failed"))}else p.error(m("agent.mcp_auth_revoke_failed",{name:t}))}catch(e){p.error(m("agent.mcp_auth_revoke_failed",{name:t}))}finally{I(null)}},V=async(e,t)=>{try{P(e);let{data:t}=await (0,t2.c)(e);t&&C({id:t.external_tool_id,name:t.other_info.name,url:t.redirect_uri}),T(!0),L.current=!0}catch(e){p.error(m("agent.mcp_auth_refresh_failed"))}},G=async e=>{if(!(null==a?void 0:a.short_id)){q.Z.error(m("agent.mcp_missing_template_id"));return}try{var t,l,s;let r=i.filter((t,l)=>l!==e),o=[...(null===(l=a.sub_topics)||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.tools)||[]],d=o.findIndex(e=>"mcp_services"===e.name),c={name:"mcp_services",config:{list:r}};d>=0?o[d]=c:o.push(c);let u=t4(o.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name));if((await (0,ea.WN)(a.short_id,u)).success){n(r);let e={...a,sub_topics:(null===(s=a.sub_topics)||void 0===s?void 0:s.map((e,t)=>0===t?{...e,tools:o}:e))||[]};eJ.Z.getState().setTemplate(e),p.success(m("agent.mcp_service_delete_success"))}else q.Z.error(m("agent.mcp_service_delete_local"))}catch(e){q.Z.error(m("agent.mcp_service_delete_local"))}},J=async e=>{try{let{isAuthorized:t}=await (0,t2.q)(e);if(!t){let t=M.find(t=>t.id===e);t&&await W(t.id,t.name,!0)}}catch(e){console.error(e)}finally{P(null),L.current=!1}};return(0,t5.x)()?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Y.Vq,{open:t,onOpenChange:l,children:(0,s.jsxs)(Y.cZ,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",onOpenAutoFocus:e=>e.preventDefault(),children:[(0,s.jsx)(Y.fK,{className:"flex justify-start flex-row items-center pb-0 pt-6",children:(0,s.jsx)("h2",{className:"text-2xl font-semibold",children:m("agent.mcp_tools")})}),(0,s.jsxs)(Y.a7,{className:"my-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("div",{className:"text-lg font-semibold",children:m("agent.mcp_tool_section")}),(0,s.jsxs)("button",{className:"text-primary text-sm hover:underline",onClick:()=>{v(!0)},children:["+ ",m("agent.mcp_add_service")]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:M.map(e=>{let t=D===e.id,l=z===e.id,a="public"!==e.scope_auth||c&&"public"===e.scope_auth&&"isa"===e.attribution,i="isa"===e.attribution,n=t?m("agent.mcp_checking"):l?m("agent.mcp_uninstalling"):i&&!c?e.auth_status?m("agent.mcp_authorized"):m("agent.mcp_authorize"):e.auth_status?m("agent.mcp_uninstall"):m("agent.mcp_authorize"),r=t||l||e.disabled||i&&!c&&e.auth_status;return(0,s.jsxs)("div",{className:"border rounded-lg p-4 flex flex-col gap-2 relative",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start gap-2",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2 flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,s.jsx)("img",{src:e.icon,alt:e.name,className:(0,eP.cn)("w-5 h-5",("ModelContextProtocol"===e.name||"Notion"===e.name)&&"dark:brightness-0 dark:invert")}),t&&(0,s.jsx)("div",{className:"absolute -bottom-1 -right-1 bg-primary text-white rounded-full p-1 flex items-center justify-center w-4 h-4",children:(0,s.jsx)(t$.Z,{size:10,className:"animate-spin"})})]}),(0,s.jsx)("div",{className:"min-w-0 flex-1",children:(0,s.jsxs)("span",{className:"font-medium flex items-center flex-wrap text-sm break-words",children:[e.name,"public"===e.scope_auth&&(0,s.jsxs)("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",m("agent.mcp_public"),")"]}),i&&(0,s.jsxs)("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",m("agent.mcp_isa_config"),")"]})]})})]}),(0,s.jsx)("div",{className:"flex-shrink-0",children:a&&(0,s.jsxs)("div",{className:"flex gap-2",children:[e.auth_status&&(0,s.jsxs)("button",{className:"px-3 py-1 whitespace-nowrap rounded bg-blue-500 text-white text-xs hover:bg-[#0080FF] flex items-center gap-1",onClick:()=>V(e.id,e.name),disabled:R===e.id,children:[R===e.id&&(0,s.jsx)(t$.Z,{size:12,className:"animate-spin"}),m("error.refresh")]}),(0,s.jsx)("button",{className:"px-3 py-1 rounded text-xs whitespace-nowrap ".concat(e.auth_status&&(c||!i)?"bg-red-500 text-white hover:bg-red-600":i&&!c&&e.auth_status?"bg-green-500 text-white cursor-not-allowed":"bg-primary text-white hover:bg-primary/90"," ").concat(r?"opacity-50 cursor-not-allowed":""),disabled:r,onClick:()=>O(e),children:n})]})})]}),(0,s.jsx)(ef.pn,{children:(0,s.jsxs)(ef.u,{children:[(0,s.jsx)(ef.aJ,{asChild:!0,children:(0,s.jsx)("div",{className:"text-xs text-muted-foreground line-clamp-2",children:e.description})}),(0,s.jsx)(ef._v,{className:"max-w-[300px]",children:(0,s.jsx)("p",{children:e.description})})]})})]},e.id)})}),i.length>0&&(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:m("agent.mcp_custom_tools")}),(0,s.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:i.map((e,t)=>{e.scope_auth;let l="isa"===e.attribution;return(0,s.jsxs)("div",{className:"border rounded-lg p-4 flex flex-col gap-2",children:[(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("div",{className:"flex flex-1 mr-4 truncate items-center gap-2",children:[(0,s.jsx)("img",{src:"/icons/mcp/mcp.svg",alt:"MCP",className:"w-5 h-5 dark:brightness-0 dark:invert"}),(0,s.jsxs)("span",{className:"font-medium text-sm truncate",children:[e.title,l&&(0,s.jsxs)("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",m("agent.mcp_isa_config"),")"]})]})]}),!l&&(0,s.jsx)("button",{className:"px-3 py-1 rounded bg-red-500 text-white text-xs hover:bg-red-600 ml-auto",onClick:()=>G(t),children:m("agent.mcp_delete")})]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground truncate",children:[m("agent.mcp_url_prefix")," ",e.url]}),Object.keys(e.header).length>0&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:m("agent.mcp_headers_count",{count:Object.keys(e.header).length})})]},t)})})]})]})]})}),(0,s.jsx)(tQ.Z,{isOpen:x,onOpenChange:v,serverTitle:g,onServerTitleChange:f,serverUrl:b,onServerUrlChange:j,serverHeader:y,onServerHeaderChange:w,testStatus:N,testLoading:E,onTest:B,onSubmit:U}),Z&&(0,s.jsx)(t0.Z,{serviceName:Z.name,serviceUrl:Z.url,serviceId:Z.id,isOpen:F,onClose:()=>{T(!1),L.current&&J(Z.id)},onSuccess:H})]})},t6=l(81080),t8=e=>{let{showTips:t,onCloseTips:l,onTipsClick:a,selectedServices:i=[]}=e,n=(0,_.useTranslations)(),[o,d]=(0,u.useState)(16),[c,m]=(0,u.useState)(!1),p=(0,u.useCallback)(()=>{t&&setTimeout(()=>{let e=document.querySelector('[data-testid="mcp-setting-button"]'),t=document.querySelector('[data-testid="mcp-tip-container"]');if(e&&t){let l=e.getBoundingClientRect(),s=t.getBoundingClientRect(),a=l.left+l.width/2-s.left;d(Math.max(16,Math.min(s.width-16,a))),c||m(!0)}},10)},[t,c]);return((0,u.useEffect)(()=>{if(!t){m(!1);return}p(),window.addEventListener("resize",p),window.addEventListener("scroll",p);let e=new MutationObserver(p),l=document.body;return l&&e.observe(l,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]}),()=>{window.removeEventListener("resize",p),window.removeEventListener("scroll",p),e.disconnect()}},[t,p]),t&&(null==i?void 0:i.length)&&c)?(0,s.jsxs)("div",{className:"absolute left-0 right-0 top-full mt-2 z-10","data-testid":"mcp-tip-container",children:[(0,s.jsx)("div",{className:"absolute -top-[16px] w-0 h-0 border-l-[16px] border-l-transparent border-r-[16px] border-r-transparent border-b-[24px] border-b-[#E5E7EB] dark:border-b-[#2D3139]",style:{left:"".concat(o,"px"),transform:"translateX(-50%)"}}),(0,s.jsxs)("div",{className:"flex text-sm items-center bg-[#E5E7EB] dark:bg-[#2D3139] py-2 pl-4 pr-2 rounded-lg cursor-pointer transition-colors",onClick:a,children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:n("agent.mcp_personalization")}),(0,s.jsx)("div",{className:"flex items-center gap-2 ml-2",children:i.map(e=>(0,s.jsx)(tg(),{src:e.icon,alt:e.name,width:20,height:20,className:(0,eP.cn)("rounded",("ModelContextProtocol"===e.name||"Notion"===e.name)&&"dark:brightness-0 dark:invert")},e.id))})]}),(0,s.jsx)(r.Z,{onClick:e=>{e.stopPropagation(),l()},className:"ml-auto cursor-pointer",size:18})]})]}):null},t9=l(29634);let t7="hide_mcp_tips",le={id:"mcp",name:"ModelContextProtocol",icon:"/icons/mcp/mcp.svg",description:"",hidden:!1,disabled:!1,scope_auth:"personal"};var lt=e=>{var t,l,a;let{template:i,isListModalVisible:n,onListModalClose:r}=e,o=(0,_.useTranslations)(),{isLogin:d}=(0,ed.ZP)(),[c,p]=(0,u.useState)(!1),[h,v]=(0,u.useState)(n||!1),[g,f]=(0,u.useState)(!0),[b,j]=(0,u.useState)([]),[y,w]=(0,u.useState)([]),[N,k]=(0,u.useState)([]),[E,S]=(0,u.useState)([]),[Z,F]=(0,u.useState)([]),T=(0,ed.ZP)(e=>e.userInfo),[D,I]=(0,u.useState)({});(0,u.useEffect)(()=>{j((0,t1.n)(o))},[o]),(0,u.useEffect)(()=>{"true"===t9.Z.get(t7)&&f(!1)},[]);let R=(0,u.useCallback)(()=>{var e,t,l,s;if(!(null==i?void 0:null===(t=i.sub_topics)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.tools)||!b.length){F([]);return}let a=i.sub_topics[0].tools,n=[];try{let e=a.find(e=>"external_tool_services"===e.name);(null==e?void 0:null===(l=e.config)||void 0===l?void 0:l.list)&&e.config.list.forEach(e=>{let t=b.find(t=>t.id===e.external_tool_id);t&&n.push(t)});let t=a.find(e=>"mcp_services"===e.name);t&&(null===(s=t.config)||void 0===s?void 0:s.list)&&t.config.list.length>0&&n.push(le)}catch(e){console.error("Error in getSelectedMCPServices:",e)}F(n)},[null==i?void 0:i.sub_topics,b]);(0,u.useEffect)(()=>{R()},[R,y,N]),(0,u.useEffect)(()=>{var e,t,l,s;if(null==i?void 0:null===(t=i.sub_topics)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.tools){let e=i.sub_topics[0].tools,t=e.find(e=>"external_tool_services"===e.name);if(null==t?void 0:null===(l=t.config)||void 0===l?void 0:l.list){let e=t.config.list;w(e);let l={};e.forEach(e=>{void 0!==e.auth_status&&(l[e.external_tool_id]=e.auth_status)}),I(l)}else w([]),I({});let a=e.find(e=>"mcp_services"===e.name);if(null==a?void 0:null===(s=a.config)||void 0===s?void 0:s.list){let e=a.config.list;k(e),S(e.map((e,t)=>({id:"server-".concat(t),selected:e.select_status})).filter(e=>e.selected).map(e=>e.id))}else k([]),S([]);R()}},[null==i?void 0:i.short_id,null==i?void 0:null===(l=i.sub_topics)||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.tools]),(0,u.useEffect)(()=>{void 0!==n&&v(n)},[n]);let P=async(e,t)=>{if(!(null==i?void 0:i.short_id)){q.Z.error(o("agent.mcp_missing_template_id"));return}e.startsWith("server-")?S(l=>{var s,a;let n=t?[...l,e]:l.filter(t=>t!==e),r=parseInt(e.replace("server-",""));k(e=>{let l=[...e];return l[r]&&(l[r]={...l[r],select_status:t}),l});let o=[...(null===(a=i.sub_topics)||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.tools)||[]],d=o.findIndex(e=>"mcp_services"===e.name);d>=0&&(o[d]={...o[d],config:{list:N.map((e,l)=>({...e,select_status:l===r?t:e.select_status})),selected:n}}),o.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name);let c={...i,sub_topics:i.sub_topics?[{...i.sub_topics[0],tools:o},...i.sub_topics.slice(1)]:[{title:"Default Topic",tools:o,source_type:"chat",instructions:"",llm_model:""}]};return eJ.Z.getState().setTemplate(c),n}):w(l=>{var s,a;let n=l.findIndex(t=>t.external_tool_id===e),r=[...l];-1!==n?r[n]={...r[n],select_status:t}:r=[...l,{external_tool_id:e,scope_auth:"personal",attribution:"user",select_status:t}];let o=[...(null===(a=i.sub_topics)||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.tools)||[]],d=o.findIndex(e=>"external_tool_services"===e.name);d>=0?o[d]={...o[d],config:{list:r}}:o.push({name:"external_tool_services",config:{list:r}});let c={...i,sub_topics:i.sub_topics?[{...i.sub_topics[0],tools:o},...i.sub_topics.slice(1)]:[{title:"Default Topic",tools:o,source_type:"chat",instructions:"",llm_model:""}]};return eJ.Z.getState().setTemplate(c),r})},L=async(e,t)=>{if(!(null==i?void 0:i.short_id)){q.Z.error(o("agent.mcp_missing_template_id"));return}I(l=>({...l,[e]:t})),t?w(l=>{var s,a;let n=l.find(t=>t.external_tool_id===e),r=[...l];if(n)r=l.map(l=>l.external_tool_id===e?{...l,auth_status:t}:l);else{let t=b.find(t=>t.id===e);t&&(r=[...l,{external_tool_id:e,scope_auth:t.scope_auth||"personal",attribution:t.attribution||"user",auth_status:!0,select_status:!0}])}let o=[...(null===(a=i.sub_topics)||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.tools)||[]],d=o.findIndex(e=>"external_tool_services"===e.name);d>=0?o[d]={name:"external_tool_services",config:{list:r}}:o.push({name:"external_tool_services",config:{list:r}});let c={...i,sub_topics:i.sub_topics?[{...i.sub_topics[0],tools:o},...i.sub_topics.slice(1)]:[{title:"Default Topic",tools:o,source_type:"chat",instructions:"",llm_model:""}]};return eJ.Z.getState().setTemplate(c),r}):w(l=>{var s,a,n;let r=l.map(l=>l.external_tool_id===e?{...l,auth_status:t}:l),o=[...(null===(a=i.sub_topics)||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.tools)||[]],d=o.findIndex(e=>"external_tool_services"===e.name);d>=0&&(o[d]={...o[d],config:{list:r}}),o.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name);let c={...i,sub_topics:(null===(n=i.sub_topics)||void 0===n?void 0:n.map((e,t)=>0===t?{...e,tools:o}:e))||[]};return eJ.Z.getState().setTemplate(c),r})},B=(()=>{let e=[],t=y.filter(e=>e.select_status);return(t.length>0&&t.forEach(t=>{let l=b.find(e=>e.id===t.external_tool_id);l&&e.push({icon:l.icon,name:l.name})}),N.filter(e=>e.select_status).forEach(()=>{e.push({icon:"/icons/mcp/mcp.svg",name:"ModelContextProtocol"})}),e.length>0)?e.slice(0,2):b.filter(e=>"Notion"===e.name||"Gmail"===e.name).map(e=>({icon:e.icon,name:e.name}))})(),U=y.some(e=>e.select_status)||N.some(e=>e.select_status);return(0,t5.x)()?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t8,{template:i,showTips:g,onCloseTips:()=>{f(!1),t9.Z.set(t7,"true",{expires:30})},onTipsClick:()=>{if(!d){C.Z.getState().setLoginModalVisible(!0);return}v(!0)},selectedServices:(0,t1.n)(o)}),(0,s.jsxs)(z.J2,{open:c,onOpenChange:p,children:[(0,s.jsx)(x.e,{delay:0,content:o("websearch.mcp_tool"),classNames:{content:["text-white bg-gray-600 dark:bg-[#353535]"]},children:(0,s.jsx)("div",{className:"max-w-fit",children:(0,s.jsx)(z.xo,{asChild:!0,children:(0,s.jsxs)(A.A,{variant:"light",size:"sm",className:(0,m.cn)("border border-[#E6E9EF] dark:border-[#545D6F] bg-transparent hover:bg-accent hover:text-accent-foreground h-8 px-2 flex items-center gap-1.5","text-[#30394A] dark:text-[#FFFFFF]"),"data-testid":"mcp-setting-button",onClick:e=>{if(!d){e.preventDefault(),e.stopPropagation(),C.Z.getState().setLoginModalVisible(!0);return}0===y.length&&0===N.length&&(e.preventDefault(),e.stopPropagation(),v(!0))},children:[B.map((e,t)=>(0,s.jsx)("img",{src:e.icon,alt:e.name,className:(0,m.cn)("w-4 h-4 object-contain",("ModelContextProtocol"===e.name||"Notion"===e.name)&&"dark:brightness-0 dark:invert")},t)),U&&(0,s.jsx)(M.Z,{size:14})]})})})}),(0,s.jsx)(z.yk,{className:"w-auto max-h-[300px] overflow-y-auto overflow-x-hidden custom-scrollbar p-0 rounded-xl shadow-lg",align:"start",children:(0,s.jsxs)("section",{className:"w-[22em] max-w-[90vw]",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center px-6 pt-4",children:[(0,s.jsx)("h2",{className:"text-xs font-semibold opacity-60",children:o("agent.mcp_select_tools")}),(0,s.jsxs)("span",{className:"text-xs text-blue-500 cursor-pointer",onClick:()=>v(!0),children:["+ ",o("agent.mcp_add")]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1 p-2 text-sm",children:[y.map(e=>{let t=b.find(t=>t.id===e.external_tool_id);if(!t)return null;let l="isa"===e.attribution,a="public"===e.scope_auth,n=!0===e.auth_status,r=!!(null==i?void 0:i.creator),d=o("agent.mcp_authorized_connected");n||(d=a&&!r?o("agent.mcp_need_creator_auth"):o("agent.mcp_need_login_auth"));let c=!n&&!(a&&!r);return(0,s.jsx)("div",{className:(0,m.cn)("flex flex-col px-4 py-2 rounded-lg",c?"hover:bg-accent cursor-pointer":"hover:bg-accent"),onClick:()=>{c&&v(!0)},children:(0,s.jsxs)("div",{className:"grid grid-cols-[24px,1fr,auto] gap-3 items-center",children:[(0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsx)("img",{src:t.icon,alt:t.name,className:(0,m.cn)("w-5 h-5 object-contain",("ModelContextProtocol"===t.name||"Notion"===t.name)&&"dark:brightness-0 dark:invert")})}),(0,s.jsxs)("div",{className:"flex flex-col min-w-0 py-0.5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-wrap",children:[(0,s.jsx)("span",{className:"truncate",children:t.name}),a&&(0,s.jsxs)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:["(",o("agent.mcp_public"),")"]}),l&&(0,s.jsxs)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:["(",o("agent.mcp_isa_config"),")"]})]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:d})]}),(0,s.jsx)("div",{className:"flex items-center",onClick:e=>e.stopPropagation(),children:(0,s.jsx)(t6.X,{checked:"isa"===e.attribution||e.select_status,disabled:l,onCheckedChange:t=>P(e.external_tool_id,t)})})]})},e.external_tool_id)}),N.map((e,t)=>{let l="server-".concat(t),a="isa"===e.attribution;return(0,s.jsxs)("div",{className:"flex items-center gap-3 px-4 py-2 hover:bg-accent rounded-lg",children:[(0,s.jsx)("div",{className:"w-5 h-5",children:(0,s.jsx)("img",{src:"/icons/mcp/mcp.svg",alt:"MCP",className:"w-5 h-5 dark:brightness-0 dark:invert"})}),(0,s.jsxs)("span",{className:"flex-1 truncate",children:[e.title,a&&(0,s.jsxs)("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",o("agent.mcp_isa_config"),")"]})]}),(0,s.jsx)(t6.X,{checked:"isa"===e.attribution||E.includes(l),disabled:a,onCheckedChange:e=>P(l,e)})]},l)})]})]})})]}),(0,s.jsx)(t3,{template:i,visible:h,onClose:()=>{v(!1),null==r||r()},mcpServices:N,onMcpServicesUpdate:e=>{k(e)},selectedTools:y,onAuthStatusUpdate:L,localAuthStatus:D,isCreator:(null==i?void 0:null===(a=i.creator)||void 0===a?void 0:a.uid)===T.uid})]})},ll=l(2854),ls=l(55480);let la={ja:{id:"ccc3cfb0-c532-41b0-81f7-bfa2219adc4e",introduction:"FeloPPTYouTubePDFWeb",title:"Felo",nickname:"Felo ",lang:"ja",short_id:"mN8pRx5nKq7YtE3HcV6bF2"},en:{id:"769aa342-ccb6-4f5e-8f9d-60e241a733d3",introduction:"Felo slides are fully upgraded, and unique and exclusive PPT can be intelligently customized for you. YouTube, PDF, and web pages can be converted into exquisite slides with one click. Free experience for a limited time.",title:"Felo Slides",nickname:"Felo Slides",lang:"en",short_id:"qP4dLw7kMv9ZuG5FnX8cH1"},"zh-Hant":{id:"88c0f987-a58a-4079-89e0-cd68aa8f2cbe",introduction:"FeloPPTYouTubePDF",title:"Felo ",nickname:"Felo ",lang:"zh-Hant",short_id:"aTb9xK2mVp4WsR8CjL1eQ3"},ko:{id:"72416b09-3db4-48f9-908f-0f5f4d6b47e1",introduction:"Felo   ,    PPT  , YouTube, PDF,       ,      .",title:" Felo PPT  ",nickname:"Felo ",lang:"ko",short_id:"sT6hOz9pNw2ZxJ7KpY0dK4"},"zh-Hans":{id:"6a2aeeeb-ca81-4a63-9098-b94ff78e4e41",introduction:"Felo PPTYouTubePDF",title:"Felo ",nickname:"Felo ",lang:"zh-Hans",short_id:"ePhFvdWnun2YQa97sf0ea714"},ru:{id:"e7f34d71-f35e-4d3b-9c6b-4bb400f82b5f",introduction:"Felo   ,    PPT      . YouTube, PDF  -          .      .",title:"Felo PPT-",nickname:"Felo PPT-",lang:"ru",short_id:"vU8lRz1qOx4ZyM9NqZ2eM6"}},li="gpt-5",ln={created_at:"2025-06-05T09:03:51.050633",modified_at:"2025-07-01T06:49:44.973596",placeholder:"",category:"",system:!0,code:"ppt_generation_v2",icon_key:"https://cdn.felo.ai/felo-search/icons/Icon-17-new_v2.svg",slug:"ai-powerpoint-generator",sub_topics:[{title:"Felo PPT",source_type:"google",source_id:"",llm_model:li,instructions:"***",tools:[{name:"web_search",config:null},{name:"web_scraper",config:null},{name:"ppt_outline_image_search",config:null},{name:"ppt_outline",config:null},{name:"summary_file",config:null},{name:"external_tool_services",config:{list:[],status:!0}},{name:"mcp_services",config:{list:[],status:!0}}],source_info:null}],template_type:1,params:[{name:"sys_hide_image",type:"hide_image",value:null},{name:"sys_hide_file",type:"hide_file",value:null},{name:"ppt_outline_edit",type:"sub_agent",value:null,config:{title:"Felo PPT",source_type:"google",source_id:"",llm_model:li,instructions:"You are a professional outline revision and forwarding assistant...",tools:[{name:"web_search",config:null},{name:"web_scraper",config:null},{name:"ppt_outline_edit",config:null}]}},{name:"topBar",type:"top_bar",value:null,top_bar_list:[{name:"Ask Anything",type:"google",defaultSelected:!0,placeholder:"ask_anything"},{name:"Upload File",type:"chat_with_document",defaultSelected:!1,placeholder:"upload_file"},{name:"Long Text",type:"long_text",defaultSelected:!1,placeholder:"long_text"},{name:"Webpage",type:"web_summary",defaultSelected:!1,placeholder:"webpage"},{name:"YouTube",type:"video_summary",defaultSelected:!1,placeholder:"youtube"}]}],hide_instructions:!0,uid:null,is_deleted:!1,org_sharing:null,is_favorite:!1,owner:null,creator:null,permission:{is_self:!1,can_read:!0,read_permission:"PUBLIC",org_name:null,access_emails:null,is_change:!1},component:null,need_auths:[],tool_config:{hide_image:{name:"sys_hide_image",type:"hide_image",value:null},hide_file:{name:"sys_hide_file",type:"hide_file",value:null},sub_agent:{name:"ppt_outline_edit",type:"sub_agent",value:null,config:{title:"Felo PPT",source_type:"google",source_id:"",llm_model:li,instructions:"You are a professional outline revision and forwarding assistant...",tools:[{name:"web_search",config:null},{name:"web_scraper",config:null},{name:"ppt_outline_edit",config:null}]}},top_bar:{name:"topBar",type:"top_bar",value:null,top_bar_list:[{name:"Ask Anything",type:"google",defaultSelected:!0,placeholder:"ask_anything"},{name:"Upload File",type:"chat_with_document",defaultSelected:!1,placeholder:"upload_file"},{name:"Long Text",type:"long_text",defaultSelected:!1,placeholder:"long_text"},{name:"Webpage",type:"web_summary",defaultSelected:!1,placeholder:"webpage"},{name:"YouTube",type:"video_summary",defaultSelected:!1,placeholder:"youtube"}]}}},lr=e=>{let t=la[e];return t?{...ln,...t}:{...ln,...la.en}},lo={ja:{id:"41c0c0bf-874c-4b30-9e65-80b821b1e7c7",introduction:"",title:"HTML",nickname:"",lang:"ja",short_id:"SvPSWyCSSEJsiL4KrduKJJ"},en:{id:"045b6d33-521c-4db1-b2a0-4538e8fd5360",introduction:"Generate a webpage",title:"HTML Generator",nickname:"",lang:"en",short_id:"DEs4rDwpKuezSiRDbcKi7o"},"zh-Hant":{id:"ba438031-c300-4912-bcb8-b02c4492b91d",introduction:"",title:"",nickname:"",lang:"zh-Hant",short_id:"fHByCETiZxXQuiXBxgT8p9"},"zh-Hans":{id:"1e072065-62f9-411a-be6b-d753c3e49e9f",introduction:"",title:"",nickname:"",lang:"zh-Hans",short_id:"8Rfzs6rWJkKoBDRiEoKUGd"},ko:{id:"a574d247-1883-405e-bd74-4d835df1598d",introduction:" ",title:"HTML ",nickname:"",lang:"ko",short_id:"Ed4crmaUbxVWjueqfamiKR"},ru:{id:"0fd28784-34b0-4412-8ab4-9d30dcba2c61",introduction:" -",title:" HTML",nickname:"",lang:"ru",short_id:"fj6hPrPE7dQz4mTVB4LSLk"}},ld={created_at:"2025-06-27T08:22:13.984192",modified_at:"2025-06-27T12:29:34.878820",placeholder:"",category:"",system:!0,code:"html_agent",icon_key:null,slug:null,sub_topics:[{title:"HTML",source_type:"google",source_id:"",llm_model:"claude-3-7-sonnet",instructions:"***",tools:[{name:"web_search",config:null},{name:"web_scraper",config:null},{name:"image_search",config:null},{name:"html_generator",config:null},{name:"summary_file",config:null},{name:"external_tool_services",config:{list:[],status:!0}},{name:"mcp_services",config:{list:[],status:!0}}],source_info:null}],template_type:1,params:[{name:"sys_hide_file",type:"hide_file",value:null},{name:"sys_hide_image",type:"hide_image",value:null},{name:"topBar",type:"top_bar",value:null,top_bar_list:[{name:"Ask Anything",type:"google",defaultSelected:!0,placeholder:"ask_anything"},{name:"Upload File",type:"chat_with_document",defaultSelected:!1,placeholder:"upload_file"},{name:"Long Text",type:"long_text",defaultSelected:!1,placeholder:"long_text"},{name:"Webpage",type:"web_summary",defaultSelected:!1,placeholder:"webpage"},{name:"YouTube",type:"video_summary",defaultSelected:!1,placeholder:"youtube"}]}],hide_instructions:!0,uid:null,is_deleted:!1,org_sharing:null,is_favorite:!1,owner:null,creator:null,permission:{is_self:!1,can_read:!0,read_permission:"PUBLIC",org_name:null,access_emails:null,is_change:!1},component:null,need_auths:[],tool_config:{hide_file:{name:"sys_hide_file",type:"hide_file",value:null},hide_image:{name:"sys_hide_image",type:"hide_image",value:null},top_bar:{name:"topBar",type:"top_bar",value:null,top_bar_list:[{name:"Ask Anything",type:"google",defaultSelected:!0,placeholder:"ask_anything"},{name:"Upload File",type:"chat_with_document",defaultSelected:!1,placeholder:"upload_file"},{name:"Long Text",type:"long_text",defaultSelected:!1,placeholder:"long_text"},{name:"Webpage",type:"web_summary",defaultSelected:!1,placeholder:"webpage"},{name:"YouTube",type:"video_summary",defaultSelected:!1,placeholder:"youtube"}]}}},lc=e=>{let t=lo[e];return t?{...ld,...t}:{...ld,...lo.en}};lc("en");var lu=l(44342),lm=e=>{let{setPinDiscovery:t}=e,l=(0,_.useTranslations)(),a=(0,_.useLocale)(),{searchType:i,setSearchType:n,freeUserSearchCountInfo:r}=(0,g.Z)(),{pinUserList:c,pinSystemList:m}=(0,ls.Z)(),{setHomeTemplate:p}=(0,eJ.Z)(),x=(0,d.useRouter)(),v=(0,tz.Z)(),[f,b]=(0,u.useState)(!1),{setProSelected:j}=(0,g.Z)(),y=(0,ed.ZP)(e=>e.isLogin),{proUsageQuota:w}=(0,tK.I)(),{isMobile:N}=(0,lu.b)(),k=[{name:l("emoji.searchPlaceholder"),icon:(0,s.jsx)(S.Z,{size:20,className:"text-[#0080FF] dark:text-[#1EB1FF]"}),id:g.S.SEARCH,activeStyle:"border-theme-blue-500 text-theme-blue-500 bg-[#EDFAFF] dark:bg-[#0E335D] dark:text-[#1EB1FF] dark:border-[#1EB1FF]",hoverStyle:"hover:border-theme-blue-500 hover:text-theme-blue-500 hover:bg-[#EDFAFF] hover:dark:bg-[#0E335D] hover:dark:text-[#1EB1FF] hover:dark:border-[#1EB1FF]"},{name:l("research_analysis"),icon:(0,s.jsx)(ll.wC,{className:"text-[#268DBA] dark:text-[#B2E0FA] w-5 h-5"}),id:g.S.RESEARCH,activeStyle:"border-[#268DBA] text-[#268DBA] bg-[#ECF8FD] dark:bg-[#1A556E] dark:text-[#B2E0FA] dark:border-[#B2E0FA]",hoverStyle:"hover:border-[#268DBA] hover:text-[#268DBA] hover:bg-[#ECF8FD] hover:dark:bg-[#1A556E] hover:dark:text-[#B2E0FA] hover:dark:border-[#B2E0FA]"},{name:l("ppt_generation_v2"),icon:(0,s.jsx)(ll.rq,{className:"w-5 h-5 text-[#D14625] dark:text-[#E68054]"}),id:g.S.AI_PPT,activeStyle:"dark:bg-[#521D16] dark:border-[#E68054] dark:text-[#E68054] border-[#D14625] text-[#D14625] bg-[#FDF5EF]",code:"ppt_generation_v2",hoverStyle:"hover:dark:bg-[#521D16] hover:dark:border-[#E68054] hover:dark:text-[#E68054] hover:border-[#D14625] hover:text-[#D14625] hover:bg-[#FDF5EF]"},{name:l("html_agent"),icon:(0,s.jsx)(ll.fb,{className:"w-5 h-5 text-[#7651DC] dark:text-[#A496EF]"}),id:g.S.INTERACTIVE_WEBPAGE,activeStyle:"dark:bg-[#2A195C] dark:border-[#A496EF] dark:text-[#A496EF] border-[#7651DC] text-[#7651DC] bg-[#F5F4FE]",code:"html_agent",hoverStyle:"hover:dark:bg-[#2A195C] hover:dark:border-[#A496EF] hover:dark:text-[#A496EF] hover:border-[#7651DC] hover:text-[#7651DC] hover:bg-[#F5F4FE]"}];(0,u.useEffect)(()=>{void 0===y||y||i!==g.S.RESEARCH||n(g.S.SEARCH)},[y]);let E=async e=>{let t=await (0,ea.VN)(e);if(t.data){var s;let e=await (0,eA.Y)(t.data.title),l=(0,ez.b)(e),a="/agents/".concat(l,"-").concat(null===(s=t.data)||void 0===s?void 0:s.short_id);p(t.data),window.history.pushState({},"",a)}else v.error(l("ppt.failed_generate"))},Z=async e=>{if(console.log("\uD83D\uDE80 ~ handleAgentSelect ~ agent:",e),(null==e?void 0:e.code)==="ppt_generation_v2"&&(0,eb.fk)(ej.U.HOME_PAGE_TAB_SLIDES,{value:ej.U.HOME_PAGE_TAB_SLIDES},!0),(null==e?void 0:e.code)==="html_agent"&&(0,eb.fk)(ej.U.HOME_PAGE_TAB_WEBPAGE,{value:ej.U.HOME_PAGE_TAB_WEBPAGE},!0),!e.code){if(e.id===g.S.RESEARCH){if((0,eb.fk)(ej.U.HOME_PAGE_TAB_RESEARCH,{value:ej.U.HOME_PAGE_TAB_RESEARCH},!0),!y){tm.$.publish("showLogin",void 0);return}if(0===w){tm.$.publish("showSubscriptionPlan",void 0);return}j(!0),t(!0,!0)}e.id===g.S.SEARCH&&(t(!1,!0),0===r.proSearch&&j(!1),(0,eb.fk)(ej.U.HOME_PAGE_TAB_SEARCH,{value:ej.U.HOME_PAGE_TAB_SEARCH},!0)),n(e.id),p(null),window.history.pushState({},"","/search");return}n(e.id);try{let t;if("html_agent"===e.code)t=lc(a);else if("ppt_generation_v2"===e.code)t=lr(a);else{var s,i;let a=m.find(t=>t.component_key===e.code),n=(null==a?void 0:null===(s=a.thread_template_tiny)||void 0===s?void 0:s.short_id)||(null==a?void 0:null===(i=a.attributes)||void 0===i?void 0:i.agent_id);if(!n){v.error(l("ppt.failed_generate"));return}t=(await (0,ea.VN)(n)).data}if(t){p(t);let e=await (0,eA.Y)(t.title),l=(0,ez.b)(e),s="/agents/".concat(l,"-").concat(t.short_id);window.history.pushState({},"",s),("ppt_generation_v2"===t.code||"html_agent"===t.code)&&E(t.short_id)}else v.error(l("ppt.failed_generate"))}catch(e){console.log("error:",e),v.error(l("ppt.failed_generate"))}},C=async e=>{b(!1),n(e.component_key||"");try{var t,s;let a=(null==e?void 0:null===(t=e.thread_template_tiny)||void 0===t?void 0:t.short_id)||(null==e?void 0:null===(s=e.attributes)||void 0===s?void 0:s.agent_id);if(!a){v.error(l("ppt.failed_generate"));return}E(a)}catch(e){v.error(l("ppt.failed_generate"))}},[F,T]=(0,u.useState)({});(0,u.useEffect)(()=>{m.forEach(e=>{e.icon_url&&D(e.icon_url)})},[m]),(0,u.useEffect)(()=>{c.forEach(e=>{e.icon_url&&D(e.icon_url)})},[c]);let D=async e=>{try{if(!e)return;let t=await (0,eP.U)(e);T(l=>({...l,[e]:t}))}catch(e){console.error("Failed to fetch SVG content")}},[A,I]=(0,u.useState)(N?2:k.length),R=(0,u.useRef)(null),P=(0,u.useRef)([]),L=(0,u.useRef)(null),M=(0,u.useCallback)(()=>{if(N){I(2);return}if(!R.current||!L.current)return;let e=R.current.offsetWidth-(L.current.offsetWidth+8),t=0;for(let l=0;l<k.length;l++){let s=P.current[l];if(s){let l=s.offsetWidth+8;if(e>=l)e-=l,t++;else break}}I(t<2?2:t)},[k.length,N]);return(0,u.useEffect)(()=>{let e=setTimeout(()=>{M()},100),t=()=>{M()};return window.addEventListener("resize",t),()=>{clearTimeout(e),window.removeEventListener("resize",t)}},[M,k.length]),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"absolute opacity-0 pointer-events-none -z-10",children:[k.map((e,t)=>(0,s.jsxs)("button",{ref:e=>{P.current[t]=e},style:{boxShadow:"0px 2px 20px 0px #0061C30D"},className:"flex items-center rounded-3xl gap-2 px-4 py-2 text-sm font-medium transition-colors border ".concat(i===e.id?e.activeStyle:"border-transparent text-[#30394A] dark:text-white bg-white dark:bg-[#353B46]"," ").concat(e.hoverStyle),children:[e.icon,(0,s.jsx)("span",{children:e.name})]},"measure-".concat(e.id))),(0,s.jsxs)("button",{ref:L,className:"flex items-center rounded-3xl gap-2 px-4 py-2 text-sm font-medium transition-colors shadow-[0px_2px_20px_0px_#0061C30D] bg-white dark:bg-[#353B46] border border-transparent",children:[(0,s.jsx)(o.Z,{size:20}),(0,s.jsx)("span",{children:l("pinAll.more")})]})]}),(0,s.jsxs)("div",{ref:R,className:"flex overflow-hidden flex-wrap gap-2 justify-center w-[95vw] md:w-auto ml-[-2.5vw] md:ml-0",children:[k.slice(0,A).map(e=>(0,s.jsxs)("button",{tabIndex:-1,id:"agent-".concat(e.id),className:"flex items-center rounded-3xl gap-2 px-4 py-2 text-sm font-medium transition-colors border shadow-[0px_2px_20px_0px_#0061C30D] ".concat(i===e.id?e.activeStyle:"border-transparent text-[#30394A] dark:text-white bg-white dark:bg-[#353B46]"," ").concat(e.hoverStyle),onClick:()=>Z(e),children:[e.icon,(0,s.jsx)("span",{children:e.name})]},e.id)),(0,s.jsxs)(z.J2,{open:f,onOpenChange:b,children:[(0,s.jsx)(z.xo,{asChild:!0,children:(0,s.jsxs)("button",{tabIndex:-1,className:"flex items-center rounded-3xl gap-2 px-4 py-2 text-sm font-medium transition-colors shadow-[0px_2px_20px_0px_#0061C30D] ".concat(f||!k.slice(0,A).map(e=>e.id).includes(i)?"bg-[#F6F7F9] border border-[#5F7698] text-[#5F7698] dark:bg-[#454E5D] dark:border-[#969FB0] dark:text-[#969FB0]":"bg-white dark:bg-[#353B46] border border-transparent"," hover:bg-[#F6F7F9] hover:border-[#5F7698] hover:text-[#5F7698] dark:hover:bg-[#454E5D] dark:hover:border-[#969FB0] dark:hover:text-[#969FB0]"),children:[(0,s.jsx)(o.Z,{size:20}),(0,s.jsx)("span",{children:l("pinAll.more")})]})}),(0,s.jsx)(z.yk,{className:"w-[300px] rounded-2xl p-2 max-h-[400px] overflow-y-auto custom-scrollbar dark:border-[#454E5D] dark:bg-[#353B46]",align:"start",side:"bottom",children:(0,s.jsxs)("div",{children:[c.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm mb-2 mt-1 ml-2 text-[#5F7698] dark:text-[#D0D4DC]",children:"Pin Agent"}),(0,s.jsx)("div",{className:"space-y-1",children:c.map(e=>{var t;return(0,s.jsx)(h.z,{variant:"ghost",className:"w-full h-10 hover:dark:bg-[#454E5D] text-[#30394A] dark:text-white justify-start text-left group ".concat(i===e.component_key?"border border-[#0080FF26] bg-[#0080FF26]":""),onClick:()=>C(e),children:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(null==e?void 0:e.icon_url)?(0,s.jsx)("span",{dangerouslySetInnerHTML:{__html:F[e.icon_url]||""}}):(null==e?void 0:null===(t=e.attributes)||void 0===t?void 0:t.template_type)===ei.W.DEFAULT?(0,s.jsx)(eZ.WA,{className:"w-4 h-4"}):(0,s.jsx)(eZ.x0,{className:"w-4 h-4"})}),(0,s.jsx)("span",{className:"truncate max-w-[200px]",children:e.title})]}),i===e.component_key&&(0,s.jsx)(em.Z,{className:"w-4 h-4 text-[#0080FF] flex-shrink-0"})]})},e.component_key)})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm mb-2 dark:text-[#D0D4DC] mt-3 ml-2 text-[#5F7698]",children:l("pinAll.pin_agent_recommend_title")}),(0,s.jsx)("div",{className:"space-y-1",children:m.filter(e=>!c.some(t=>t.component_key===e.component_key)&&(A>=4?"ppt_generation_v2"!==e.component_key&&"html_agent"!==e.component_key:!(A>=3)||"ppt_generation_v2"!==e.component_key)).map(e=>{var t;return(0,s.jsx)(h.z,{variant:"ghost",className:"w-full h-10 hover:dark:bg-[#454E5D] text-[#30394A] dark:text-white dark:hover:border-[#969FB0] justify-start text-left group ".concat(i===e.component_key?"border border-[#0080FF26] bg-[#0080FF26]":""),onClick:()=>C(e),children:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(null==e?void 0:e.icon_url)?(0,s.jsx)("span",{dangerouslySetInnerHTML:{__html:F[e.icon_url]||""}}):(null==e?void 0:null===(t=e.attributes)||void 0===t?void 0:t.template_type)===ei.W.DEFAULT?(0,s.jsx)(eZ.WA,{className:"w-4 h-4"}):(0,s.jsx)(eZ.x0,{className:"w-4 h-4"})}),(0,s.jsx)("span",{className:"truncate max-w-[200px]",children:e.title})]}),i===e.component_key&&(0,s.jsx)(em.Z,{className:"w-4 h-4 text-[#0080FF] flex-shrink-0"})]})},e.component_key)})})]}),(0,s.jsx)("div",{className:"text-center text-sm font-medium dark:text-[#1EB1FF] my-2 mt-2 cursor-pointer text-blue-500",onClick:()=>x.push("/agents"),children:l("pinAll.all_agent")})]})})]})]})]})},lp=l(33451),lh=l(50933);let lx=()=>{let{points:e,isLoading:t,error:l,setPoints:s,deduct:a,startLoading:i,setError:n}=(0,lp.Z)(),r=(0,u.useCallback)(async()=>{if(!t){i();try{let e=await lh.O7();s(e.points)}catch(e){n(e.message||"Failed to fetch points")}}},[t,i,s,n]),o=(0,u.useCallback)(async t=>{try{t.points&&null!==e&&a(t.points);let l=await lh.Uh(t);if(!l.success)throw await r(),Error(l.message||"Failed to deduct points");return await r(),l}catch(e){throw await r(),n(e.message||"Failed to deduct points"),e}},[e,a,r,n]);return{points:e,isLoading:t,error:l,fetchPoints:r,deductPoints:o}};var lv=l(98795),lg=l(19703),lf=l(51853),l_=l(90095),lb=e=>{let{setShowCreationNotes:t}=e,l=(0,_.useTranslations)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Y.a7,{className:"max-h-[calc(100dvh-200px)] overflow-y-auto custom-scrollbar",children:(0,s.jsx)("div",{className:"grid w-full  items-center gap-3 mb-3",children:(0,s.jsx)("div",{className:"text-sm text-gray-500 leading-relaxed dark:text-white ",dangerouslySetInnerHTML:{__html:l("slideTemplate.creation_notes_content",{titleStart:"<h3 class='font-bold mb-2'>",titleEnd:"</h3>",ulStart:"<ul class='list-disc list-inside px-6'>",ulEnd:"</ul>",liStart:"<li class='-indent-6 pl-6'>",liEnd:"</li>",title2Start:"<h4 class='text-sm font-bold flex items-center gap-1 mt-4 mb-1'>",title2End:"</h4>",br:"<br />",icon1:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock-keyhole-icon lucide-lock-keyhole"><circle cx="12" cy="16" r="1"/><rect x="3" y="10" width="18" height="12" rx="2"/><path d="M7 10V7a5 5 0 0 1 10 0v3"/></svg>',icon2:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scale-icon lucide-scale"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>',pStart:"<p class='ml-4'>",pEnd:"</p>"})}})})}),(0,s.jsxs)(Y.cN,{className:"flex flex-col gap-2 sm:flex-col",children:[(0,s.jsx)("div",{className:"w-full text-right",children:(0,s.jsx)(h.z,{size:"lg",className:"h-9 px-4 w-auto",variant:"default",onClick:()=>t(!1),children:l("slideTemplate.creation_notes_button")})}),(0,s.jsx)("div",{className:"w-full text-xs text-gray-500 leading-normal dark:text-gray-400 text-right",children:l("slideTemplate.creation_notes_tips")})]})]})},lj=l(8529),ly=l(54296),lw=l(68644),lN=l(63023),lk=e=>{var t;let{name:l,logo:a,color:i,isButton:n=!1}=e;return(0,s.jsx)(s.Fragment,{children:(null==a?void 0:a.url)?(0,s.jsx)("img",{src:a.url,alt:l,className:(0,Z.Z)("rounded-full object-cover",n?"w-5 h-5":"w-6 h-6 border")}):(0,s.jsx)("div",{className:(0,Z.Z)("rounded-md flex items-center justify-center text-xs",n?"w-5 h-5":"w-6 h-6 ",i?"":"border"),style:i?{backgroundColor:i,color:(0,lN.pJ)(i)}:void 0,children:null==l?void 0:null===(t=l.slice(0,1))||void 0===t?void 0:t.toUpperCase()})})},lE=e=>{let{id:t,name:l,logo:a,font:i,theme:n,style_name:r,isButton:o=!1}=e,d=(0,_.useTranslations)(),c=(0,tz.Z)(),{template:m,setEditTemplate:p,setShowCreationNotes:h,setIsOpenUpload:x,getTemplateList:v}=(0,ly.Z)(),[g,f]=(0,u.useState)(!1),b=async()=>{f(!0);let e=await (0,lj.zk)({uuid:t});if(f(!1),(null==e?void 0:e.status)!==200){c.error(d("slideTemplate.delete_template_error"));return}c.success(d("slideTemplate.delete_template_success")),v({current:"1",size:"20"})};return(0,s.jsx)("div",{className:(0,Z.Z)("grid w-full items-center gap-3 relative h-8 overflow-hidden",o?"px-2 ":"px-0"),children:(0,s.jsxs)("div",{className:"flex items-center gap-2 justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(lk,{id:t,font:i,name:l,logo:a,color:null==n?void 0:n.primary_color,isButton:o}),(0,s.jsx)("div",{className:(0,Z.Z)("text-sm font-normal truncate overflow-hidden whitespace-nowrap",o?"max-w-[90px] pr-1":"w-[134px]"),children:l})]}),o?null:(null==m?void 0:m.id)===t?(0,s.jsx)(em.Z,{className:"w-5 h-5 text-primary"}):(0,s.jsxs)(eU.h_,{children:[(0,s.jsx)(eU.$F,{asChild:!0,children:(0,s.jsx)("div",{className:(0,Z.Z)("w-5 h-5 flex items-center justify-center cursor-pointer hover:bg-slate-100 rounded","dark:hover:bg-slate-700"),onClick:e=>{e.stopPropagation(),e.preventDefault()},children:(0,s.jsx)(lw.Z,{className:"w-4 h-4"})})}),(0,s.jsxs)(eU.AW,{className:"min-w-16 rounded-md",align:"start",children:[(0,s.jsx)(eU.Xi,{onClick:e=>{e.preventDefault(),e.stopPropagation(),p({name:l,logo:a,font:i,theme:n,id:t,style_name:r}),x(!0),h(!1)},children:d("slideTemplate.edit_template")}),(0,s.jsxs)(eU.Xi,{className:"text-red-500",onClick:e=>{e.preventDefault(),e.stopPropagation(),b()},disabled:g,children:[g?(0,s.jsx)(t$.Z,{className:"w-4 h-4 animate-spin"}):null,d("slideTemplate.delete_template")]})]})]})]})})},lS=l(58734),lZ=l(15082),lC=e=>{var t,l,a,i;let{}=e,n=(0,_.useTranslations)(),o=(0,tz.Z)(),{templateList:d,setTemplate:c,template:m,showCreationNotes:p,setShowCreationNotes:v,isOpenUpload:g,setIsOpenUpload:f,editTemplate:b,setEditTemplate:j,setIsOpenDropDownMenu:y,isOpenDropDownMenu:w,isGetListLoading:N,getTemplateList:k,themeColor:E,setThemeColor:S,isAiGeneratingThemeColors:C}=(0,ly.Z)(),{isThemeColorComplete:F,handleGenerateOrClearThemeColors:T}=(0,lZ.Z)(),D=(0,u.useRef)(null),A=(0,u.useRef)(null),z=(0,u.useRef)(null),[I,R]=(0,u.useState)((null==b?void 0:b.name)||""),[P,L]=(0,u.useState)(!1),[M,B]=(0,u.useState)(!1),[U,O]=(0,u.useState)(!1),[H,W]=(0,u.useState)(!1),[V,q]=(0,u.useState)({url:(null==b?void 0:null===(t=b.logo)||void 0===t?void 0:t.url)||""}),[G,J]=(0,u.useState)({url:(null==b?void 0:null===(l=b.font)||void 0===l?void 0:l.url)||"",name:(null==b?void 0:null===(a=b.font)||void 0===a?void 0:a.name)||""}),[X,K]=(0,u.useState)({file:null}),[$,Q]=(0,u.useState)({file:null}),[ee,et]=(0,u.useState)(!1),el=e=>{e.preventDefault(),e.stopPropagation(),et(!0)},es=async e=>{if(e.size>5242880){o.error(n("slideTemplate.upload_file_size_error",{size:"5"}));return}let t=new FileReader;t.onload=t=>{var l;Q({file:e,preview:null===(l=t.target)||void 0===l?void 0:l.result})},t.readAsDataURL(e),B(!0);try{var l;let t=await (0,lj.i0)({file:e});if(B(!1),(null==t?void 0:t.status)!==200||!(null==t?void 0:null===(l=t.data)||void 0===l?void 0:l.url)){o.error(n("slideTemplate.upload_file_error")),Q({file:null,preview:""});return}q({url:t.data.url})}catch(e){B(!1),console.log(e),o.error(n("slideTemplate.upload_file_error")),Q({file:null,preview:""})}},ea=()=>{R(""),q({url:""}),J({url:"",name:""}),S(lN.e),y(!1),f(!1),v(!0),j(null),W(!1),D.current&&(D.current.value=""),A.current&&(A.current.value=""),Q({file:null}),K({file:null}),et(!1)},ei=async(e,t,l)=>{var s,a,i,r,d,c,u;let m=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!m||!t){l({file:null});return}let p="templateLogo"===t?5242880:20971520;if(m.size>p){o.error(n("slideTemplate.upload_file_size_error",{size:(p/1024/1024).toFixed(0)})),(null==e?void 0:e.target)&&(e.target.value=""),l({file:null});return}if(m.type.startsWith("image/")){let e=new FileReader;e.onload=e=>{var t;l({file:m,preview:null===(t=e.target)||void 0===t?void 0:t.result})},e.readAsDataURL(m)}else l({file:m});"templateLogo"===t?B(!0):"templateFont"===t&&L(!0);try{let s=await (0,lj.i0)({file:m});if("templateLogo"===t?B(!1):"templateFont"===t&&L(!1),(null==e?void 0:e.target)&&(e.target.value=""),console.log("\uD83D\uDE80 ~ res:",s),(null==s?void 0:s.status)!==200||!(null==s?void 0:null===(a=s.data)||void 0===a?void 0:a.url)){o.error(n("slideTemplate.upload_file_error")),l({file:null,preview:""});return}if("templateLogo"===t&&q({url:s.data.url}),"templateFont"===t){if(!(null==s?void 0:null===(r=s.data)||void 0===r?void 0:null===(i=r.font_info)||void 0===i?void 0:i.full_name)){o.error(n("slideTemplate.upload_file_error")),l({file:null,preview:""});return}J({url:null==s?void 0:null===(d=s.data)||void 0===d?void 0:d.url,name:null==s?void 0:null===(u=s.data)||void 0===u?void 0:null===(c=u.font_info)||void 0===c?void 0:c.full_name})}}catch(s){"templateLogo"===t?B(!1):"templateFont"===t&&L(!1),(null==e?void 0:e.target)&&(e.target.value=""),console.log(s),o.error(n("slideTemplate.upload_file_error")),l({file:null,preview:""})}},en=(e,t)=>{"templateFont"===t?J({url:"",name:""}):"templateLogo"===t&&q({url:""}),e({file:null,preview:""});let l=document.getElementById(t);l&&(l.value="")},er=async()=>{var e,t;if(U)return;if(!I){o.error(n("slideTemplate.template_name_error"));return}if(!V.url&&(!G.url||!G.name)&&!(null==E?void 0:null===(e=E.colors)||void 0===e?void 0:e.primary_color)){o.error(n("slideTemplate.template_submit_error"));return}O(!0);let l={id:"",name:I,logo:{url:V.url},font:{url:G.url,name:G.name},theme:null==E?void 0:E.colors,style_name:null==E?void 0:E.style_name};b&&(l.id=b.id),console.log("\uD83D\uDE80 ~ handleCreateTemplate ~ templateData:",l),O(!1);try{let e=b?await (0,lj.QB)(l):await (0,lj.Mn)(l);if(console.log("\uD83D\uDE80 ~ handleCreateTemplate ~ res:",e),(null==e?void 0:e.status)!==200){o.error(n("slideTemplate.create_template_error"));return}o.success(b?n("slideTemplate.edit_template_success"):n("slideTemplate.create_template_success")),l.id=null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.uuid,c(l),ly.Z.getState().updateTemplateInList(l),ea()}catch(e){console.log(e),o.error(n("slideTemplate.create_template_error"))}finally{O(!1)}},eo=async()=>{null!=d&&d.length||k({current:"1",size:"20"})};(0,u.useEffect)(()=>{eo()},[]),(0,u.useEffect)(()=>{if(console.log("\uD83D\uDE80 ~ SlideTemplate ~ editTemplate:",b),b){var e;R(b.name),q({url:b.logo.url}),J({url:b.font.url,name:b.font.name}),S({...lN.e,colors:{...lN.e.colors,...b.theme},style_name:(null==b?void 0:null===(e=b.theme)||void 0===e?void 0:e.style_name)||""})}},[b]),(0,u.useEffect)(()=>{S(lN.e)},[]);let ed=e=>{var t,l;let{preview:a,onRemove:i,type:o}=e;return a.file||(null==V?void 0:V.url)||(null==G?void 0:G.name)?(0,s.jsx)("div",{className:"p-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:["image"===o&&((null==a?void 0:a.preview)||(null==V?void 0:V.url))?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,s.jsxs)("div",{className:"relative w-[100px] h-[100px]  rounded-xl",children:[(0,s.jsx)("img",{src:(null==a?void 0:a.preview)||(null==V?void 0:V.url),alt:"preview",className:"w-full h-full object-cover rounded-xl border relative z-10"}),M?(0,s.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full bg-[rgba(0,0,0,0.5)] flex flex-col items-center justify-center z-20 gap-2 rounded-xl",children:[(0,s.jsx)(t$.Z,{className:"w-5 h-5 text-white animate-spin"}),(0,s.jsx)("div",{className:"text-white text-sm",children:n("slideTemplate.template_uploading")})]}):(0,s.jsx)(h.z,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),e.preventDefault(),i(e)},className:"p-1 h-[18px] w-[18px] bg-[#3D4C67] rounded-full hover:bg-[#606B80] absolute -top-1 -right-1 z-20",children:(0,s.jsx)(r.Z,{className:"w-2 h-2 text-white scale-80"})})]}),(0,s.jsx)("p",{className:"text-base truncate text-gray-600 max-w-72 mt-1 dark:text-[#ffffff]",children:null==a?void 0:null===(t=a.file)||void 0===t?void 0:t.name}),(0,s.jsx)(h.z,{variant:"outline-primary",size:"sm",className:"h-8",children:n("slideTemplate.template_retry")})]}):null,"image"===o?null:(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)("p",{className:"text-base truncate text-gray-900 max-w-[300px] dark:text-[#ffffff]",children:(null==a?void 0:null===(l=a.file)||void 0===l?void 0:l.name)||(null==G?void 0:G.name)})}),"document"===o&&P?(0,s.jsx)(t$.Z,{className:"h-[18px] w-[18px] animate-spin text-primary"}):"image"===o?null:(0,s.jsx)(h.z,{variant:"ghost",size:"sm",onClick:i,className:"p-1 h-[18px] w-[18px] bg-[#3D4C67] rounded-full hover:bg-[#606B80]",children:(0,s.jsx)(r.Z,{className:"w-2 h-2 text-white scale-80"})})]})}):null};return(0,s.jsxs)("div",{className:"relative",children:[m?(0,s.jsx)(r.Z,{className:"w-4 h-4 text-gray-500 scale-85  absolute -top-1 -right-1 bg-slate-100 rounded-full p-0.5 cursor-pointer z-10 hover:bg-slate-200",onClick:()=>{c(null)}}):null,(0,s.jsxs)(eU.h_,{open:w,onOpenChange:y,children:[(0,s.jsx)(x.e,{delay:0,content:n("websearch.custom_logo_font_theme"),classNames:{content:["text-white bg-gray-600 dark:bg-[#353535]"]},children:(0,s.jsx)("div",{className:"max-w-fit",children:(0,s.jsx)(eU.$F,{asChild:!0,children:(0,s.jsx)(h.z,{variant:"outline",size:"sm",className:(0,Z.Z)("gap-1 mx-0 px-2 h-8 relative","min-w-8","text-sm font-normal","flex items-center","rounded-lg","text-black dark:text-white","dark:bg-[#353B47] dark:border-[#545E6F] dark:hover:bg-[#383E48]",m?"p-0":""),onClick:()=>y(!0),children:m?(0,s.jsx)(lE,{...m,isButton:!0}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(lg.Z,{}),n("slideTemplate.button_title")]})})})})}),(0,s.jsxs)(eU.AW,{className:"w-56 rounded-xl",align:"start",side:"bottom",children:[(0,s.jsx)(eU.Ju,{className:"text-sm font-medium pb-2 pt-1  text-slate-500 dark:text-slate-400",children:n("slideTemplate.my_template_title")}),N?(0,s.jsx)("div",{className:"flex justify-center items-center h-24",children:(0,s.jsx)(t$.Z,{className:"w-4 h-4 animate-spin"})}):(null==d?void 0:d.length)>0?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(eU.Qk,{className:"max-h-[200px] overflow-y-auto custom-scrollbar",children:d.map(e=>(0,s.jsx)(eU.Xi,{className:(0,Z.Z)("h-10 rounded-lg mb-2",(null==m?void 0:m.id)===e.id?"bg-[#D9ECFF] border-1 border-[#B8DCFF] dark:bg-[#21B1FF]/20 dark:border-[#21B1FF]":""),onClick:()=>{c(e)},children:(0,s.jsx)(lE,{...e})},e.id))})}):(0,s.jsx)("div",{children:(0,s.jsx)("div",{className:"text-sm text-[#ACB9CD] p-2 text-center mt-2",children:n("slideTemplate.creation_template_desc")})}),(0,s.jsx)("div",{className:"flex justify-center mb-2 mt-3 mx-2.5",children:(0,s.jsx)(h.z,{variant:"default",className:"w-full",onClick:()=>{y(!1),f(!0),v(!0)},children:n("slideTemplate.creation_template_title")})})]})]}),(0,s.jsx)(Y.Vq,{open:g,onOpenChange:e=>{e||(f(!1),y(!1),v(!1),W(!1),ea())},children:(0,s.jsxs)(Y.cZ,{hideCloseButton:!0,className:(0,Z.Z)("dark:bg-[#464E5D]",p?"sm:max-w-[620px]":"sm:max-w-[500px]"),"aria-describedby":void 0,onInteractOutside:e=>e.preventDefault(),onEscapeKeyDown:e=>e.preventDefault(),children:[(0,s.jsxs)(Y.fK,{className:"relative",children:[(0,s.jsx)(Y.$N,{children:p?n("slideTemplate.creation_notes_title"):b?n("slideTemplate.edit_template_title"):n("slideTemplate.creation_template_title")}),(0,s.jsx)(Y.GG,{asChild:!0,className:"absolute right-4 top-1",children:(0,s.jsx)(h.z,{size:"sm",variant:"no-border",className:"rounded-full w-9 h-9 p-0 m-0 dark:bg-transparent hover:bg-slate-100",children:(0,s.jsx)(r.Z,{className:"!w-7 !h-7"})})})]}),p?(0,s.jsx)(lb,{setShowCreationNotes:v}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Y.a7,{className:"max-h-[calc(100dvh-200px)] overflow-y-auto custom-scrollbar",children:(0,s.jsxs)("div",{className:"gap-3",children:[(0,s.jsxs)(l_.Z,{id:"templateName",label:n("slideTemplate.template_name"),isRequired:!0,children:[(0,s.jsx)(eB.I,{id:"templateName",type:"text",placeholder:n("slideTemplate.template_name_placeholder"),value:I,onChange:e=>R(e.target.value),maxLength:50,className:(0,Z.Z)(lN.gI,"pr-12"),autoComplete:"off"}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 absolute right-1.5 bottom-4 ",children:[I.length,"/50"]})]}),(0,s.jsxs)(l_.Z,{label:n("slideTemplate.template_font"),children:[(0,s.jsx)(eB.I,{id:"templateFont",type:"file",accept:".ttf,.otf,.woff,.woff2",ref:A,className:"hidden",onChange:e=>ei(e,"templateFont",K)}),(0,s.jsxs)("div",{className:(0,Z.Z)(lN.gI,"flex items-center gap-2 justify-between"),children:[(0,s.jsx)("div",{className:"dark:text-[#A2A1AB]",children:(null==X?void 0:X.file)||(null==G?void 0:G.name)?(0,s.jsx)(ed,{preview:X,templateFont:G,onRemove:()=>en(K,"templateFont"),type:"document"}):n("slideTemplate.template_font_subtitle")}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)(h.z,{variant:"outline-primary",className:"border-none",onClick:()=>{var e;null===(e=A.current)||void 0===e||e.click()},disabled:P,children:P?n("slideTemplate.template_uploading"):(null==G?void 0:G.url)?n("slideTemplate.template_retry"):n("slideTemplate.template_font_upload")})})]})]}),(0,s.jsxs)(l_.Z,{label:n("slideTemplate.template_logo"),children:[(0,s.jsx)(eB.I,{id:"templateLogo",type:"file",accept:"image/*",ref:D,className:"hidden",onChange:e=>ei(e,"templateLogo",Q)}),(0,s.jsx)("div",{className:(0,Z.Z)("w-full h-[216px] border rounded-[10px] bg-[#F6F7F9] flex flex-col items-center justify-center cursor-pointer overflow-hidden dark:bg-[#353B46] relative border-dashed transition-colors",(null==$?void 0:$.preview)?"p-0":"p-1",!ee||(null==$?void 0:$.preview)?"":"border-blue-400 bg-blue-50 dark:bg-blue-900/20"),onClick:()=>{var e;null===(e=D.current)||void 0===e||e.click()},onDragOver:el,onDragEnter:el,onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),et(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),et(!1);let t=e.dataTransfer.files;if(t&&t.length>0){let e=t[0];if(!e.type.startsWith("image/")){o.error(n("slideTemplate.invalid_file_type"));return}es(e)}},children:(null==$?void 0:$.file)||(null==V?void 0:V.url)?(0,s.jsx)(ed,{preview:$,templateLogo:V,onRemove:()=>en(Q,"templateLogo"),type:"image"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:(0,Z.Z)("w-9 h-9 rounded-full flex items-center justify-center mb-3 ",ee?"bg-[#0080FF] text-white":"bg-white text-gray-400 dark:bg-[#464E5D] dark:text-[#B9BFCA]"),children:(0,s.jsx)(lf.Z,{className:"w-5 h-5 "})}),(0,s.jsx)("div",{className:"text-sm text-gray-500 dark:text-[#B9BFCA] mb-1",children:n("slideTemplate.template_logo_upload")}),(0,s.jsx)("div",{className:"text-sm text-gray-500 text-center dark:text-[#B9BFCA]",children:n("slideTemplate.template_logo_upload_subtitle")})]})})]}),(0,s.jsx)(lS.Z,{ref:z,isOpenAdvancedOptions:H,handleShowAdvancedOptions:()=>{W(!H),H||setTimeout(()=>{var e;null==z||null===(e=z.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},10)},type:"template"})]})}),(0,s.jsxs)(Y.cN,{children:[(0,s.jsxs)(h.z,{size:"lg",variant:"outline-primary",onClick:T,disabled:C||U||P||M||!(null==E?void 0:null===(i=E.colors)||void 0===i?void 0:i.primary_color),className:"h-9 px-4",children:[C?(0,s.jsx)(t$.Z,{className:"w-4 h-4 animate-spin"}):null,F?n("slideTemplate.clear_theme"):n("slideTemplate.ai_generate_theme")]}),(0,s.jsxs)(h.z,{size:"lg",type:"submit",onClick:er,disabled:U||C||P||M,className:"h-9 px-4",children:[U?(0,s.jsx)(t$.Z,{className:"w-4 h-4 animate-spin"}):null,n("slideTemplate.button_save")]})]})]})]})})]})};let lF=e=>(/^https?:\/\//i.test(e)||(e="https://"+e),e);var lT=u.memo(e=>{var t,l,c,w,N,k,E,S;let{className:Z,autoFocus:T,query:A,mode:z="default",isModal:I=!1,isFresh:R=!1,topicId:P,isMyTopic:L,onModeBarChange:M,needLogin:U=!1,isDisabled:O}=e,H=(0,_.useTranslations)(),q=(0,d.useRouter)(),Y="default"===z,{proUsageQuota:G}=(0,tK.I)(),{points:J,deductPoints:X}=lx(),[K,$]=(0,u.useState)(!1),{isDark:Q}=(0,j.Z)(),{isMobile:ee}=(0,y.Z)(),{homeFiles:et,isUploading:el,isImageUploading:es,homeImages:ea,setHomeFiles:en}=(0,e6.Z)(),er=(0,tc.Oi)("chatDocumentsUsage"),{homeFiles:eo,isUploading:ec,setHomeFiles:eu}=(0,tj.Z)(),em=(0,g.Z)(e=>e.searchValue),ep=(0,g.Z)(e=>e.setSearchValue),{handleFiles:eh}=tG({type:"home",threadId:""}),[ex]=function(e,t){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{leading:!1},[s,a]=(0,u.useState)(e),i=(0,u.useRef)(!1),n=(0,u.useRef)(null),r=(0,u.useRef)(!1),o=()=>window.clearTimeout(n.current);return(0,u.useEffect)(()=>{i.current&&(!r.current&&l.leading?(r.current=!0,a(e)):(o(),n.current=window.setTimeout(()=>{r.current=!1,a(e)},t)))},[e,l.leading,t]),(0,u.useEffect)(()=>(i.current=!0,o),[]),[s,o]}(em,200),[ev,eg]=(0,u.useState)(!0),[ef,e_]=(0,u.useState)(!1),[ey,ew]=(0,u.useState)(!1),eN=(0,u.useRef)(null),ek=(0,u.useRef)(null),eE=(0,u.useRef)(0),eS=(0,u.useRef)(null),{language:eZ,setLanguage:eC}=(0,tR.Z)(),eF=(0,g.Z)(e=>e.isBeginAnswer),eT=(0,ly.Z)(e=>e.template),{uploadFiles:eD}=(0,tT.Z)({}),eA=e=>{var t,l;"/"!==e.key&&""!==e.key||["INPUT","TEXTAREA"].includes((null===(t=document.activeElement)||void 0===t?void 0:t.tagName)||"")||document.activeElement instanceof HTMLElement&&document.activeElement.isContentEditable||(e.preventDefault(),null===(l=ek.current)||void 0===l||l.focus(),e_(!0))};(0,u.useEffect)(()=>I?I?(document.addEventListener("keydown",eA),()=>document.removeEventListener("keydown",eA)):void 0:(window.addEventListener("keydown",eA),()=>window.removeEventListener("keydown",eA)),[I]),(0,u.useEffect)(()=>{let e=e=>{var t;!e.target||(null===(t=eN.current)||void 0===t?void 0:t.contains(e.target))||e_(!1)};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[]);let ez=(0,ed.ZP)(e=>e.isLogin),eI=(0,g.Z)(e=>e.loading),eP=(0,g.Z)(e=>e.setLoading),eL=(0,g.Z)(e=>e.startSearch),eM=(0,g.Z)(e=>e.extensionSelected),eB=(0,g.Z)(e=>e.proSelected),eU=(0,g.Z)(e=>e.isDiscovery),eO=(0,g.Z)(e=>e.isResearch),eW=(0,g.Z)(e=>e.setIsDiscovery),eV=(0,g.Z)(e=>e.setIsResearch),eq=(0,eJ.Z)(e=>e.template),eY=(0,u.useMemo)(()=>{var e,t;return(null==eq?void 0:null===(t=eq.tool_config)||void 0===t?void 0:null===(e=t.top_bar)||void 0===e?void 0:e.top_bar_list)||[]},[null==eq?void 0:null===(t=eq.toolsConfig)||void 0===t?void 0:t.topBar]),[eG,eX]=(0,u.useState)((null===(l=eY.find(e=>e.defaultSelected))||void 0===l?void 0:l.type)||"google"),{selectModelValueList:eK}=(0,tI.Z)(),e$=(0,tz.Z)(),{isOpenThreadModal:eQ,closeThreadModal:e0}=(0,C.Z)(),[e1,e2]=(0,u.useState)(!1),e5=(0,ed.ZP)(e=>e.userInfo),[e4,e3]=(0,u.useState)(!1),e8=(0,tc.WI)();lp.Z.getState().pointsConfig;let e9=(0,eJ.Z)(e=>e.category),tt=(0,tc.ZP)(e=>e.isSearchOnlyProduct),{searchType:tl}=(0,g.Z)(),{isTopicSearchNetwork:ts,isFreshSearch:ta,setIsFreshSearch:ti,setIsTopicReply:tn,isTopicReply:tx,setWillBindTopicId:tv,freeUserSearchCountInfo:tg}=(0,g.Z)();(0,u.useEffect)(()=>{!localStorage.getItem(B.VB+e5.email)&&ez&&e5.email&&!I&&(!eq||(null==eq?void 0:eq.template_type)!==ei.W.CUSTOM)&&(!ez||!e5.email||e8||e5.chat_model||eB||(0,V.N0)()?(localStorage.setItem(B.VB+e5.email,"true"),e3(!1)):e3(!0))},[ez,e5]),(0,u.useEffect)(()=>{P?(tv(P),eJ.Z.getState().clearTemplate(),tn(!0)):(tv(""),tn(!1))},[P]),(0,u.useEffect)(()=>{(tl===g.S.SEARCH||tl===g.S.RESEARCH)&&eX(B.gl)},[tl]);let tf=(0,u.useMemo)(()=>em.includes("\n"),[em]),{results:t_,dropDownSelected:ty,showQueryDropdownMenu:tN,reduceSearchResult:tk,addSearchResult:tE}=tr({enable:!eq&&!tf,value:em,debouncedValue:ex,inputRef:ek}),tS=B.N2,{subscriptionInfo:tZ}=tc.ZP.getState(),tP=(0,ed.gQ)(),tL=(0,u.useMemo)(()=>B.iu.find(e=>e===eM)&&eB,[eM,eB]);(0,u.useEffect)(()=>{void 0===ez||tL||t6(!1,!0)},[tL,ez]);let tM=(0,u.useMemo)(()=>!1,[eM]),tB=(0,u.useMemo)(()=>!!eq&&(0,tA.uI)(eq),[eq]),tU=(0,u.useMemo)(()=>!!eq&&(0,tA.el)(eq),[eq]),tO=(0,u.useMemo)(()=>!!eq&&(0,tA.u1)(eq),[eq]),tH=(0,u.useMemo)(()=>{var e;return!!eq&&(null===(e=eq.params)||void 0===e?void 0:e.some(e=>(0,tA.Sc)(e.type)))},[eq]),tW=(0,u.useMemo)(()=>em.length>tS,[em]),tV=(0,u.useMemo)(()=>{let e=eq&&(0,tA.uI)(eq);return!((!e||(null==et?void 0:et.length)||em.trim())&&((null==eq?void 0:eq.template_type)!==ei.W.CUSTOM&&(null==eq?void 0:eq.template_type)!==ei.W.DIRECT_DUTY||e||em.trim()))||!eq&&!em.trim()},[em,eq,et]),tq=(0,u.useMemo)(()=>{var e,t;return(null!=et&&!!et.length||null!=ea&&!!ea.length)&&!!((null==et?void 0:et.length)&&(null==et?void 0:null===(e=et.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===e?void 0:e.length)||(null==ea?void 0:ea.length)&&(null==ea?void 0:null===(t=ea.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===t?void 0:t.length))},[et,ea]),tY=(0,u.useMemo)(()=>{var e;return null==eo?void 0:null===(e=eo.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===e?void 0:e.length},[eo]),tJ=(0,u.useMemo)(()=>tY&&!ec,[tY,ec]),t$=(0,u.useMemo)(()=>{if(void 0===ez)return!0;if(tJ)return!1;if(eG===B.J5&&!tY)return!0;if((null==eq?void 0:eq.template_type)===ei.W.CUSTOM&&tq){if((0,tA.wd)(eq))return!1;if((0,tA.uI)(eq)&&!em.trim())return!0}return tV||tW||el||es||ec},[em,tJ,eG,tY,eq,tq,tV,tW,el,es,ec,ez]),tQ=(0,u.useMemo)(()=>{var e,t;if(!(null==tZ?void 0:tZ.pointsUsage))return 0;let{balance:l,total_limit:s}=tZ.pointsUsage;return s===lv.a.UNLIMITED?1/0:tP&&(null==tZ?void 0:null===(e=tZ.pointsEnterpriseUsage)||void 0===e?void 0:e.balance)?(null==tZ?void 0:null===(t=tZ.pointsEnterpriseUsage)||void 0===t?void 0:t.balance)+l:l},[tZ]),t0=()=>{ek.current&&q.push("/websearch?q=".concat(ek.current.value))},t1=()=>{var e,t,l,s,a,i,n,r,o,d,c;if(!ek.current)return;let u=ek.current.value.trim();if(-1!==ty&&(u=t_[ty].title),!u&&!eq)return;if(eq&&(0,tA.wd)(eq)){if(!u)switch(eq.code){case tC.m5:u=H("generate_PPT_by_storyline");break;case tC.PZ:u=H("generate_webpage_by_content")}(0,to.c)(ej.U.QUERY_FELO_CREATE,u)}let m={query:u};if(m.slidesSource={type:"ask_question",files:{}},(tL&&eO||eq)&&!P){if((null==eq?void 0:eq.template_type)===ei.W.CUSTOM||(null==eq?void 0:eq.template_type)===ei.W.DIRECT_DUTY){let e=eq;tU&&(e={...eq,params:null===(s=eq.params)||void 0===s?void 0:s.map(e=>(0,tA.YX)(e.type)?{...e,value:eZ}:e)}),tb.Z.getState().setTemplateData({templateQuery:u,template:e}),eJ.Z.getState().setTemplate(e);let t=eq.sub_topics[0].source_type;m.category=t,m.model=eq.sub_topics[0].llm_model,t===B.RQ&&(m.topicId=eq.sub_topics[0].source_id)}else{eJ.Z.getState().openAgentPlanModal(u);return}}if(eq){let e=(0,tA.uI)(eq),t=null==eo?void 0:null===(a=eo.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===a?void 0:a.length;if(!e&&!u&&!t)return}let h=(null==eq?void 0:eq.template_type)===ei.W.CUSTOM;if(!P&&((null==et?void 0:null===(e=et.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===e?void 0:e.length)||(null==eo?void 0:null===(t=eo.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===t?void 0:t.length))){h||(m.category=B.J5);let e=[...et,...eo];m.documents=null==e?void 0:null===(n=e.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===n?void 0:null===(i=n.map(e=>null==e?void 0:e.id))||void 0===i?void 0:i.join(",");let t=null==e?void 0:null===(r=e.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===r?void 0:r.reduce((e,t)=>({...e,[t.id]:t.title}),{});m.slidesSource={type:"file_question",files:t},console.log("slidesSource",m.slidesSource),(null==eo?void 0:null===(o=eo.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===o?void 0:o.length)&&(m.documentAction="summary",u||(m.query=(null==eq?void 0:eq.code)===tC.m5?H("searchAddition.generate_ppt_from_file"):H("searchAddition.summary_file")))}if(!P&&(null==ea?void 0:null===(l=ea.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===l?void 0:l.length)&&(h||(m.category=B.Ys),m.documents=null==ea?void 0:null===(c=ea.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===c?void 0:null===(d=c.map(e=>null==e?void 0:e.id))||void 0===d?void 0:d.join(",")),tx&&(m.topicSource="topic"),P&&(m.category=B.gl,m.topicSource="topic",m.topicId=P),eU&&(m.mode=B.iV),eq&&(m.templateId=eq.id,m.category="long_text"===e9&&tY?B.J5:e9),(null==eT?void 0:eT.id)&&(m.slide_template_uid=eT.id),[tC.m5,tC.PZ].includes((null==eq?void 0:eq.code)||"")){let e=(0,p.MD)({...m,category:B.Wh,prefix:"/thread-chat"}),t="";switch(null==eq?void 0:eq.code){case tC.m5:t="/slides/".concat(tC.yw,"?chatUrl=").concat(encodeURIComponent(e));break;case tC.PZ:t="/page/".concat(tC.yw,"?chatUrl=").concat(encodeURIComponent(e),"&business_type=AGENT_THREAD")}q.push(t,void 0,{scroll:!0});return}let x=(0,p.MD)(m);q.push(x,void 0,{scroll:!0})},t2=()=>{tm.$.publish("showLogin",void 0)},t4=async e=>{var t,l,s,a;if(e.preventDefault(),eq&&!ez||tl===g.S.RESEARCH&&!ez){t2();return}if((null==eq?void 0:eq.code)===tC.m5&&(0,eb.fk)(ej.U.CREATE_SLIDES_PPT_BUTTON,{value:"create_slides_ppt_button"},!0),(null==eq?void 0:eq.code)===tC.PZ&&(0,eb.fk)(ej.U.CREATE_WEBPAGE_BUTTON,{value:"felo_search_webpage_button_click"},!0),tl===g.S.RESEARCH&&(0,eb.fk)(ej.U.HOME_PAGE_RESEARCH_BUTTON_CLICK,{value:ej.U.HOME_PAGE_RESEARCH_BUTTON_CLICK},!0),tl===g.S.RESEARCH&&"number"==typeof tQ&&0===tQ){tm.$.publish("felo_showPaidModal",{type:"INSUFFICIENT_POINTS"});return}if(tl===g.S.RESEARCH&&!e8&&0===tg.research){tm.$.publish("felo_showPaidModal",{type:"RATE_LIMIT_EXCEEDED"});return}if(eq&&0===tQ){tm.$.publish("felo_showPaidModal",{type:"INSUFFICIENT_POINTS"});return}if(eB&&tl===g.S.SEARCH&&0===tQ&&0===G){tm.$.publish("felo_showPaidModal",{type:"INSUFFICIENT_QUERIES"});return}if(eO||eM===B.Wh&&(null==eq?void 0:eq.short_id)!==tC.m5){if(null!==J&&J<10){e$.error(H("points.insufficient"));return}try{await X({action:eO?"RESEARCH":"AGENT_SEARCH",points:10})}catch(e){e$.error(e.message||H("points.deduction_failed"));return}}if(eI)return;if(U&&!ez){t2();return}if(t$)return;if(!eq&&tt&&(0,p.eF)()){e$.custom(H("cannot_use_model"));return}let i=(null==eq?void 0:eq.template_type)===ei.W.CUSTOM;if(i&&eq&&!(0,t5.x)()&&t9(eq)){$(!0);return}if((i||P||null==et||!et.filter(e=>"completed"===e.status).length||(g.Z.getState().setExtensionSelected(B.J5),await t8()))&&(P&&eJ.Z.getState().clearTemplate(),await (0,F.f)({query:null===(l=ek.current)||void 0===l?void 0:null===(t=l.value)||void 0===t?void 0:t.trim(),setLoading:eP}))){if(-1===ty)eL("form"),t1();else{let e=t_[ty];if("site"===e.type){let t=lF(e.domain);window.open(t,"_blank")}else eL("form"),t1()}!0===eQ&&e0(),P&&(0,eb.fk)(L?ej.U.COLLECTION_THREAD_SUBMIT:ej.U.COLLECTION_SHARE_THREAD_SUBMIT,{query:null===(a=ek.current)||void 0===a?void 0:a.value,webSearch:ts},!0),(0,eb.fk)(Y?ej.U.SEARCH_SUBMIT:ej.U.THREAD_NEW,{query:null===(s=ek.current)||void 0===s?void 0:s.value},!0),t3()}},t3=()=>{ep(""),ek.current&&(ek.current.value="",ek.current.focus()),ly.Z.getState().setTemplate(null)};(0,u.useEffect)(()=>(eg(!1),()=>{ta&&ti(!1)}),[]),(0,u.useEffect)(()=>{(0,W.f8)(()=>{if(ek.current&&T){ek.current.focus();let e=(A||"").length;ek.current.setSelectionRange(e,e)}})},[]);let t6=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];eW(e),eV(!1),t&&e&&(0,eb.fk)(ej.U.PRO_DISCOVERY_SEARCH,{},!0)},t8=async()=>{var e;let{subscriptionInfo:t}=tc.ZP.getState();return console.log("subscriptionInfo",t),!!t&&(!!er||!(0>=((null==t?void 0:null===(e=t.chatDocumentsUsage)||void 0===e?void 0:e.balance)||0))||(tm.$.publish("showSubscriptionPlan",void 0),!1))},t9=e=>{var t,l,s;if(!(null==e?void 0:null===(l=e.sub_topics)||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.tools))return!1;let a=e.sub_topics[0].tools.find(e=>"external_tool_services"===e.name);return null!=a&&null!==(s=a.config)&&void 0!==s&&!!s.list&&a.config.list.filter(e=>!!e.select_status&&!1===e.auth_status).length>0};(0,u.useEffect)(()=>{void 0!==ez&&(eB?B.Wh:t6(!1))},[eB,ez]),(0,u.useEffect)(()=>{A&&ep(A)},[A]),(0,u.useEffect)(()=>{},[eF]),(0,u.useEffect)(()=>{M&&M(!!(tL&&!P))},[tL,P]);let t7=[{id:"quick",icon:(0,s.jsx)(td.RK,{className:"w-4 h-4"}),label:H("quick_search"),isActive:!eU&&!eO,display:!0,onClick:()=>t6(!1,!0),disabled:!1},{id:"discovery",icon:(0,s.jsx)(a.Z,{size:16}),label:H("study_search"),isActive:eU&&!eO,display:!0,onClick:()=>{t6(!0,!0)},disabled:!1,tooltipLable:H("deep_research_desc")},{id:"research",icon:(0,s.jsx)(i.Z,{className:"w-4 h-4"}),label:H("extension.search_agent"),isActive:eO,display:!1,onClick:()=>eV(!0),disabled:!1}],le=e=>{let{mode:t,isFirst:l,isLast:a,disabled:i,id:n}=e,r=(0,m.cn)("flex items-center gap-1 border px-2 py-1 cursor-pointer","text-[#98A2B3] border-[#E4E7EC] dark:border-[#434955] dark:text-[#797E8D]",t.isActive&&"text-[#0080FF] dark:text-[#0080FF]",i&&"cursor-default opacity-50",l&&"rounded-s-lg",!l&&"border-l-0",a&&"rounded-e-lg");return(0,s.jsx)(s.Fragment,{children:t.tooltipLable?(0,s.jsx)(x.e,{delay:0,closeDelay:0,content:t.tooltipLable,classNames:{content:["text-white bg-gray-600 dark:bg-[#353535]"]},children:(0,s.jsxs)("div",{className:r,id:"mode-".concat(n),onClick:()=>!i&&t.onClick(),children:[t.icon,t.label]})}):(0,s.jsxs)("div",{className:r,id:"mode-".concat(n),onClick:()=>!i&&t.onClick(),children:[t.icon,t.label]})})};(0,u.useEffect)(()=>(e2(!0),()=>{e2(!1)}),[]);let ll=(0,u.useMemo)(()=>e1?(null==eq?void 0:eq.code)==="ppt_generation_v2"?H("ppt_placeholder_desc"):(null==eq?void 0:eq.code)==="html_agent"?H("html_agent_placeholder_desc"):"long_text"===eG?H("agentConfig.paste_text_here"):"chat_with_document"===eG?H("agentConfig.supports_PDF_Doc_TXT"):"web_summary"==eG?H("agentConfig.paste_url_here"):"video_summary"===eG?H("agentConfig.paste_video_link_here"):eq?eq.placeholder||H("search_placeholder"):P?H("search_placeholder"):eU?H("research_placeholder_desc"):eO?H("agent.input_research_question"):H("search_placeholder"):H("search_placeholder"),[eq,eU,eO,e1,H,P,eG]),ls=e=>{if(!ez){tm.$.publish("showLogin",void 0);return}let t=new Date,l=new File([e],e.slice(0,20)+".txt",{type:"text/plain",lastModified:t.getTime()});Object.defineProperty(l,"lastModifiedDate",{value:t}),Object.defineProperty(l,"webkitRelativePath",{value:""});let s=new DataTransfer;s.items.add(l);let a=s.files;(null==eS?void 0:eS.current)?eS.current.handleFiles(a):eh(a)},la=(0,u.useCallback)(e=>{var t;if(null==et?void 0:et.length)return;let l=e.clipboardData.getData("text");if(l.length>tS&&("long_text"===eG||(null==eS?void 0:eS.current))){ls(l),e.preventDefault();return}if(eq&&!(0,tA.uI)(eq)||!(null==eS?void 0:eS.current)||P||(null==et?void 0:et.length))return;let s=null===(t=e.clipboardData)||void 0===t?void 0:t.items,a=null==s?void 0:s[0];if(!a||!a.type.startsWith("image"))return;let i=a.getAsFile();if(i){e.preventDefault(),eD([i]);return}},[eG,ez,et]);return(0,s.jsxs)(s.Fragment,{children:[!P&&(0,s.jsx)(lm,{setPinDiscovery:t6}),(0,s.jsx)("form",{ref:eN,className:(0,m.cn)("flex justify-center",Z),onSubmit:t4,children:(0,s.jsx)("div",{className:"rounded-2xl w-full",children:(0,s.jsx)("div",{className:(0,m.cn)("rounded-2xl w-full gap-2 relative","gap-2"),children:(0,s.jsxs)("div",{className:(0,m.cn)("pt-[18px] pb-6 px-6","h-full w-full rounded-2xl relative border-1 border-[#E6E9EF] dark:border-[#545D6F] bg-white dark:bg-[#353B46]",!el&&eM===B.J5&&ey?"border-primary  bg-sky-50/80":""),style:{boxShadow:"0px 0px 20px 0px #0061C314"},onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),eE.current+=1,1===eE.current&&ew(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),eE.current-=1,0===eE.current&&ew(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{var t;if(e.preventDefault(),e.stopPropagation(),ew(!1),eE.current=0,e6.Z.getState().isUploading)return;let{files:l}=e.dataTransfer;console.log("files",l),(null==l?void 0:l.length)&&(null===(t=eS.current)||void 0===t||t.handleFiles(l))},children:[(0,s.jsxs)("div",{className:(0,m.cn)("flex items-center justify-center rounded-xl h-full absolute top-0 left-0 right-0 bottom-0 gap-1 pointer-events-none z-50  text-primary bg-white/70 dark:bg-black/70",!el&&eM===B.J5&&ey?"":"hidden"),children:[(0,s.jsx)(n.Z,{size:22}),H("searchAddition.drop_your_file_here")]}),P&&eB&&(0,s.jsx)("div",{className:"group -mx-3 -mt-4 h-[40px] flex justify-between items-center rounded-t-xl px-3 py-3 bg-[#F9FAFB] dark:bg-[#2F333C] min-h-10 mb-2",children:(0,s.jsxs)("div",{className:"w-full flex items-center text-sm text-gray-400 overflow-hidden gap-3",children:[(0,s.jsx)("div",{className:"flex items-center dark:bg-[#2d313a]",children:t7.map((e,t)=>e.display?(0,s.jsx)(le,{mode:e,isFirst:0===t,id:e.id,isLast:t===t7.filter(e=>e.display).length-1,disabled:e.disabled||tM},e.id):null)}),(0,s.jsx)("span",{className:"flex-1 line-clamp-1 text-[#98A2B3] dark:text-[#797E8D]",children:eO?H("research_desc"):eU?H("deep_search_desc_placeholder"):H("quick_search_desc")})]})}),(null==eq?void 0:null===(N=eq.tool_config)||void 0===N?void 0:null===(w=N.top_bar)||void 0===w?void 0:null===(c=w.top_bar_list)||void 0===c?void 0:c.length)&&(null==eq?void 0:eq.code)!=="ppt_generation_v2"&&(null==eq?void 0:eq.code)!=="html_agent"&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(tX,{topTabType:eG,setTopTabType:e=>{e!==eG&&(en([]),eu([]),eX(e))}})}),!P&&!eU&&(0,s.jsx)(tw,{}),!P&&!eU&&(0,s.jsx)(tF,{}),(0,s.jsxs)("div",{className:(0,m.cn)("flex relative",(null==eq?void 0:null===(S=eq.tool_config)||void 0===S?void 0:null===(E=S.top_bar)||void 0===E?void 0:null===(k=E.top_bar_list)||void 0===k?void 0:k.length)&&(null==eq?void 0:eq.code)!=="ppt_generation_v2"&&(null==eq?void 0:eq.code)!=="html_agent"&&"pt-3"),children:[(0,s.jsx)("span",{id:"modal"===z?"modal_search_form":"default_search_form",className:"invisible"}),(0,s.jsx)(v.Z,{ref:ek,className:(0,m.cn)(!Y&&"max-h-[40vh] overflow-y-auto scrollbar","m-0 w-full bg-inherit outline-none resize-none transition-height",em.length>tS&&"text-red-500","custom-scrollbar"),disabled:ev,value:em,onChange:e=>{e.target.value.length>tS&&("long_text"===eG||(null==eS?void 0:eS.current))?(ls(e.target.value),ep("")):ep(e.target.value)},onKeyDown:e=>{if(13===e.keyCode&&e.ctrlKey){e.preventDefault(),t0();return}if(13==e.keyCode&&!1==e.shiftKey&&!ee){var t;if(e.preventDefault(),0===ty){t0();return}null===(t=e.target.form)||void 0===t||t.requestSubmit()}"Escape"===e.key&&eQ&&(e.preventDefault(),e0()),"ArrowUp"===e.key&&t_.length>1&&(e.preventDefault(),tk()),"ArrowDown"===e.key&&t_.length>1&&(e.preventDefault(),tE())},onFocus:()=>e_(!0),minRows:4,maxRows:8,placeholder:ll,spellCheck:!1,rows:3,onPaste:la}),(0,s.jsx)("div",{className:em?"opacity-100":"opacity-0",children:(0,s.jsx)(x.e,{delay:0,closeDelay:0,content:H("clear_search_tip"),isDisabled:!em,children:(0,s.jsx)(h.z,{size:"icon",disabled:eI||!em,variant:"ghost",className:"h-8 w-8 rounded-full text-gray-600 dark:text-white hover:scale-105 hover:text-black","aria-label":H("clear_search_tip"),tabIndex:em?0:-1,onClick:t3,children:(0,s.jsx)(r.Z,{className:"h-4 w-4"})})})})]}),(0,s.jsxs)("div",{className:"flex flex-wrap w-full items-end justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex flex-wrap text-[#1d3c6d] dark:text-[#edf3fc] gap-2",children:[!P&&!eq&&!eU&&(0,s.jsx)(e7,{isDisalbedExtension:R}),tU&&!P?(0,s.jsx)("div",{className:"ml-3",children:(0,s.jsx)(tD.Z,{hideAutoDetect:tH,language:eZ,onChangeLanguage:eC,template:eq})}):(0,s.jsxs)(s.Fragment,{children:[!P&&(!eq||tB)&&!eU&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(tu.Z,{template:eq,ref:eS,type:"home",mode:z,isUseFileNewEngine:eq&&(0,tA.Of)(eq)})}),!P&&(!eq||tB&&eq.code!==tC.m5&&eq.code!==tC.PZ)&&!eU&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(th.Z,{ref:eS})})]}),P&&(0,s.jsx)(tp.Z,{isReply:!1}),b.r8&&(0,s.jsx)(f.Z,{}),eq&&(null==eq?void 0:eq.template_type)!==ei.W.DEFAULT&&(eq.system&&"ppt_generation_v2"===eq.code||!eq.system)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(lt,{template:eq,isListModalVisible:K,onListModalClose:()=>$(!1)}),"ppt_generation_v2"===eq.code?(0,s.jsx)(lC,{}):null]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[em.length>tS&&(0,s.jsx)("div",{className:"text-sm text-red-600",children:tS-em.length}),!tO&&(0,s.jsx)(eH.ZP,{agentTemplate:null,isTopic:!!P}),eI?(0,s.jsx)(eR.c,{className:"px-2 h-8",classNames:{circle1:"".concat(Q?"border-b-white":"border-b-[#b3bcca]"),circle2:"".concat(Q?"border-b-white":"border-b-[#b3bcca]")},size:"sm"}):(0,s.jsx)(h.z,{size:"icon",type:"submit",className:(0,m.cn)("h-8 w-8 rounded-full hover:scale-105 transition-all",!t$||eI?"bg-[#0080FF] dark:bg-[#1EB1FF] hover:bg-[#0080FF]/90":"bg-[#E6E9EF] dark:bg-[#454E5D]"),disabled:t$||O,children:(0,s.jsx)(o.Z,{className:(0,m.cn)("h-4 w-4",!t$||eI?"text-white":"text-[#ACB9CD] dark:text-[#737F96]")})})]})]}),(0,s.jsxs)("div",{className:(0,m.cn)("absolute -left-px -right-px  z-10","hidden",!P&&!eq&&ef&&em&&eM!==B.J5&&eM!==B.Ys&&"block","mt-1.5","border border-[#E6E9EF] dark:border-[#545D6F]","rounded-b-xl bg-white dark:bg-[#353B46]"),children:[(0,s.jsx)("div",{className:"max-h-[19em] px-4 py-2 overflow-auto custom-scrollbar",children:t_.map((e,t)=>(0,s.jsx)(D,{data:e,selected:ty===t,goToTraditionalSearch:t0},e.title))}),eM!==B.aI&&eM!==B.J5&&eM!==B.Ys&&ef&&tN&&t_.length>1&&!ee&&(0,s.jsx)(te,{isDisalbedExtension:R})]})]})})})})]})})},90095:function(e,t,l){var s=l(52676),a=l(53986);let i=(0,l(75271).forwardRef)((e,t)=>{let{id:l,label:i,subtitle:n,children:r,isRequired:o=!1,rightAction:d}=e;return(0,s.jsxs)("div",{ref:t,className:"grid w-full items-center gap-3 mb-6 relative",children:[(0,s.jsxs)(a._,{htmlFor:l||"",className:"text-sm font-bold",children:[i,o&&(0,s.jsx)("span",{className:"text-red-500",children:"*"}),n&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-2 mb-1 font-normal",children:n}),d&&(0,s.jsx)("div",{className:"absolute right-0 top-0 font-normal text-sm",children:d})]}),r]})});i.displayName="FormItem",t.Z=i},58734:function(e,t,l){l.d(t,{Z:function(){return _}});var s=l(52676),a=l(4814),i=l(90095),n=l(9369),r=l(75271),o=l(5588),d=l(7717),c=l(72070),u=l.n(c),m=l(25010),p=l(60904),h=e=>{let{placeholder:t,colorValue:l,inputClassName:i,handleColorPickerChange:n,handleDeleteColor:c}=e,h=(0,d.useTranslations)(),x=(0,r.useRef)(null);return(0,s.jsxs)("div",{className:"flex items-center gap-2 relative",children:[(0,s.jsx)(o.I,{type:"text",value:l,onChange:n,placeholder:t||h("slideTemplate.theme_color_placeholder"),maxLength:7,className:(0,a.Z)(i,"pl-12"),onFocus:()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.click()},autoComplete:"off"}),(0,s.jsxs)("div",{className:"absolute left-3 top-2.5 rounded-full overflow-hidden w-7 h-7 border-1 cursor-pointer",children:[(0,s.jsx)("input",{type:"color",value:l||h("slideTemplate.theme_color_placeholder"),onChange:n,className:(0,a.Z)("w-12 h-12 rounded border-0 cursor-pointer p-0 m-0 bg-transparent -mt-1.5 -ml-1.5 -mr-1.5"),title:t,ref:x}),l?null:(0,s.jsx)(u(),{src:"/icon-colors.webp",alt:"color",className:"absolute left-0 top-0",width:28,height:28,onClick:()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.click()}})]}),l?(0,s.jsx)(m.z,{variant:"ghost",size:"sm",onClick:c,className:"p-1 h-[18px] w-[18px] bg-[#3D4C67] rounded-full hover:bg-[#606B80] absolute top-3.5 right-2 z-20",children:(0,s.jsx)(p.Z,{className:"w-2 h-2 text-white scale-80"})}):null]})},x=l(63023),v=l(15082),g=l(54296);let f=(0,r.forwardRef)((e,t)=>{var l,r,c,u;let{isOpenAdvancedOptions:m=!1,isShowAdvancedOptions:p=!0,handleShowAdvancedOptions:f,type:_="slide"}=e,b=(0,d.useTranslations)(),{themeColor:j}=(0,g.Z)(),{removeThemeColor:y,colorPickerChange:w,inputChange:N}=(0,v.Z)();return(0,s.jsxs)(s.Fragment,{children:[m?(0,s.jsxs)(i.Z,{ref:t||void 0,label:b("slideTemplate.theme_style_title"),children:[(0,s.jsx)(o.I,{type:"text",placeholder:b("slideTemplate.theme_style_title_placeholder"),value:(null==j?void 0:j.style_name)||"",onChange:e=>{N(e,"style_name")},maxLength:50,className:(0,a.Z)(x.gI,"pr-12"),autoComplete:"off"}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 absolute right-1.5 bottom-4 ",children:[(null==j?void 0:null===(l=j.style_name)||void 0===l?void 0:l.length)||0,"/50"]})]}):null,(0,s.jsx)(i.Z,{ref:t||void 0,label:b("slideTemplate.theme_color"),isRequired:"template"!==_,rightAction:p?(0,s.jsxs)("div",{className:"flex items-center gap-0.5 cursor-pointer text-[#5F7698] dark:text-[#B9BFCA]",onClick:f||void 0,children:[b("slideTemplate.advanced_options_title"),(0,s.jsx)(n.Z,{className:(0,a.Z)("w-5 h-5 transition-transform duration-300",m?"rotate-180":"")})]}):null,children:(0,s.jsx)(h,{colorValue:(null==j?void 0:null===(r=j.colors)||void 0===r?void 0:r.primary_color)||"",inputClassName:x.gI,handleColorPickerChange:e=>{w(e,"primary_color")},handleDeleteColor:()=>{y({name:"primary_color"})}})}),m&&(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,s.jsx)(i.Z,{label:b("slideTemplate.theme_text_color"),children:(0,s.jsx)(h,{colorValue:(null==j?void 0:null===(c=j.colors)||void 0===c?void 0:c.text_on_background)||"",inputClassName:x.gI,handleColorPickerChange:e=>{w(e,"text_on_background")},handleDeleteColor:()=>{y({name:"text_on_background"})}})}),(0,s.jsx)(i.Z,{label:b("slideTemplate.theme_background_color"),children:(0,s.jsx)(h,{colorValue:(null==j?void 0:null===(u=j.colors)||void 0===u?void 0:u.background_color)||"",inputClassName:x.gI,handleColorPickerChange:e=>{w(e,"background_color")},handleDeleteColor:()=>{y({name:"background_color"})}})}),x.e.colors.auxiliary_colors.map((e,t)=>{var l,a;return(0,s.jsx)(i.Z,{label:b("slideTemplate.theme_auxiliary_colors",{index:t+1}),children:(0,s.jsx)(h,{colorValue:(null==j?void 0:null===(a=j.colors)||void 0===a?void 0:null===(l=a.auxiliary_colors)||void 0===l?void 0:l[t])||"",inputClassName:x.gI,handleColorPickerChange:e=>{w(e,"auxiliary_colors",t)},handleDeleteColor:()=>{y({name:"auxiliary_colors",index:t})}})},t)}),(0,s.jsx)("div",{className:"w-full -mt-6 text-xs text-[#8896AA] dark:text-[#B9BFCA] text-left",children:b("slideTemplate.theme_auxiliary_colors_desc")})]})]})});f.displayName="SlideTemplateThemeColor";var _=f},81080:function(e,t,l){l.d(t,{X:function(){return o}});var s=l(52676),a=l(75271),i=l(24903),n=l(91165),r=l(37481);let o=a.forwardRef((e,t)=>{let{className:l,...a}=e;return(0,s.jsx)(i.fC,{ref:t,className:(0,r.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",l),...a,children:(0,s.jsx)(i.z$,{className:(0,r.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(n.Z,{className:"h-4 w-4"})})})});o.displayName=i.fC.displayName},15082:function(e,t,l){var s=l(7717),a=l(54296),i=l(94572),n=l(75271),r=l(63023),o=l(8529),d=l(39109);t.Z=()=>{let e=(0,s.useTranslations)(),t=(0,s.useLocale)(),l=(0,d.Z)(),{themeColor:c,setThemeColor:u,setIsAiGeneratingThemeColors:m,updateColorPaletteList:p,setColorPalette:h}=(0,a.Z)(),x=(0,n.useMemo)(()=>(0,r.WJ)(null==c?void 0:c.colors),[null==c?void 0:c.colors]),v=()=>{var e;u({...c,style_name:"",colors:{primary_color:(null==c?void 0:null===(e=c.colors)||void 0===e?void 0:e.primary_color)||"",text_on_background:"",background_color:"",auxiliary_colors:[,,,,,].fill("")}})},g=async()=>{var s,a,n,d;if(m(!0),!(null==c?void 0:null===(s=c.colors)||void 0===s?void 0:s.primary_color)){m(!1);return}let p=await (0,o.Lf)({primary_color:(null===(a=c.colors)||void 0===a?void 0:a.primary_color)||"",lang:(0,r.G3)(t),style_name:c.style_name||""});console.log("\uD83D\uDE80 ~ aiGenerateThemeColors ~ res:",p);let h=null==p?void 0:null===(d=p.data)||void 0===d?void 0:null===(n=d.palettes)||void 0===n?void 0:n[0];if((null==p?void 0:p.status)!==200||!h){l.error(e("slideTemplate.ai_generate_theme_failed"));return}return await (0,i.gw)(2e3),m(!1),u(h),h},f=async()=>{if(x){v();return}g()};return{removeThemeColor:e=>{var t;let{name:l,index:s}=e,a=(null==c?void 0:null===(t=c.colors)||void 0===t?void 0:t.auxiliary_colors)||[];u(void 0!==s&&s>=0?{...c,colors:{...c.colors,auxiliary_colors:a.map((e,t)=>t===s?"":e)}}:{...c,colors:{...c.colors,[l]:""}})},colorPickerChange:(e,t,l)=>{var s;let a=e.target.value,i=(null==c?void 0:null===(s=c.colors)||void 0===s?void 0:s.auxiliary_colors)||[];u(void 0!==l&&l>=0?{...c,colors:{...c.colors,auxiliary_colors:i.map((e,t)=>t===l?a:e)}}:{...c,colors:{...c.colors,[t]:a}})},aiGenerateThemeColors:g,isThemeColorComplete:x,handleGenerateOrClearThemeColors:f,handleApplyThemeColor:async e=>{h(e),p(e)},inputChange:(e,t)=>{let l=e.target.value;u({...c,[t]:l})}}}},35525:function(e,t,l){var s=l(75910),a=l(65819);let i=(0,s.Ue)(e=>({isOpen:!1,callback:()=>{},setIsOpen:t=>e({isOpen:t}),getDataRetentionEnabled:()=>{var e,t;return null===(t=null===(e=a.ZP.getState().userInfo.settings)||void 0===e?void 0:e.ai_data_retention)||void 0===t||t},setCallback:t=>e({callback:t})}));t.Z=i}}]);