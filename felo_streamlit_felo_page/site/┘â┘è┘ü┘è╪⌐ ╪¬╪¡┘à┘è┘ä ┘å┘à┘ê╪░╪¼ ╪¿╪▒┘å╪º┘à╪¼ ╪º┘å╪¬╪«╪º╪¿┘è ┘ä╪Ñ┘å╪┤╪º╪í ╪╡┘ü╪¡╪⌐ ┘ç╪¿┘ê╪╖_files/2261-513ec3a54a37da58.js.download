"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2261],{40203:function(e,s,t){var a=t(52676),l=t(75271),r=t(43378),n=t(25010),i=t(25773),c=t(62796),o=t(7717);s.Z=e=>{let{serviceName:s,serviceUrl:t,serviceId:d,isOpen:h,onClose:u,onSuccess:m}=e,x=(0,o.useTranslations)(),[p,g]=(0,l.useState)(!1),[f,v]=(0,l.useState)(null),[_,j]=(0,l.useState)(!1),w=async()=>{g(!0),v(null);try{let e=Math.max(0,(window.innerWidth-600)/2),s=Math.max(0,(window.innerHeight-700)/2),a=window.open(t,"",["popup","width=".concat(600),"height=".concat(700),"left=".concat(e),"top=".concat(s)].join(",")),l=e=>{"authorization_success"===e.data?(window.removeEventListener("message",l),null==a||a.close(),m(),u()):"authorization_error"===e.data&&(window.removeEventListener("message",l),null==a||a.close(),v(x("agent.mcp_auth_check_failed")))};window.addEventListener("message",l);let r=setInterval(()=>{(null==a?void 0:a.closed)&&(clearInterval(r),g(!1),N())},1e3)}catch(e){console.error("Authorization failed",e),v(x("agent.mcp_auth_check_failed")),g(!1)}},N=async()=>{j(!0);let e=0,s=async()=>{try{let{isAuthorized:s,data:t}=await (0,c.q)(d);if(s)return j(!1),await m(),u(),!0;if(e>=3)return j(!1),v(x("agent.mcp_auth_check_timeout")),!0;return e++,!1}catch(e){return console.error("Error checking authorization status:",e),j(!1),v(x("agent.mcp_auth_check_failed")),!0}},t=async()=>{await s()||setTimeout(t,2e3)};t()};return(0,l.useEffect)(()=>{h&&w()},[h]),(0,a.jsx)(r.Vq,{open:h,onOpenChange:e=>{console.log("\uD83D\uDD0D onOpenChange triggered:",{open:e,isOpen:h}),e||(console.log("\uD83D\uDEAA Calling onClose"),u())},children:(0,a.jsxs)(r.cZ,{className:"sm:max-w-md",children:[(0,a.jsx)(r.fK,{children:(0,a.jsx)(r.$N,{children:x("agent.mcp_auth_title",{name:s})})}),(0,a.jsx)("div",{className:"flex flex-col items-center justify-center py-6 space-y-4",children:p||_?(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(i.Z,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-200",children:p?x("agent.mcp_auth_loading",{name:s}):x("agent.mcp_auth_checking",{name:s})})]}):f?(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-red-500",children:f}),(0,a.jsx)(n.z,{onClick:w,variant:"outline",children:x("agent.mcp_auth_retry")})]}):(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-200",children:x("agent.mcp_auth_please_complete",{name:s})})})]})})}},28818:function(e,s,t){var a=t(52676),l=t(25010),r=t(5588),n=t(25773),i=t(43378),c=t(7717);s.Z=e=>{let{isOpen:s,onOpenChange:t,serverTitle:o,onServerTitleChange:d,serverUrl:h,onServerUrlChange:u,serverHeader:m,onServerHeaderChange:x,testStatus:p,testLoading:g,onTest:f,onSubmit:v}=e,_=(0,c.useTranslations)();return(0,a.jsx)(i.Vq,{open:s,onOpenChange:t,children:(0,a.jsxs)(i.cZ,{className:"sm:max-w-[425px]","aria-describedby":void 0,children:[(0,a.jsx)(i.fK,{children:(0,a.jsx)(i.$N,{children:_("agent.mcp_servers")})}),(0,a.jsx)(i.a7,{children:(0,a.jsxs)("div",{className:"grid gap-4 py-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("label",{htmlFor:"serverTitle",className:"text-sm",children:[(0,a.jsx)("span",{className:"text-red-500 mr-1",children:"*"}),_("agent.mcp_servers_title")]}),(0,a.jsx)(r.I,{id:"serverTitle",value:o,onChange:e=>d(e.target.value),placeholder:"",autoComplete:"off",autoFocus:!0})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("label",{htmlFor:"serverUrl",className:"text-sm",children:[(0,a.jsx)("span",{className:"text-red-500 mr-1",children:"*"}),_("agent.mcp_servers_url")]}),(0,a.jsx)(r.I,{id:"serverUrl",value:h,onChange:e=>u(e.target.value),placeholder:"https://example.com/sse",autoComplete:"off"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{htmlFor:"serverHeaders",className:"text-sm",children:_("agent.mcp_servers_header")}),(0,a.jsx)(r.I,{id:"serverHeaders",value:m,onChange:e=>x(e.target.value),placeholder:_("agent.mcp_servers_header_placeholder",{json:'{"Authorization":"Bearer xx"}'}),autoComplete:"off"})]})]})}),(0,a.jsx)(i.cN,{className:"flex gap-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 w-full",children:[(0,a.jsx)("div",{children:null!==p&&(0,a.jsxs)("div",{className:"flex items-center gap-2 ".concat(p?"text-green-500":"text-red-500"),children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(p?"bg-green-500":"bg-red-500")}),(0,a.jsx)("span",{children:_(p?"agent.mcp_servers_success":"agent.mcp_servers_failed")})]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.z,{variant:"outline",onClick:f,disabled:!o||!h,className:"flex-1 sm:flex-none",isLoading:g,children:g?(0,a.jsx)(n.Z,{className:"h-4 w-4 animate-spin"}):_("agent.mcp_servers_test")}),(0,a.jsx)(l.z,{onClick:v,disabled:!o||!h,className:"flex-1 sm:flex-none",children:_("agent.mcp_servers_save")})]})]})})]})})}},26449:function(e,s,t){t.d(s,{Z:function(){return b}});var a=t(52676),l=t(43378),r=t(7717),n=t(36551),i=t(29764),c=t(94247),o=t(28946),d=t(29197),h=t(67241),u=t(9455),m=t(95611),x=t(1937),p=t(25010),g=t(1167),f=t(75271),v=t(9369),_=t(17436),j=t(72696),w=e=>{let{selectItem:s,selectTopicClick:t,setIsSelf:l}=e,n=(0,r.useTranslations)(),{list:i}=(0,_.Z)(),c=(0,f.useMemo)(()=>{var e;if((null===(e=s.source_info)||void 0===e?void 0:e.is_self)===!1)return l(!1),s.source_info.name;l(!0);let t=i.find(e=>e.short_id===s.source_id);return(null==t?void 0:t.name)||""},[s]);return(0,a.jsxs)(j.h_,{children:[(0,a.jsx)(j.$F,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full px-2 py-1  bg-white border border-gray-300 rounded-md shadow-sm cursor-pointer  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2  focus:ring-indigo-500 dark:bg-[#202531] dark:border-[#545D6F]  dark:hover:bg-gray-700",children:[(0,a.jsx)("span",{className:"ml-2 mr-4 whitespace-nowrap",children:c||n("agent.please_select")}),(0,a.jsx)(v.Z,{size:20})]})}),(0,a.jsx)(j.AW,{"aria-label":"topic Changed",className:"p-2 overflow-auto rounded-lg dark:bg-[#454E5D] dark:border-[#2E3643]",style:{position:"relative",pointerEvents:"auto"},children:i.map(e=>(0,a.jsx)(j.Xi,{className:"text-[#1D3C6D] cursor-pointer hover:!bg-blue-100 hover:!text-[#1D3C6D] dark:text-[#EDF3FC] hover:dark:!bg-[#2E3643] hover:dark:!text-[#EDF3FC]",onClick:()=>{t(e)},children:e.name},e.short_id))})]})},N=t(84781),y=t(17112),b=e=>{let{item:s,onChange:t,index:v,children:j}=e,b=(0,r.useTranslations)(),[k,C]=(0,f.useState)(s),{isOpen:F,onOpen:z,onClose:D}=(0,u.q)(),[E,S]=(0,f.useState)(!1),{getList:A,inited:Z,list:P}=(0,_.Z)();(0,f.useEffect)(()=>{!Z&&F&&A()},[Z,F]);let L=[{value:n.gl,title:b("extension.all"),desc:b("extension.all_desc"),icon:(0,a.jsx)(i.Z,{size:16}),selected:!1},{value:n.Kp,title:b("extension.academic"),desc:b("extension.academic_desc"),icon:(0,a.jsx)(h.Od,{className:"w-4 h-4"}),selected:!1},{value:n.pN,title:b("extension.social"),desc:b("extension.social_desc"),icon:(0,a.jsx)(c.Z,{size:16}),selected:!1},{value:n.aI,title:b("extension.chat"),desc:b("agent.llm_use_last_answer"),icon:(0,a.jsx)(o.Z,{size:16}),selected:!1},{value:n.RQ,title:b("topics"),desc:b("agent.topics_desc"),icon:(0,a.jsx)(N.HV,{className:"w-4 h-4"}),selected:!1}];(0,f.useEffect)(()=>{C(s)},[s]);let T=e=>{C({...k,source_type:n.RQ,source_id:e.short_id,source_info:{name:e.name,is_self:!0}})},M=()=>{C({title:k.title,source_type:n.gl,source_id:""}),S(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.pn,{delayDuration:100,children:(0,a.jsxs)(g.u,{children:[(0,a.jsx)(g.aJ,{asChild:!0,children:j?f.cloneElement(j,{onClick:e=>{var s,t;null===(t=j.props)||void 0===t||null===(s=t.onClick)||void 0===s||s.call(t,e),z()}}):(0,a.jsx)(p.z,{size:"sm",variant:"ghost",onClick:z,className:"text-gray-500 dark:bg-[#202531] p-2 bg-[#FFFFFF] dark:text-white hover:bg-gray-50",children:(()=>{let e=L.find(e=>e.value===s.source_type);return e?e.icon:(0,a.jsx)(i.Z,{size:16})})()})}),(0,a.jsx)(g._v,{children:b("agent.select_search_type")})]})}),(0,a.jsx)(l.Vq,{open:F,onOpenChange:D,children:(0,a.jsxs)(l.cZ,{className:"max-w-2xl w-full max-h-full dark:bg-[#454E5D]",children:[(0,a.jsx)(l.fK,{children:(0,a.jsx)(l.$N,{children:b("agent.select_search_type_title")})}),(0,a.jsx)(l.a7,{className:"pt-0",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(m.X,{label:b("agent.select_search_type_desc"),value:k.source_type||n.gl,classNames:{label:"dark:text-[#F3F5F7] text-sm"},onValueChange:e=>{C({...k,source_type:e})},children:(0,a.jsx)("div",{className:"border border-[#EBEEF3] dark:border-[#202531] rounded-md mt-1",children:L.map((e,s)=>(0,a.jsx)("div",{className:"flex items-center p-3 gap-2 w-full",children:(0,a.jsx)(x.J,{value:e.value,size:"sm",className:"w-full",isDisabled:e.value===n.RQ&&0===P.length&&!k.source_id,classNames:{labelWrapper:"w-full max-w-full",base:"w-full max-w-full ",label:"m-0",wrapper:"dark:bg-[#353B46] dark:border-[#353B46]"},children:(0,a.jsxs)("div",{className:"flex items-center gap-2 ml-1",children:[(0,a.jsx)("div",{className:"text-sm whitespace-nowrap mr-1",children:e.title}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-[#D0D4DC] whitespace-nowrap",children:e.desc}),"topic"===e.value&&(0,a.jsxs)("div",{className:"ml-auto flex items-center",children:[(0,a.jsx)(w,{selectItem:k,selectTopicClick:T,setIsSelf:S}),!E&&(0,a.jsx)(p.z,{className:"p-1 h-auto ml-2",onClick:M,size:"sm",children:b("agent.reset")})]})]})})},s))})}),!E&&(0,a.jsxs)("div",{className:"text-xs text-[#f59a23] flex items-center gap-2",children:[(0,a.jsx)(d.Z,{size:16}),b("agent.reset_tip")]})]})}),(0,a.jsxs)(l.cN,{children:[(0,a.jsx)(p.z,{variant:"outline",className:"border-[#0080FF] dark:border-[#0694FF] text-[#0080FF] dark:text-[#0694FF] hover:text-[#0080FF] bg-transparent hover:bg-transparent",onClick:()=>{D(),C(s)},children:b("cancel")}),(0,a.jsx)(p.z,{onClick:()=>{if(k.source_type===n.RQ&&!k.source_id){y.Z.error(b("agent.select_topic"));return}t(v,k),D()},color:"primary",children:b("confirm")})]})]})})]})}},62796:function(e,s,t){t.d(s,{c:function(){return n},q:function(){return r}});var a=t(27976),l=t(13263);let r=async e=>{let s=(0,l.LP)();try{let t=await fetch("".concat(a.XJ,"/threads/templates/tools/connect"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"".concat(s)},body:JSON.stringify({external_tool_id:e})});if((null==t?void 0:t.status)===403)return{isAuthorized:!1,message:"未授权访问"};if(null==t?void 0:t.ok){let e=await t.json();return{isAuthorized:"active"===e.status,data:e}}return{isAuthorized:!1,message:"请求失败"}}catch(e){return console.error("Error checking MCP tool authorization:",e),{isAuthorized:!1,message:"请求异常"}}},n=async e=>{let s=(0,l.LP)();try{let t=await fetch("".concat(a.XJ,"/threads/templates/tools/connect_reset"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"".concat(s)},body:JSON.stringify({external_tool_id:e})});if(null==t?void 0:t.ok){let e=await t.json();return{success:!0,data:e,message:""}}if((null==t?void 0:t.status)===422){let e=await t.json();return{success:!1,message:(null==e?void 0:e.message)||"参数校验失败"}}return{success:!1,message:"请求失败"}}catch(e){return console.error("Error resetting MCP tool authorization:",e),{success:!1,message:"请求异常"}}}},54047:function(e,s,t){let a=(0,t(75910).Ue)(e=>({showAgentLimitModal:!1,setShowAgentLimitModal:s=>e({showAgentLimitModal:s}),showLimitModalData:null,setShowLimitModalData:s=>e({showLimitModalData:s}),shareStep:1,setShareStep:s=>e({shareStep:s}),showAgentStatus:"PRIVATE",setShowAgentStatus:s=>e({showAgentStatus:s}),sharePermission:null,setSharePermission:s=>e({sharePermission:s}),updateSharePermission:s=>e(e=>({sharePermission:e.sharePermission?{...e.sharePermission,...s}:null}))}));s.Z=a}}]);